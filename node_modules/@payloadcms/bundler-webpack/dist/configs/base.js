"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "getBaseConfig", {
    enumerable: true,
    get: function() {
        return getBaseConfig;
    }
});
const _findnodemodules = /*#__PURE__*/ _interop_require_default(require("find-node-modules"));
const _fs = /*#__PURE__*/ _interop_require_default(require("fs"));
const _htmlwebpackplugin = /*#__PURE__*/ _interop_require_default(require("html-webpack-plugin"));
const _path = /*#__PURE__*/ _interop_require_default(require("path"));
const _webpack = /*#__PURE__*/ _interop_require_default(require("webpack"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const mockModulePath = _path.default.resolve(__dirname, '../mocks/emptyModule.js');
const mockDotENVPath = _path.default.resolve(__dirname, '../mocks/dotENV.js');
const nodeModulesPaths = (0, _findnodemodules.default)({
    cwd: process.cwd(),
    relative: false
});
const getBaseConfig = (payloadConfig)=>{
    let nodeModulesPath = nodeModulesPaths.find((p)=>{
        const guess = _path.default.resolve(p, 'payload/dist/admin');
        if (_fs.default.existsSync(guess)) {
            return true;
        }
        return false;
    });
    if (!nodeModulesPath) {
        nodeModulesPath = process.cwd();
    }
    const adminFolderPath = _path.default.resolve(nodeModulesPath, 'payload/dist/admin');
    const config = {
        entry: {
            main: [
                adminFolderPath
            ]
        },
        module: {
            rules: [
                {
                    exclude: /\/node_modules\/(?!.+\.tsx?$).*$/,
                    test: /\.(t|j)sx?$/,
                    use: [
                        {
                            loader: require.resolve('swc-loader'),
                            options: {
                                jsc: {
                                    parser: {
                                        syntax: 'typescript',
                                        tsx: true
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    oneOf: [
                        {
                            test: /\.(?:ico|gif|png|jpg|jpeg|woff(2)?|eot|ttf|otf|svg)$/i,
                            type: 'asset/resource'
                        }
                    ]
                }
            ]
        },
        plugins: [
            new _webpack.default.ProvidePlugin({
                process: require.resolve('process/browser')
            }),
            new _webpack.default.DefinePlugin(Object.entries(process.env).reduce((values, [key, val])=>{
                if (key.indexOf('PAYLOAD_PUBLIC_') === 0) {
                    return {
                        ...values,
                        [`process.env.${key}`]: `'${val}'`
                    };
                }
                return values;
            }, {})),
            new _htmlwebpackplugin.default({
                filename: _path.default.normalize('./index.html'),
                template: payloadConfig.admin.indexHTML
            })
        ],
        resolve: {
            alias: {
                '@payloadcms/bundler-webpack': mockModulePath,
                dotenv: mockDotENVPath,
                path: require.resolve('path-browserify'),
                payload$: mockModulePath,
                'payload-config': payloadConfig.paths.rawConfig,
                'payload-user-css': payloadConfig.admin.css
            },
            extensions: [
                '.ts',
                '.tsx',
                '.js',
                '.json'
            ],
            fallback: {
                crypto: false,
                http: false,
                https: false
            },
            modules: [
                'node_modules',
                nodeModulesPath,
                _path.default.resolve(__dirname, '../../node_modules')
            ]
        }
    };
    return config;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb25maWdzL2Jhc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBTYW5pdGl6ZWRDb25maWcgfSBmcm9tICdwYXlsb2FkL2NvbmZpZydcbmltcG9ydCB0eXBlIHsgQ29uZmlndXJhdGlvbiB9IGZyb20gJ3dlYnBhY2snXG5cbmltcG9ydCBmaW5kTm9kZU1vZHVsZXMgZnJvbSAnZmluZC1ub2RlLW1vZHVsZXMnXG5pbXBvcnQgZnMgZnJvbSAnZnMnXG5pbXBvcnQgSHRtbFdlYnBhY2tQbHVnaW4gZnJvbSAnaHRtbC13ZWJwYWNrLXBsdWdpbidcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgd2VicGFjayBmcm9tICd3ZWJwYWNrJ1xuXG5jb25zdCBtb2NrTW9kdWxlUGF0aCA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi9tb2Nrcy9lbXB0eU1vZHVsZS5qcycpXG5jb25zdCBtb2NrRG90RU5WUGF0aCA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsICcuLi9tb2Nrcy9kb3RFTlYuanMnKVxuXG5jb25zdCBub2RlTW9kdWxlc1BhdGhzID0gZmluZE5vZGVNb2R1bGVzKHsgY3dkOiBwcm9jZXNzLmN3ZCgpLCByZWxhdGl2ZTogZmFsc2UgfSlcblxuZXhwb3J0IGNvbnN0IGdldEJhc2VDb25maWcgPSAocGF5bG9hZENvbmZpZzogU2FuaXRpemVkQ29uZmlnKTogQ29uZmlndXJhdGlvbiA9PiB7XG4gIGxldCBub2RlTW9kdWxlc1BhdGggPSBub2RlTW9kdWxlc1BhdGhzLmZpbmQoKHApID0+IHtcbiAgICBjb25zdCBndWVzcyA9IHBhdGgucmVzb2x2ZShwLCAncGF5bG9hZC9kaXN0L2FkbWluJylcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhndWVzcykpIHtcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIHJldHVybiBmYWxzZVxuICB9KVxuXG4gIGlmICghbm9kZU1vZHVsZXNQYXRoKSB7XG4gICAgbm9kZU1vZHVsZXNQYXRoID0gcHJvY2Vzcy5jd2QoKVxuICB9XG5cbiAgY29uc3QgYWRtaW5Gb2xkZXJQYXRoID0gcGF0aC5yZXNvbHZlKG5vZGVNb2R1bGVzUGF0aCwgJ3BheWxvYWQvZGlzdC9hZG1pbicpXG5cbiAgY29uc3QgY29uZmlnOiBDb25maWd1cmF0aW9uID0ge1xuICAgIGVudHJ5OiB7XG4gICAgICBtYWluOiBbYWRtaW5Gb2xkZXJQYXRoXSxcbiAgICB9LFxuICAgIG1vZHVsZToge1xuICAgICAgcnVsZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGV4Y2x1ZGU6IC9cXC9ub2RlX21vZHVsZXNcXC8oPyEuK1xcLnRzeD8kKS4qJC8sXG4gICAgICAgICAgdGVzdDogL1xcLih0fGopc3g/JC8sXG4gICAgICAgICAgdXNlOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGxvYWRlcjogcmVxdWlyZS5yZXNvbHZlKCdzd2MtbG9hZGVyJyksXG4gICAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBqc2M6IHtcbiAgICAgICAgICAgICAgICAgIHBhcnNlcjoge1xuICAgICAgICAgICAgICAgICAgICBzeW50YXg6ICd0eXBlc2NyaXB0JyxcbiAgICAgICAgICAgICAgICAgICAgdHN4OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgb25lT2Y6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdGVzdDogL1xcLig/Omljb3xnaWZ8cG5nfGpwZ3xqcGVnfHdvZmYoMik/fGVvdHx0dGZ8b3RmfHN2ZykkL2ksXG4gICAgICAgICAgICAgIHR5cGU6ICdhc3NldC9yZXNvdXJjZScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0sXG4gICAgcGx1Z2luczogW1xuICAgICAgbmV3IHdlYnBhY2suUHJvdmlkZVBsdWdpbih7IHByb2Nlc3M6IHJlcXVpcmUucmVzb2x2ZSgncHJvY2Vzcy9icm93c2VyJykgfSksXG4gICAgICBuZXcgd2VicGFjay5EZWZpbmVQbHVnaW4oXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKHByb2Nlc3MuZW52KS5yZWR1Y2UoKHZhbHVlcywgW2tleSwgdmFsXSkgPT4ge1xuICAgICAgICAgIGlmIChrZXkuaW5kZXhPZignUEFZTE9BRF9QVUJMSUNfJykgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnZhbHVlcyxcbiAgICAgICAgICAgICAgW2Bwcm9jZXNzLmVudi4ke2tleX1gXTogYCcke3ZhbH0nYCxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdmFsdWVzXG4gICAgICAgIH0sIHt9KSxcbiAgICAgICksXG4gICAgICBuZXcgSHRtbFdlYnBhY2tQbHVnaW4oe1xuICAgICAgICBmaWxlbmFtZTogcGF0aC5ub3JtYWxpemUoJy4vaW5kZXguaHRtbCcpLFxuICAgICAgICB0ZW1wbGF0ZTogcGF5bG9hZENvbmZpZy5hZG1pbi5pbmRleEhUTUwsXG4gICAgICB9KSxcbiAgICBdLFxuICAgIHJlc29sdmU6IHtcbiAgICAgIGFsaWFzOiB7XG4gICAgICAgICdAcGF5bG9hZGNtcy9idW5kbGVyLXdlYnBhY2snOiBtb2NrTW9kdWxlUGF0aCxcbiAgICAgICAgZG90ZW52OiBtb2NrRG90RU5WUGF0aCxcbiAgICAgICAgcGF0aDogcmVxdWlyZS5yZXNvbHZlKCdwYXRoLWJyb3dzZXJpZnknKSxcbiAgICAgICAgcGF5bG9hZCQ6IG1vY2tNb2R1bGVQYXRoLFxuICAgICAgICAncGF5bG9hZC1jb25maWcnOiBwYXlsb2FkQ29uZmlnLnBhdGhzLnJhd0NvbmZpZyxcbiAgICAgICAgJ3BheWxvYWQtdXNlci1jc3MnOiBwYXlsb2FkQ29uZmlnLmFkbWluLmNzcyxcbiAgICAgIH0sXG4gICAgICBleHRlbnNpb25zOiBbJy50cycsICcudHN4JywgJy5qcycsICcuanNvbiddLFxuICAgICAgZmFsbGJhY2s6IHtcbiAgICAgICAgY3J5cHRvOiBmYWxzZSxcbiAgICAgICAgaHR0cDogZmFsc2UsXG4gICAgICAgIGh0dHBzOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBtb2R1bGVzOiBbJ25vZGVfbW9kdWxlcycsIG5vZGVNb2R1bGVzUGF0aCwgcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uLy4uL25vZGVfbW9kdWxlcycpXSxcbiAgICB9LFxuICB9XG5cbiAgcmV0dXJuIGNvbmZpZ1xufVxuIl0sIm5hbWVzIjpbImdldEJhc2VDb25maWciLCJtb2NrTW9kdWxlUGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwibW9ja0RvdEVOVlBhdGgiLCJub2RlTW9kdWxlc1BhdGhzIiwiZmluZE5vZGVNb2R1bGVzIiwiY3dkIiwicHJvY2VzcyIsInJlbGF0aXZlIiwicGF5bG9hZENvbmZpZyIsIm5vZGVNb2R1bGVzUGF0aCIsImZpbmQiLCJwIiwiZ3Vlc3MiLCJmcyIsImV4aXN0c1N5bmMiLCJhZG1pbkZvbGRlclBhdGgiLCJjb25maWciLCJlbnRyeSIsIm1haW4iLCJtb2R1bGUiLCJydWxlcyIsImV4Y2x1ZGUiLCJ0ZXN0IiwidXNlIiwibG9hZGVyIiwicmVxdWlyZSIsIm9wdGlvbnMiLCJqc2MiLCJwYXJzZXIiLCJzeW50YXgiLCJ0c3giLCJvbmVPZiIsInR5cGUiLCJwbHVnaW5zIiwid2VicGFjayIsIlByb3ZpZGVQbHVnaW4iLCJEZWZpbmVQbHVnaW4iLCJPYmplY3QiLCJlbnRyaWVzIiwiZW52IiwicmVkdWNlIiwidmFsdWVzIiwia2V5IiwidmFsIiwiaW5kZXhPZiIsIkh0bWxXZWJwYWNrUGx1Z2luIiwiZmlsZW5hbWUiLCJub3JtYWxpemUiLCJ0ZW1wbGF0ZSIsImFkbWluIiwiaW5kZXhIVE1MIiwiYWxpYXMiLCJkb3RlbnYiLCJwYXlsb2FkJCIsInBhdGhzIiwicmF3Q29uZmlnIiwiY3NzIiwiZXh0ZW5zaW9ucyIsImZhbGxiYWNrIiwiY3J5cHRvIiwiaHR0cCIsImh0dHBzIiwibW9kdWxlcyJdLCJtYXBwaW5ncyI6Ijs7OzsrQkFjYUE7OztlQUFBQTs7O3dFQVhlOzJEQUNiOzBFQUNlOzZEQUNiO2dFQUNHOzs7Ozs7QUFFcEIsTUFBTUMsaUJBQWlCQyxhQUFJLENBQUNDLE9BQU8sQ0FBQ0MsV0FBVztBQUMvQyxNQUFNQyxpQkFBaUJILGFBQUksQ0FBQ0MsT0FBTyxDQUFDQyxXQUFXO0FBRS9DLE1BQU1FLG1CQUFtQkMsSUFBQUEsd0JBQWUsRUFBQztJQUFFQyxLQUFLQyxRQUFRRCxHQUFHO0lBQUlFLFVBQVU7QUFBTTtBQUV4RSxNQUFNVixnQkFBZ0IsQ0FBQ1c7SUFDNUIsSUFBSUMsa0JBQWtCTixpQkFBaUJPLElBQUksQ0FBQyxDQUFDQztRQUMzQyxNQUFNQyxRQUFRYixhQUFJLENBQUNDLE9BQU8sQ0FBQ1csR0FBRztRQUM5QixJQUFJRSxXQUFFLENBQUNDLFVBQVUsQ0FBQ0YsUUFBUTtZQUN4QixPQUFPO1FBQ1Q7UUFDQSxPQUFPO0lBQ1Q7SUFFQSxJQUFJLENBQUNILGlCQUFpQjtRQUNwQkEsa0JBQWtCSCxRQUFRRCxHQUFHO0lBQy9CO0lBRUEsTUFBTVUsa0JBQWtCaEIsYUFBSSxDQUFDQyxPQUFPLENBQUNTLGlCQUFpQjtJQUV0RCxNQUFNTyxTQUF3QjtRQUM1QkMsT0FBTztZQUNMQyxNQUFNO2dCQUFDSDthQUFnQjtRQUN6QjtRQUNBSSxRQUFRO1lBQ05DLE9BQU87Z0JBQ0w7b0JBQ0VDLFNBQVM7b0JBQ1RDLE1BQU07b0JBQ05DLEtBQUs7d0JBQ0g7NEJBQ0VDLFFBQVFDLFFBQVF6QixPQUFPLENBQUM7NEJBQ3hCMEIsU0FBUztnQ0FDUEMsS0FBSztvQ0FDSEMsUUFBUTt3Q0FDTkMsUUFBUTt3Q0FDUkMsS0FBSztvQ0FDUDtnQ0FDRjs0QkFDRjt3QkFDRjtxQkFDRDtnQkFDSDtnQkFDQTtvQkFDRUMsT0FBTzt3QkFDTDs0QkFDRVQsTUFBTTs0QkFDTlUsTUFBTTt3QkFDUjtxQkFDRDtnQkFDSDthQUNEO1FBQ0g7UUFDQUMsU0FBUztZQUNQLElBQUlDLGdCQUFPLENBQUNDLGFBQWEsQ0FBQztnQkFBRTdCLFNBQVNtQixRQUFRekIsT0FBTyxDQUFDO1lBQW1CO1lBQ3hFLElBQUlrQyxnQkFBTyxDQUFDRSxZQUFZLENBQ3RCQyxPQUFPQyxPQUFPLENBQUNoQyxRQUFRaUMsR0FBRyxFQUFFQyxNQUFNLENBQUMsQ0FBQ0MsUUFBUSxDQUFDQyxLQUFLQyxJQUFJO2dCQUNwRCxJQUFJRCxJQUFJRSxPQUFPLENBQUMsdUJBQXVCLEdBQUc7b0JBQ3hDLE9BQU87d0JBQ0wsR0FBR0gsTUFBTTt3QkFDVCxDQUFDLENBQUMsWUFBWSxFQUFFQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFQyxJQUFJLENBQUMsQ0FBQztvQkFDcEM7Z0JBQ0Y7Z0JBRUEsT0FBT0Y7WUFDVCxHQUFHLENBQUM7WUFFTixJQUFJSSwwQkFBaUIsQ0FBQztnQkFDcEJDLFVBQVUvQyxhQUFJLENBQUNnRCxTQUFTLENBQUM7Z0JBQ3pCQyxVQUFVeEMsY0FBY3lDLEtBQUssQ0FBQ0MsU0FBUztZQUN6QztTQUNEO1FBQ0RsRCxTQUFTO1lBQ1BtRCxPQUFPO2dCQUNMLCtCQUErQnJEO2dCQUMvQnNELFFBQVFsRDtnQkFDUkgsTUFBTTBCLFFBQVF6QixPQUFPLENBQUM7Z0JBQ3RCcUQsVUFBVXZEO2dCQUNWLGtCQUFrQlUsY0FBYzhDLEtBQUssQ0FBQ0MsU0FBUztnQkFDL0Msb0JBQW9CL0MsY0FBY3lDLEtBQUssQ0FBQ08sR0FBRztZQUM3QztZQUNBQyxZQUFZO2dCQUFDO2dCQUFPO2dCQUFRO2dCQUFPO2FBQVE7WUFDM0NDLFVBQVU7Z0JBQ1JDLFFBQVE7Z0JBQ1JDLE1BQU07Z0JBQ05DLE9BQU87WUFDVDtZQUNBQyxTQUFTO2dCQUFDO2dCQUFnQnJEO2dCQUFpQlYsYUFBSSxDQUFDQyxPQUFPLENBQUNDLFdBQVc7YUFBc0I7UUFDM0Y7SUFDRjtJQUVBLE9BQU9lO0FBQ1QifQ==