"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _mongoosepaginatev2 = /*#__PURE__*/ _interop_require_default(require("mongoose-paginate-v2"));
const _buildQuery = /*#__PURE__*/ _interop_require_default(require("../queries/buildQuery"));
const _buildSchema = /*#__PURE__*/ _interop_require_default(require("./buildSchema"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const buildCollectionSchema = (collection, config, schemaOptions = {})=>{
    const schema = (0, _buildSchema.default)(config, collection.fields, {
        draftsEnabled: Boolean(typeof collection?.versions === 'object' && collection.versions.drafts),
        indexSortableFields: config.indexSortableFields,
        options: {
            minimize: false,
            timestamps: collection.timestamps !== false,
            ...schemaOptions
        }
    });
    if (config.indexSortableFields && collection.timestamps !== false) {
        schema.index({
            updatedAt: 1
        });
        schema.index({
            createdAt: 1
        });
    }
    schema.plugin(_mongoosepaginatev2.default, {
        useEstimatedCount: true
    }).plugin((0, _buildQuery.default)({
        collectionSlug: collection.slug
    }));
    return schema;
};
const _default = buildCollectionSchema;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RlbHMvYnVpbGRDb2xsZWN0aW9uU2NoZW1hLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUGFnaW5hdGVPcHRpb25zLCBTY2hlbWEgfSBmcm9tICdtb25nb29zZSdcbmltcG9ydCB0eXBlIHsgU2FuaXRpemVkQ29uZmlnIH0gZnJvbSAncGF5bG9hZC9jb25maWcnXG5pbXBvcnQgdHlwZSB7IFNhbml0aXplZENvbGxlY3Rpb25Db25maWcgfSBmcm9tICdwYXlsb2FkL3R5cGVzJ1xuXG5pbXBvcnQgcGFnaW5hdGUgZnJvbSAnbW9uZ29vc2UtcGFnaW5hdGUtdjInXG5cbmltcG9ydCBnZXRCdWlsZFF1ZXJ5UGx1Z2luIGZyb20gJy4uL3F1ZXJpZXMvYnVpbGRRdWVyeSdcbmltcG9ydCBidWlsZFNjaGVtYSBmcm9tICcuL2J1aWxkU2NoZW1hJ1xuXG5jb25zdCBidWlsZENvbGxlY3Rpb25TY2hlbWEgPSAoXG4gIGNvbGxlY3Rpb246IFNhbml0aXplZENvbGxlY3Rpb25Db25maWcsXG4gIGNvbmZpZzogU2FuaXRpemVkQ29uZmlnLFxuICBzY2hlbWFPcHRpb25zID0ge30sXG4pOiBTY2hlbWEgPT4ge1xuICBjb25zdCBzY2hlbWEgPSBidWlsZFNjaGVtYShjb25maWcsIGNvbGxlY3Rpb24uZmllbGRzLCB7XG4gICAgZHJhZnRzRW5hYmxlZDogQm9vbGVhbih0eXBlb2YgY29sbGVjdGlvbj8udmVyc2lvbnMgPT09ICdvYmplY3QnICYmIGNvbGxlY3Rpb24udmVyc2lvbnMuZHJhZnRzKSxcbiAgICBpbmRleFNvcnRhYmxlRmllbGRzOiBjb25maWcuaW5kZXhTb3J0YWJsZUZpZWxkcyxcbiAgICBvcHRpb25zOiB7XG4gICAgICBtaW5pbWl6ZTogZmFsc2UsXG4gICAgICB0aW1lc3RhbXBzOiBjb2xsZWN0aW9uLnRpbWVzdGFtcHMgIT09IGZhbHNlLFxuICAgICAgLi4uc2NoZW1hT3B0aW9ucyxcbiAgICB9LFxuICB9KVxuXG4gIGlmIChjb25maWcuaW5kZXhTb3J0YWJsZUZpZWxkcyAmJiBjb2xsZWN0aW9uLnRpbWVzdGFtcHMgIT09IGZhbHNlKSB7XG4gICAgc2NoZW1hLmluZGV4KHsgdXBkYXRlZEF0OiAxIH0pXG4gICAgc2NoZW1hLmluZGV4KHsgY3JlYXRlZEF0OiAxIH0pXG4gIH1cblxuICBzY2hlbWFcbiAgICAucGx1Z2luPGFueSwgUGFnaW5hdGVPcHRpb25zPihwYWdpbmF0ZSwgeyB1c2VFc3RpbWF0ZWRDb3VudDogdHJ1ZSB9KVxuICAgIC5wbHVnaW4oZ2V0QnVpbGRRdWVyeVBsdWdpbih7IGNvbGxlY3Rpb25TbHVnOiBjb2xsZWN0aW9uLnNsdWcgfSkpXG5cbiAgcmV0dXJuIHNjaGVtYVxufVxuXG5leHBvcnQgZGVmYXVsdCBidWlsZENvbGxlY3Rpb25TY2hlbWFcbiJdLCJuYW1lcyI6WyJidWlsZENvbGxlY3Rpb25TY2hlbWEiLCJjb2xsZWN0aW9uIiwiY29uZmlnIiwic2NoZW1hT3B0aW9ucyIsInNjaGVtYSIsImJ1aWxkU2NoZW1hIiwiZmllbGRzIiwiZHJhZnRzRW5hYmxlZCIsIkJvb2xlYW4iLCJ2ZXJzaW9ucyIsImRyYWZ0cyIsImluZGV4U29ydGFibGVGaWVsZHMiLCJvcHRpb25zIiwibWluaW1pemUiLCJ0aW1lc3RhbXBzIiwiaW5kZXgiLCJ1cGRhdGVkQXQiLCJjcmVhdGVkQXQiLCJwbHVnaW4iLCJwYWdpbmF0ZSIsInVzZUVzdGltYXRlZENvdW50IiwiZ2V0QnVpbGRRdWVyeVBsdWdpbiIsImNvbGxlY3Rpb25TbHVnIiwic2x1ZyJdLCJtYXBwaW5ncyI6Ijs7OzsrQkFvQ0E7OztlQUFBOzs7MkVBaENxQjttRUFFVztvRUFDUjs7Ozs7O0FBRXhCLE1BQU1BLHdCQUF3QixDQUM1QkMsWUFDQUMsUUFDQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUVsQixNQUFNQyxTQUFTQyxJQUFBQSxvQkFBVyxFQUFDSCxRQUFRRCxXQUFXSyxNQUFNLEVBQUU7UUFDcERDLGVBQWVDLFFBQVEsT0FBT1AsWUFBWVEsYUFBYSxZQUFZUixXQUFXUSxRQUFRLENBQUNDLE1BQU07UUFDN0ZDLHFCQUFxQlQsT0FBT1MsbUJBQW1CO1FBQy9DQyxTQUFTO1lBQ1BDLFVBQVU7WUFDVkMsWUFBWWIsV0FBV2EsVUFBVSxLQUFLO1lBQ3RDLEdBQUdYLGFBQWE7UUFDbEI7SUFDRjtJQUVBLElBQUlELE9BQU9TLG1CQUFtQixJQUFJVixXQUFXYSxVQUFVLEtBQUssT0FBTztRQUNqRVYsT0FBT1csS0FBSyxDQUFDO1lBQUVDLFdBQVc7UUFBRTtRQUM1QlosT0FBT1csS0FBSyxDQUFDO1lBQUVFLFdBQVc7UUFBRTtJQUM5QjtJQUVBYixPQUNHYyxNQUFNLENBQXVCQywyQkFBUSxFQUFFO1FBQUVDLG1CQUFtQjtJQUFLLEdBQ2pFRixNQUFNLENBQUNHLElBQUFBLG1CQUFtQixFQUFDO1FBQUVDLGdCQUFnQnJCLFdBQVdzQixJQUFJO0lBQUM7SUFFaEUsT0FBT25CO0FBQ1Q7TUFFQSxXQUFlSiJ9