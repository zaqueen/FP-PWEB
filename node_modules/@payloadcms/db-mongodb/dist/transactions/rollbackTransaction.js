"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "rollbackTransaction", {
    enumerable: true,
    get: function() {
        return rollbackTransaction;
    }
});
const rollbackTransaction = async function rollbackTransaction(id = '') {
    // if multiple operations are using the same transaction, the first will flow through and delete the session.
    // subsequent calls should be ignored.
    if (!this.sessions[id]) {
        return;
    }
    // when session exists but is not inTransaction something unexpected is happening to the session
    if (!this.sessions[id].inTransaction()) {
        this.payload.logger.warn('rollbackTransaction called when no transaction exists');
        delete this.sessions[id];
        return;
    }
    // the first call for rollback should be aborted and deleted causing any other operations with the same transaction to fail
    await this.sessions[id].abortTransaction();
    await this.sessions[id].endSession();
    delete this.sessions[id];
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90cmFuc2FjdGlvbnMvcm9sbGJhY2tUcmFuc2FjdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFJvbGxiYWNrVHJhbnNhY3Rpb24gfSBmcm9tICdwYXlsb2FkL2RhdGFiYXNlJ1xuXG5leHBvcnQgY29uc3Qgcm9sbGJhY2tUcmFuc2FjdGlvbjogUm9sbGJhY2tUcmFuc2FjdGlvbiA9IGFzeW5jIGZ1bmN0aW9uIHJvbGxiYWNrVHJhbnNhY3Rpb24oXG4gIGlkID0gJycsXG4pIHtcbiAgLy8gaWYgbXVsdGlwbGUgb3BlcmF0aW9ucyBhcmUgdXNpbmcgdGhlIHNhbWUgdHJhbnNhY3Rpb24sIHRoZSBmaXJzdCB3aWxsIGZsb3cgdGhyb3VnaCBhbmQgZGVsZXRlIHRoZSBzZXNzaW9uLlxuICAvLyBzdWJzZXF1ZW50IGNhbGxzIHNob3VsZCBiZSBpZ25vcmVkLlxuICBpZiAoIXRoaXMuc2Vzc2lvbnNbaWRdKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICAvLyB3aGVuIHNlc3Npb24gZXhpc3RzIGJ1dCBpcyBub3QgaW5UcmFuc2FjdGlvbiBzb21ldGhpbmcgdW5leHBlY3RlZCBpcyBoYXBwZW5pbmcgdG8gdGhlIHNlc3Npb25cbiAgaWYgKCF0aGlzLnNlc3Npb25zW2lkXS5pblRyYW5zYWN0aW9uKCkpIHtcbiAgICB0aGlzLnBheWxvYWQubG9nZ2VyLndhcm4oJ3JvbGxiYWNrVHJhbnNhY3Rpb24gY2FsbGVkIHdoZW4gbm8gdHJhbnNhY3Rpb24gZXhpc3RzJylcbiAgICBkZWxldGUgdGhpcy5zZXNzaW9uc1tpZF1cbiAgICByZXR1cm5cbiAgfVxuXG4gIC8vIHRoZSBmaXJzdCBjYWxsIGZvciByb2xsYmFjayBzaG91bGQgYmUgYWJvcnRlZCBhbmQgZGVsZXRlZCBjYXVzaW5nIGFueSBvdGhlciBvcGVyYXRpb25zIHdpdGggdGhlIHNhbWUgdHJhbnNhY3Rpb24gdG8gZmFpbFxuICBhd2FpdCB0aGlzLnNlc3Npb25zW2lkXS5hYm9ydFRyYW5zYWN0aW9uKClcbiAgYXdhaXQgdGhpcy5zZXNzaW9uc1tpZF0uZW5kU2Vzc2lvbigpXG4gIGRlbGV0ZSB0aGlzLnNlc3Npb25zW2lkXVxufVxuIl0sIm5hbWVzIjpbInJvbGxiYWNrVHJhbnNhY3Rpb24iLCJpZCIsInNlc3Npb25zIiwiaW5UcmFuc2FjdGlvbiIsInBheWxvYWQiLCJsb2dnZXIiLCJ3YXJuIiwiYWJvcnRUcmFuc2FjdGlvbiIsImVuZFNlc3Npb24iXSwibWFwcGluZ3MiOiI7Ozs7K0JBRWFBOzs7ZUFBQUE7OztBQUFOLE1BQU1BLHNCQUEyQyxlQUFlQSxvQkFDckVDLEtBQUssRUFBRTtJQUVQLDZHQUE2RztJQUM3RyxzQ0FBc0M7SUFDdEMsSUFBSSxDQUFDLElBQUksQ0FBQ0MsUUFBUSxDQUFDRCxHQUFHLEVBQUU7UUFDdEI7SUFDRjtJQUVBLGdHQUFnRztJQUNoRyxJQUFJLENBQUMsSUFBSSxDQUFDQyxRQUFRLENBQUNELEdBQUcsQ0FBQ0UsYUFBYSxJQUFJO1FBQ3RDLElBQUksQ0FBQ0MsT0FBTyxDQUFDQyxNQUFNLENBQUNDLElBQUksQ0FBQztRQUN6QixPQUFPLElBQUksQ0FBQ0osUUFBUSxDQUFDRCxHQUFHO1FBQ3hCO0lBQ0Y7SUFFQSwySEFBMkg7SUFDM0gsTUFBTSxJQUFJLENBQUNDLFFBQVEsQ0FBQ0QsR0FBRyxDQUFDTSxnQkFBZ0I7SUFDeEMsTUFBTSxJQUFJLENBQUNMLFFBQVEsQ0FBQ0QsR0FBRyxDQUFDTyxVQUFVO0lBQ2xDLE9BQU8sSUFBSSxDQUFDTixRQUFRLENBQUNELEdBQUc7QUFDMUIifQ==