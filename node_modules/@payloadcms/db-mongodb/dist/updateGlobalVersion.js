"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "updateGlobalVersion", {
    enumerable: true,
    get: function() {
        return updateGlobalVersion;
    }
});
const _withSession = require("./withSession");
async function updateGlobalVersion({ id, global, locale, req = {}, versionData, where }) {
    const VersionModel = this.versions[global];
    const whereToUse = where || {
        id: {
            equals: id
        }
    };
    const options = {
        ...(0, _withSession.withSession)(this, req.transactionID),
        lean: true,
        new: true
    };
    const query = await VersionModel.buildQuery({
        locale,
        payload: this.payload,
        where: whereToUse
    });
    const doc = await VersionModel.findOneAndUpdate(query, versionData, options);
    const result = JSON.parse(JSON.stringify(doc));
    const verificationToken = doc._verificationToken;
    // custom id type reset
    result.id = result._id;
    if (verificationToken) {
        result._verificationToken = verificationToken;
    }
    return result;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91cGRhdGVHbG9iYWxWZXJzaW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgVXBkYXRlR2xvYmFsVmVyc2lvbkFyZ3MgfSBmcm9tICdwYXlsb2FkL2RhdGFiYXNlJ1xuaW1wb3J0IHR5cGUgeyBQYXlsb2FkUmVxdWVzdCwgVHlwZVdpdGhJRCB9IGZyb20gJ3BheWxvYWQvdHlwZXMnXG5cbmltcG9ydCB0eXBlIHsgTW9uZ29vc2VBZGFwdGVyIH0gZnJvbSAnLidcblxuaW1wb3J0IHsgd2l0aFNlc3Npb24gfSBmcm9tICcuL3dpdGhTZXNzaW9uJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlR2xvYmFsVmVyc2lvbjxUIGV4dGVuZHMgVHlwZVdpdGhJRD4oXG4gIHRoaXM6IE1vbmdvb3NlQWRhcHRlcixcbiAge1xuICAgIGlkLFxuICAgIGdsb2JhbCxcbiAgICBsb2NhbGUsXG4gICAgcmVxID0ge30gYXMgUGF5bG9hZFJlcXVlc3QsXG4gICAgdmVyc2lvbkRhdGEsXG4gICAgd2hlcmUsXG4gIH06IFVwZGF0ZUdsb2JhbFZlcnNpb25BcmdzPFQ+LFxuKSB7XG4gIGNvbnN0IFZlcnNpb25Nb2RlbCA9IHRoaXMudmVyc2lvbnNbZ2xvYmFsXVxuICBjb25zdCB3aGVyZVRvVXNlID0gd2hlcmUgfHwgeyBpZDogeyBlcXVhbHM6IGlkIH0gfVxuICBjb25zdCBvcHRpb25zID0ge1xuICAgIC4uLndpdGhTZXNzaW9uKHRoaXMsIHJlcS50cmFuc2FjdGlvbklEKSxcbiAgICBsZWFuOiB0cnVlLFxuICAgIG5ldzogdHJ1ZSxcbiAgfVxuXG4gIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgVmVyc2lvbk1vZGVsLmJ1aWxkUXVlcnkoe1xuICAgIGxvY2FsZSxcbiAgICBwYXlsb2FkOiB0aGlzLnBheWxvYWQsXG4gICAgd2hlcmU6IHdoZXJlVG9Vc2UsXG4gIH0pXG5cbiAgY29uc3QgZG9jID0gYXdhaXQgVmVyc2lvbk1vZGVsLmZpbmRPbmVBbmRVcGRhdGUocXVlcnksIHZlcnNpb25EYXRhLCBvcHRpb25zKVxuXG4gIGNvbnN0IHJlc3VsdCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZG9jKSlcblxuICBjb25zdCB2ZXJpZmljYXRpb25Ub2tlbiA9IGRvYy5fdmVyaWZpY2F0aW9uVG9rZW5cblxuICAvLyBjdXN0b20gaWQgdHlwZSByZXNldFxuICByZXN1bHQuaWQgPSByZXN1bHQuX2lkXG4gIGlmICh2ZXJpZmljYXRpb25Ub2tlbikge1xuICAgIHJlc3VsdC5fdmVyaWZpY2F0aW9uVG9rZW4gPSB2ZXJpZmljYXRpb25Ub2tlblxuICB9XG4gIHJldHVybiByZXN1bHRcbn1cbiJdLCJuYW1lcyI6WyJ1cGRhdGVHbG9iYWxWZXJzaW9uIiwiaWQiLCJnbG9iYWwiLCJsb2NhbGUiLCJyZXEiLCJ2ZXJzaW9uRGF0YSIsIndoZXJlIiwiVmVyc2lvbk1vZGVsIiwidmVyc2lvbnMiLCJ3aGVyZVRvVXNlIiwiZXF1YWxzIiwib3B0aW9ucyIsIndpdGhTZXNzaW9uIiwidHJhbnNhY3Rpb25JRCIsImxlYW4iLCJuZXciLCJxdWVyeSIsImJ1aWxkUXVlcnkiLCJwYXlsb2FkIiwiZG9jIiwiZmluZE9uZUFuZFVwZGF0ZSIsInJlc3VsdCIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsInZlcmlmaWNhdGlvblRva2VuIiwiX3ZlcmlmaWNhdGlvblRva2VuIiwiX2lkIl0sIm1hcHBpbmdzIjoiOzs7OytCQU9zQkE7OztlQUFBQTs7OzZCQUZNO0FBRXJCLGVBQWVBLG9CQUVwQixFQUNFQyxFQUFFLEVBQ0ZDLE1BQU0sRUFDTkMsTUFBTSxFQUNOQyxNQUFNLENBQUMsQ0FBbUIsRUFDMUJDLFdBQVcsRUFDWEMsS0FBSyxFQUNzQjtJQUU3QixNQUFNQyxlQUFlLElBQUksQ0FBQ0MsUUFBUSxDQUFDTixPQUFPO0lBQzFDLE1BQU1PLGFBQWFILFNBQVM7UUFBRUwsSUFBSTtZQUFFUyxRQUFRVDtRQUFHO0lBQUU7SUFDakQsTUFBTVUsVUFBVTtRQUNkLEdBQUdDLElBQUFBLHdCQUFXLEVBQUMsSUFBSSxFQUFFUixJQUFJUyxhQUFhLENBQUM7UUFDdkNDLE1BQU07UUFDTkMsS0FBSztJQUNQO0lBRUEsTUFBTUMsUUFBUSxNQUFNVCxhQUFhVSxVQUFVLENBQUM7UUFDMUNkO1FBQ0FlLFNBQVMsSUFBSSxDQUFDQSxPQUFPO1FBQ3JCWixPQUFPRztJQUNUO0lBRUEsTUFBTVUsTUFBTSxNQUFNWixhQUFhYSxnQkFBZ0IsQ0FBQ0osT0FBT1gsYUFBYU07SUFFcEUsTUFBTVUsU0FBU0MsS0FBS0MsS0FBSyxDQUFDRCxLQUFLRSxTQUFTLENBQUNMO0lBRXpDLE1BQU1NLG9CQUFvQk4sSUFBSU8sa0JBQWtCO0lBRWhELHVCQUF1QjtJQUN2QkwsT0FBT3BCLEVBQUUsR0FBR29CLE9BQU9NLEdBQUc7SUFDdEIsSUFBSUYsbUJBQW1CO1FBQ3JCSixPQUFPSyxrQkFBa0IsR0FBR0Q7SUFDOUI7SUFDQSxPQUFPSjtBQUNUIn0=