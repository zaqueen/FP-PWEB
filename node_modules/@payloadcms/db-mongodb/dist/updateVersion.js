"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "updateVersion", {
    enumerable: true,
    get: function() {
        return updateVersion;
    }
});
const _withSession = require("./withSession");
const updateVersion = async function updateVersion({ id, collection, locale, req = {}, versionData, where }) {
    const VersionModel = this.versions[collection];
    const whereToUse = where || {
        id: {
            equals: id
        }
    };
    const options = {
        ...(0, _withSession.withSession)(this, req.transactionID),
        lean: true,
        new: true
    };
    const query = await VersionModel.buildQuery({
        locale,
        payload: this.payload,
        where: whereToUse
    });
    const doc = await VersionModel.findOneAndUpdate(query, versionData, options);
    const result = JSON.parse(JSON.stringify(doc));
    const verificationToken = doc._verificationToken;
    // custom id type reset
    result.id = result._id;
    if (verificationToken) {
        result._verificationToken = verificationToken;
    }
    return result;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91cGRhdGVWZXJzaW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgVXBkYXRlVmVyc2lvbiB9IGZyb20gJ3BheWxvYWQvZGF0YWJhc2UnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWRSZXF1ZXN0IH0gZnJvbSAncGF5bG9hZC90eXBlcydcblxuaW1wb3J0IHR5cGUgeyBNb25nb29zZUFkYXB0ZXIgfSBmcm9tICcuJ1xuXG5pbXBvcnQgeyB3aXRoU2Vzc2lvbiB9IGZyb20gJy4vd2l0aFNlc3Npb24nXG5cbmV4cG9ydCBjb25zdCB1cGRhdGVWZXJzaW9uOiBVcGRhdGVWZXJzaW9uID0gYXN5bmMgZnVuY3Rpb24gdXBkYXRlVmVyc2lvbihcbiAgdGhpczogTW9uZ29vc2VBZGFwdGVyLFxuICB7IGlkLCBjb2xsZWN0aW9uLCBsb2NhbGUsIHJlcSA9IHt9IGFzIFBheWxvYWRSZXF1ZXN0LCB2ZXJzaW9uRGF0YSwgd2hlcmUgfSxcbikge1xuICBjb25zdCBWZXJzaW9uTW9kZWwgPSB0aGlzLnZlcnNpb25zW2NvbGxlY3Rpb25dXG4gIGNvbnN0IHdoZXJlVG9Vc2UgPSB3aGVyZSB8fCB7IGlkOiB7IGVxdWFsczogaWQgfSB9XG4gIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgLi4ud2l0aFNlc3Npb24odGhpcywgcmVxLnRyYW5zYWN0aW9uSUQpLFxuICAgIGxlYW46IHRydWUsXG4gICAgbmV3OiB0cnVlLFxuICB9XG5cbiAgY29uc3QgcXVlcnkgPSBhd2FpdCBWZXJzaW9uTW9kZWwuYnVpbGRRdWVyeSh7XG4gICAgbG9jYWxlLFxuICAgIHBheWxvYWQ6IHRoaXMucGF5bG9hZCxcbiAgICB3aGVyZTogd2hlcmVUb1VzZSxcbiAgfSlcblxuICBjb25zdCBkb2MgPSBhd2FpdCBWZXJzaW9uTW9kZWwuZmluZE9uZUFuZFVwZGF0ZShxdWVyeSwgdmVyc2lvbkRhdGEsIG9wdGlvbnMpXG5cbiAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkb2MpKVxuXG4gIGNvbnN0IHZlcmlmaWNhdGlvblRva2VuID0gZG9jLl92ZXJpZmljYXRpb25Ub2tlblxuXG4gIC8vIGN1c3RvbSBpZCB0eXBlIHJlc2V0XG4gIHJlc3VsdC5pZCA9IHJlc3VsdC5faWRcbiAgaWYgKHZlcmlmaWNhdGlvblRva2VuKSB7XG4gICAgcmVzdWx0Ll92ZXJpZmljYXRpb25Ub2tlbiA9IHZlcmlmaWNhdGlvblRva2VuXG4gIH1cbiAgcmV0dXJuIHJlc3VsdFxufVxuIl0sIm5hbWVzIjpbInVwZGF0ZVZlcnNpb24iLCJpZCIsImNvbGxlY3Rpb24iLCJsb2NhbGUiLCJyZXEiLCJ2ZXJzaW9uRGF0YSIsIndoZXJlIiwiVmVyc2lvbk1vZGVsIiwidmVyc2lvbnMiLCJ3aGVyZVRvVXNlIiwiZXF1YWxzIiwib3B0aW9ucyIsIndpdGhTZXNzaW9uIiwidHJhbnNhY3Rpb25JRCIsImxlYW4iLCJuZXciLCJxdWVyeSIsImJ1aWxkUXVlcnkiLCJwYXlsb2FkIiwiZG9jIiwiZmluZE9uZUFuZFVwZGF0ZSIsInJlc3VsdCIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsInZlcmlmaWNhdGlvblRva2VuIiwiX3ZlcmlmaWNhdGlvblRva2VuIiwiX2lkIl0sIm1hcHBpbmdzIjoiOzs7OytCQU9hQTs7O2VBQUFBOzs7NkJBRmU7QUFFckIsTUFBTUEsZ0JBQStCLGVBQWVBLGNBRXpELEVBQUVDLEVBQUUsRUFBRUMsVUFBVSxFQUFFQyxNQUFNLEVBQUVDLE1BQU0sQ0FBQyxDQUFtQixFQUFFQyxXQUFXLEVBQUVDLEtBQUssRUFBRTtJQUUxRSxNQUFNQyxlQUFlLElBQUksQ0FBQ0MsUUFBUSxDQUFDTixXQUFXO0lBQzlDLE1BQU1PLGFBQWFILFNBQVM7UUFBRUwsSUFBSTtZQUFFUyxRQUFRVDtRQUFHO0lBQUU7SUFDakQsTUFBTVUsVUFBVTtRQUNkLEdBQUdDLElBQUFBLHdCQUFXLEVBQUMsSUFBSSxFQUFFUixJQUFJUyxhQUFhLENBQUM7UUFDdkNDLE1BQU07UUFDTkMsS0FBSztJQUNQO0lBRUEsTUFBTUMsUUFBUSxNQUFNVCxhQUFhVSxVQUFVLENBQUM7UUFDMUNkO1FBQ0FlLFNBQVMsSUFBSSxDQUFDQSxPQUFPO1FBQ3JCWixPQUFPRztJQUNUO0lBRUEsTUFBTVUsTUFBTSxNQUFNWixhQUFhYSxnQkFBZ0IsQ0FBQ0osT0FBT1gsYUFBYU07SUFFcEUsTUFBTVUsU0FBU0MsS0FBS0MsS0FBSyxDQUFDRCxLQUFLRSxTQUFTLENBQUNMO0lBRXpDLE1BQU1NLG9CQUFvQk4sSUFBSU8sa0JBQWtCO0lBRWhELHVCQUF1QjtJQUN2QkwsT0FBT3BCLEVBQUUsR0FBR29CLE9BQU9NLEdBQUc7SUFDdEIsSUFBSUYsbUJBQW1CO1FBQ3JCSixPQUFPSyxrQkFBa0IsR0FBR0Q7SUFDOUI7SUFDQSxPQUFPSjtBQUNUIn0=