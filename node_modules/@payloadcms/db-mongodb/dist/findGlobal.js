"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "findGlobal", {
    enumerable: true,
    get: function() {
        return findGlobal;
    }
});
const _database = require("payload/database");
const _sanitizeInternalFields = /*#__PURE__*/ _interop_require_default(require("./utilities/sanitizeInternalFields"));
const _withSession = require("./withSession");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const findGlobal = async function findGlobal({ locale, req = {}, slug, where }) {
    const Model = this.globals;
    const options = {
        ...(0, _withSession.withSession)(this, req.transactionID),
        lean: true
    };
    const query = await Model.buildQuery({
        globalSlug: slug,
        locale,
        payload: this.payload,
        where: (0, _database.combineQueries)({
            globalType: {
                equals: slug
            }
        }, where)
    });
    let doc = await Model.findOne(query, {}, options);
    if (!doc) {
        return null;
    }
    if (doc._id) {
        doc.id = doc._id;
        delete doc._id;
    }
    doc = JSON.parse(JSON.stringify(doc));
    doc = (0, _sanitizeInternalFields.default)(doc);
    return doc;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9maW5kR2xvYmFsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgRmluZEdsb2JhbCB9IGZyb20gJ3BheWxvYWQvZGF0YWJhc2UnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWRSZXF1ZXN0IH0gZnJvbSAncGF5bG9hZC90eXBlcydcblxuaW1wb3J0IHsgY29tYmluZVF1ZXJpZXMgfSBmcm9tICdwYXlsb2FkL2RhdGFiYXNlJ1xuXG5pbXBvcnQgdHlwZSB7IE1vbmdvb3NlQWRhcHRlciB9IGZyb20gJy4nXG5cbmltcG9ydCBzYW5pdGl6ZUludGVybmFsRmllbGRzIGZyb20gJy4vdXRpbGl0aWVzL3Nhbml0aXplSW50ZXJuYWxGaWVsZHMnXG5pbXBvcnQgeyB3aXRoU2Vzc2lvbiB9IGZyb20gJy4vd2l0aFNlc3Npb24nXG5cbmV4cG9ydCBjb25zdCBmaW5kR2xvYmFsOiBGaW5kR2xvYmFsID0gYXN5bmMgZnVuY3Rpb24gZmluZEdsb2JhbChcbiAgdGhpczogTW9uZ29vc2VBZGFwdGVyLFxuICB7IGxvY2FsZSwgcmVxID0ge30gYXMgUGF5bG9hZFJlcXVlc3QsIHNsdWcsIHdoZXJlIH0sXG4pIHtcbiAgY29uc3QgTW9kZWwgPSB0aGlzLmdsb2JhbHNcbiAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAuLi53aXRoU2Vzc2lvbih0aGlzLCByZXEudHJhbnNhY3Rpb25JRCksXG4gICAgbGVhbjogdHJ1ZSxcbiAgfVxuXG4gIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgTW9kZWwuYnVpbGRRdWVyeSh7XG4gICAgZ2xvYmFsU2x1Zzogc2x1ZyxcbiAgICBsb2NhbGUsXG4gICAgcGF5bG9hZDogdGhpcy5wYXlsb2FkLFxuICAgIHdoZXJlOiBjb21iaW5lUXVlcmllcyh7IGdsb2JhbFR5cGU6IHsgZXF1YWxzOiBzbHVnIH0gfSwgd2hlcmUpLFxuICB9KVxuXG4gIGxldCBkb2MgPSAoYXdhaXQgTW9kZWwuZmluZE9uZShxdWVyeSwge30sIG9wdGlvbnMpKSBhcyBhbnlcblxuICBpZiAoIWRvYykge1xuICAgIHJldHVybiBudWxsXG4gIH1cbiAgaWYgKGRvYy5faWQpIHtcbiAgICBkb2MuaWQgPSBkb2MuX2lkXG4gICAgZGVsZXRlIGRvYy5faWRcbiAgfVxuXG4gIGRvYyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZG9jKSlcbiAgZG9jID0gc2FuaXRpemVJbnRlcm5hbEZpZWxkcyhkb2MpXG5cbiAgcmV0dXJuIGRvY1xufVxuIl0sIm5hbWVzIjpbImZpbmRHbG9iYWwiLCJsb2NhbGUiLCJyZXEiLCJzbHVnIiwid2hlcmUiLCJNb2RlbCIsImdsb2JhbHMiLCJvcHRpb25zIiwid2l0aFNlc3Npb24iLCJ0cmFuc2FjdGlvbklEIiwibGVhbiIsInF1ZXJ5IiwiYnVpbGRRdWVyeSIsImdsb2JhbFNsdWciLCJwYXlsb2FkIiwiY29tYmluZVF1ZXJpZXMiLCJnbG9iYWxUeXBlIiwiZXF1YWxzIiwiZG9jIiwiZmluZE9uZSIsIl9pZCIsImlkIiwiSlNPTiIsInBhcnNlIiwic3RyaW5naWZ5Iiwic2FuaXRpemVJbnRlcm5hbEZpZWxkcyJdLCJtYXBwaW5ncyI6Ijs7OzsrQkFVYUE7OztlQUFBQTs7OzBCQVBrQjsrRUFJSTs2QkFDUDs7Ozs7O0FBRXJCLE1BQU1BLGFBQXlCLGVBQWVBLFdBRW5ELEVBQUVDLE1BQU0sRUFBRUMsTUFBTSxDQUFDLENBQW1CLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFO0lBRW5ELE1BQU1DLFFBQVEsSUFBSSxDQUFDQyxPQUFPO0lBQzFCLE1BQU1DLFVBQVU7UUFDZCxHQUFHQyxJQUFBQSx3QkFBVyxFQUFDLElBQUksRUFBRU4sSUFBSU8sYUFBYSxDQUFDO1FBQ3ZDQyxNQUFNO0lBQ1I7SUFFQSxNQUFNQyxRQUFRLE1BQU1OLE1BQU1PLFVBQVUsQ0FBQztRQUNuQ0MsWUFBWVY7UUFDWkY7UUFDQWEsU0FBUyxJQUFJLENBQUNBLE9BQU87UUFDckJWLE9BQU9XLElBQUFBLHdCQUFjLEVBQUM7WUFBRUMsWUFBWTtnQkFBRUMsUUFBUWQ7WUFBSztRQUFFLEdBQUdDO0lBQzFEO0lBRUEsSUFBSWMsTUFBTyxNQUFNYixNQUFNYyxPQUFPLENBQUNSLE9BQU8sQ0FBQyxHQUFHSjtJQUUxQyxJQUFJLENBQUNXLEtBQUs7UUFDUixPQUFPO0lBQ1Q7SUFDQSxJQUFJQSxJQUFJRSxHQUFHLEVBQUU7UUFDWEYsSUFBSUcsRUFBRSxHQUFHSCxJQUFJRSxHQUFHO1FBQ2hCLE9BQU9GLElBQUlFLEdBQUc7SUFDaEI7SUFFQUYsTUFBTUksS0FBS0MsS0FBSyxDQUFDRCxLQUFLRSxTQUFTLENBQUNOO0lBQ2hDQSxNQUFNTyxJQUFBQSwrQkFBc0IsRUFBQ1A7SUFFN0IsT0FBT0E7QUFDVCJ9