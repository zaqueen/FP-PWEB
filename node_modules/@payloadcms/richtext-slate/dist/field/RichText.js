'use client';
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _ishotkey = /*#__PURE__*/ _interop_require_default(require("is-hotkey"));
const _forms = require("payload/components/forms");
const _utilities = require("payload/components/utilities");
const _utilities1 = require("payload/utilities");
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _slate = require("slate");
const _slatehistory = require("slate-history");
const _slatereact = require("slate-react");
const _defaultValue = require("../data/defaultValue");
const _validation = require("../data/validation");
const _elements = /*#__PURE__*/ _interop_require_default(require("./elements"));
const _listTypes = /*#__PURE__*/ _interop_require_default(require("./elements/listTypes"));
const _enablePlugins = /*#__PURE__*/ _interop_require_default(require("./enablePlugins"));
const _hotkeys = /*#__PURE__*/ _interop_require_default(require("./hotkeys"));
require("./index.scss");
const _leaves = /*#__PURE__*/ _interop_require_default(require("./leaves"));
const _toggle = /*#__PURE__*/ _interop_require_default(require("./leaves/toggle"));
const _mergeCustomFunctions = /*#__PURE__*/ _interop_require_default(require("./mergeCustomFunctions"));
const _withEnterBreakOut = /*#__PURE__*/ _interop_require_default(require("./plugins/withEnterBreakOut"));
const _withHTML = /*#__PURE__*/ _interop_require_default(require("./plugins/withHTML"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {};
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const defaultElements = [
    'h1',
    'h2',
    'h3',
    'h4',
    'h5',
    'h6',
    'ul',
    'ol',
    'indent',
    'link',
    'relationship',
    'upload'
];
const defaultLeaves = [
    'bold',
    'italic',
    'underline',
    'strikethrough',
    'code'
];
const baseClass = 'rich-text';
const RichText = (props)=>{
    const { name, admin: { className, condition, description, hideGutter, placeholder, readOnly, style, width } = {
        className: undefined,
        condition: undefined,
        description: undefined,
        hideGutter: undefined,
        placeholder: undefined,
        readOnly: undefined,
        style: undefined,
        width: undefined
    }, admin, defaultValue: defaultValueFromProps, label, path: pathFromProps, required, validate = _validation.richTextValidate } = props;
    const elements = admin?.elements || defaultElements;
    const leaves = admin?.leaves || defaultLeaves;
    const path = pathFromProps || name;
    const { i18n } = (0, _reacti18next.useTranslation)();
    const [loaded, setLoaded] = (0, _react.useState)(false);
    const [enabledElements, setEnabledElements] = (0, _react.useState)({});
    const [enabledLeaves, setEnabledLeaves] = (0, _react.useState)({});
    const editorRef = (0, _react.useRef)(null);
    const toolbarRef = (0, _react.useRef)(null);
    const drawerDepth = (0, _utilities.useEditDepth)();
    const drawerIsOpen = drawerDepth > 1;
    const renderElement = (0, _react.useCallback)(({ attributes, children, element })=>{
        const matchedElement = enabledElements[element.type];
        const Element = matchedElement?.Element;
        let attr = {
            ...attributes
        };
        // this converts text alignment to margin when dealing with void elements
        if (element.textAlign) {
            if (element.type === 'relationship' || element.type === 'upload') {
                switch(element.textAlign){
                    case 'left':
                        attr = {
                            ...attr,
                            style: {
                                marginRight: 'auto'
                            }
                        };
                        break;
                    case 'right':
                        attr = {
                            ...attr,
                            style: {
                                marginLeft: 'auto'
                            }
                        };
                        break;
                    case 'center':
                        attr = {
                            ...attr,
                            style: {
                                marginLeft: 'auto',
                                marginRight: 'auto'
                            }
                        };
                        break;
                    default:
                        attr = {
                            ...attr,
                            style: {
                                textAlign: element.textAlign
                            }
                        };
                        break;
                }
            } else if (element.type === 'li') {
                switch(element.textAlign){
                    case 'right':
                        attr = {
                            ...attr,
                            style: {
                                listStylePosition: 'inside',
                                textAlign: 'right'
                            }
                        };
                        break;
                    case 'center':
                        attr = {
                            ...attr,
                            style: {
                                listStylePosition: 'inside',
                                textAlign: 'center'
                            }
                        };
                        break;
                    case 'left':
                    default:
                        attr = {
                            ...attr,
                            style: {
                                listStylePosition: 'outside',
                                textAlign: 'left'
                            }
                        };
                        break;
                }
            } else {
                attr = {
                    ...attr,
                    style: {
                        textAlign: element.textAlign
                    }
                };
            }
        }
        if (Element) {
            const el = /*#__PURE__*/ _react.default.createElement(Element, {
                attributes: attr,
                editorRef: editorRef,
                element: element,
                fieldProps: props,
                path: path
            }, children);
            return el;
        }
        return /*#__PURE__*/ _react.default.createElement("div", attr, children);
    }, [
        enabledElements,
        path,
        props
    ]);
    const renderLeaf = (0, _react.useCallback)(({ attributes, children, leaf })=>{
        const matchedLeaves = Object.entries(enabledLeaves).filter(([leafName])=>leaf[leafName]);
        if (matchedLeaves.length > 0) {
            return matchedLeaves.reduce((result, [leafName], i)=>{
                if (enabledLeaves[leafName]?.Leaf) {
                    const Leaf = enabledLeaves[leafName]?.Leaf;
                    return /*#__PURE__*/ _react.default.createElement(Leaf, {
                        editorRef: editorRef,
                        fieldProps: props,
                        key: i,
                        leaf: leaf,
                        path: path
                    }, result);
                }
                return result;
            }, /*#__PURE__*/ _react.default.createElement("span", attributes, children));
        }
        return /*#__PURE__*/ _react.default.createElement("span", attributes, children);
    }, [
        enabledLeaves,
        path,
        props
    ]);
    const memoizedValidate = (0, _react.useCallback)((value, validationOptions)=>{
        return validate(value, {
            ...validationOptions,
            required
        });
    }, [
        validate,
        required
    ]);
    const fieldType = (0, _forms.useField)({
        condition,
        path,
        validate: memoizedValidate
    });
    const { errorMessage, initialValue, setValue, showError, value } = fieldType;
    const classes = [
        baseClass,
        'field-type',
        className,
        showError && 'error',
        readOnly && `${baseClass}--read-only`,
        !hideGutter && `${baseClass}--gutter`
    ].filter(Boolean).join(' ');
    const editor = (0, _react.useMemo)(()=>{
        let CreatedEditor = (0, _withEnterBreakOut.default)((0, _slatehistory.withHistory)((0, _slatereact.withReact)((0, _slate.createEditor)())));
        CreatedEditor = (0, _withHTML.default)(CreatedEditor);
        CreatedEditor = (0, _enablePlugins.default)(CreatedEditor, elements);
        CreatedEditor = (0, _enablePlugins.default)(CreatedEditor, leaves);
        return CreatedEditor;
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [
        elements,
        leaves,
        path
    ]);
    // All slate changes fire the onChange event
    // including selection changes
    // so we will filter the set_selection operations out
    // and only fire setValue when onChange is because of value
    const handleChange = (0, _react.useCallback)((val)=>{
        const ops = editor.operations.filter((o)=>{
            if (o) {
                return o.type !== 'set_selection';
            }
            return false;
        });
        if (ops && Array.isArray(ops) && ops.length > 0) {
            if (!readOnly && val !== _defaultValue.defaultRichTextValue && val !== value) {
                setValue(val);
            }
        }
    }, [
        editor.operations,
        readOnly,
        setValue,
        value
    ]);
    (0, _react.useEffect)(()=>{
        if (!loaded) {
            const mergedElements = (0, _mergeCustomFunctions.default)(elements, _elements.default);
            const mergedLeaves = (0, _mergeCustomFunctions.default)(leaves, _leaves.default);
            setEnabledElements(mergedElements);
            setEnabledLeaves(mergedLeaves);
            setLoaded(true);
        }
    }, [
        loaded,
        elements,
        leaves
    ]);
    (0, _react.useEffect)(()=>{
        function setClickableState(clickState) {
            const selectors = 'button, a, [role="button"]';
            const toolbarButtons = toolbarRef.current?.querySelectorAll(selectors);
            (toolbarButtons || []).forEach((child)=>{
                const isButton = child.tagName === 'BUTTON';
                const isDisabling = clickState === 'disabled';
                child.setAttribute('tabIndex', isDisabling ? '-1' : '0');
                if (isButton) child.setAttribute('disabled', isDisabling ? 'disabled' : null);
            });
        }
        if (loaded && readOnly) {
            setClickableState('disabled');
        }
        return ()=>{
            if (loaded && readOnly) {
                setClickableState('enabled');
            }
        };
    }, [
        loaded,
        readOnly
    ]);
    // useEffect(() => {
    //   // If there is a change to the initial value, we need to reset Slate history
    //   // and clear selection because the old selection may no longer be valid
    //   // as returned JSON may be modified in hooks and have a different shape
    //   if (editor.selection) {
    //     console.log('deselecting');
    //     ReactEditor.deselect(editor);
    //   }
    // }, [path, editor]);
    if (!loaded) {
        return null;
    }
    let valueToRender = value;
    if (typeof valueToRender === 'string') {
        try {
            const parsedJSON = JSON.parse(valueToRender);
            valueToRender = parsedJSON;
        } catch (err) {
            valueToRender = null;
        }
    }
    if (!valueToRender) valueToRender = defaultValueFromProps || _defaultValue.defaultRichTextValue;
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: classes,
        style: {
            ...style,
            width
        }
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__wrap`
    }, /*#__PURE__*/ _react.default.createElement(_forms.Error, {
        message: errorMessage,
        showError: showError
    }), /*#__PURE__*/ _react.default.createElement(_forms.Label, {
        htmlFor: `field-${path.replace(/\./g, '__')}`,
        label: label,
        required: required
    }), /*#__PURE__*/ _react.default.createElement(_slatereact.Slate, {
        editor: editor,
        key: JSON.stringify({
            initialValue,
            path
        }),
        onChange: handleChange,
        value: valueToRender
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__wrapper`
    }, elements?.length + leaves?.length > 0 && /*#__PURE__*/ _react.default.createElement("div", {
        className: [
            `${baseClass}__toolbar`,
            drawerIsOpen && `${baseClass}__drawerIsOpen`
        ].filter(Boolean).join(' '),
        ref: toolbarRef
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__toolbar-wrap`
    }, elements.map((element, i)=>{
        let elementName;
        if (typeof element === 'object' && element?.name) elementName = element.name;
        if (typeof element === 'string') elementName = element;
        const elementType = enabledElements[elementName];
        const Button = elementType?.Button;
        if (Button) {
            return /*#__PURE__*/ _react.default.createElement(Button, {
                fieldProps: props,
                key: i,
                path: path
            });
        }
        return null;
    }), leaves.map((leaf, i)=>{
        let leafName;
        if (typeof leaf === 'object' && leaf?.name) leafName = leaf.name;
        if (typeof leaf === 'string') leafName = leaf;
        const leafType = enabledLeaves[leafName];
        const Button = leafType?.Button;
        if (Button) {
            return /*#__PURE__*/ _react.default.createElement(Button, {
                fieldProps: props,
                key: i,
                path: path
            });
        }
        return null;
    }))), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__editor`,
        ref: editorRef
    }, /*#__PURE__*/ _react.default.createElement(_slatereact.Editable, {
        className: `${baseClass}__input`,
        id: `field-${path.replace(/\./g, '__')}`,
        onKeyDown: (event)=>{
            if (event.key === 'Enter') {
                if (event.shiftKey) {
                    event.preventDefault();
                    editor.insertText('\n');
                } else {
                    const selectedElement = _slate.Node.descendant(editor, editor.selection.anchor.path.slice(0, -1));
                    if (_slate.Element.isElement(selectedElement)) {
                        // Allow hard enter to "break out" of certain elements
                        if (editor.shouldBreakOutOnEnter(selectedElement)) {
                            event.preventDefault();
                            const selectedLeaf = _slate.Node.descendant(editor, editor.selection.anchor.path);
                            if (_slate.Text.isText(selectedLeaf) && String(selectedLeaf.text).length === editor.selection.anchor.offset) {
                                _slate.Transforms.insertNodes(editor, {
                                    children: [
                                        {
                                            text: ''
                                        }
                                    ]
                                });
                            } else {
                                _slate.Transforms.splitNodes(editor);
                                _slate.Transforms.setNodes(editor, {});
                            }
                        }
                    }
                }
            }
            if (event.key === 'Backspace') {
                const selectedElement = _slate.Node.descendant(editor, editor.selection.anchor.path.slice(0, -1));
                if (_slate.Element.isElement(selectedElement) && selectedElement.type === 'li') {
                    const selectedLeaf = _slate.Node.descendant(editor, editor.selection.anchor.path);
                    if (_slate.Text.isText(selectedLeaf) && String(selectedLeaf.text).length === 0) {
                        event.preventDefault();
                        _slate.Transforms.unwrapNodes(editor, {
                            match: (n)=>_slate.Element.isElement(n) && _listTypes.default.includes(n.type),
                            mode: 'lowest',
                            split: true
                        });
                        _slate.Transforms.setNodes(editor, {
                            type: undefined
                        });
                    }
                } else if (editor.isVoid(selectedElement)) {
                    _slate.Transforms.removeNodes(editor);
                }
            }
            Object.keys(_hotkeys.default).forEach((hotkey)=>{
                if ((0, _ishotkey.default)(hotkey, event)) {
                    event.preventDefault();
                    const mark = _hotkeys.default[hotkey];
                    (0, _toggle.default)(editor, mark);
                }
            });
        },
        placeholder: (0, _utilities1.getTranslation)(placeholder, i18n),
        readOnly: readOnly,
        renderElement: renderElement,
        renderLeaf: renderLeaf,
        spellCheck: true
    })))), /*#__PURE__*/ _react.default.createElement(_forms.FieldDescription, {
        description: description,
        value: value
    })));
};
const _default = (0, _forms.withCondition)(RichText);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9maWVsZC9SaWNoVGV4dC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBjbGllbnQnXG5cbmltcG9ydCB0eXBlIHsgQmFzZUVkaXRvciwgQmFzZU9wZXJhdGlvbiB9IGZyb20gJ3NsYXRlJ1xuaW1wb3J0IHR5cGUgeyBIaXN0b3J5RWRpdG9yIH0gZnJvbSAnc2xhdGUtaGlzdG9yeSdcbmltcG9ydCB0eXBlIHsgUmVhY3RFZGl0b3IgfSBmcm9tICdzbGF0ZS1yZWFjdCdcblxuaW1wb3J0IGlzSG90a2V5IGZyb20gJ2lzLWhvdGtleSdcbmltcG9ydCB7IEVycm9yLCBGaWVsZERlc2NyaXB0aW9uLCBMYWJlbCwgdXNlRmllbGQsIHdpdGhDb25kaXRpb24gfSBmcm9tICdwYXlsb2FkL2NvbXBvbmVudHMvZm9ybXMnXG5pbXBvcnQgeyB1c2VFZGl0RGVwdGggfSBmcm9tICdwYXlsb2FkL2NvbXBvbmVudHMvdXRpbGl0aWVzJ1xuaW1wb3J0IHsgZ2V0VHJhbnNsYXRpb24gfSBmcm9tICdwYXlsb2FkL3V0aWxpdGllcydcbmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyB1c2VUcmFuc2xhdGlvbiB9IGZyb20gJ3JlYWN0LWkxOG5leHQnXG5pbXBvcnQgeyBOb2RlLCBFbGVtZW50IGFzIFNsYXRlRWxlbWVudCwgVGV4dCwgVHJhbnNmb3JtcywgY3JlYXRlRWRpdG9yIH0gZnJvbSAnc2xhdGUnXG5pbXBvcnQgeyB3aXRoSGlzdG9yeSB9IGZyb20gJ3NsYXRlLWhpc3RvcnknXG5pbXBvcnQgeyBFZGl0YWJsZSwgU2xhdGUsIHdpdGhSZWFjdCB9IGZyb20gJ3NsYXRlLXJlYWN0J1xuXG5pbXBvcnQgdHlwZSB7IEVsZW1lbnROb2RlLCBGaWVsZFByb3BzLCBSaWNoVGV4dEVsZW1lbnQsIFJpY2hUZXh0TGVhZiwgVGV4dE5vZGUgfSBmcm9tICcuLi90eXBlcydcblxuaW1wb3J0IHsgZGVmYXVsdFJpY2hUZXh0VmFsdWUgfSBmcm9tICcuLi9kYXRhL2RlZmF1bHRWYWx1ZSdcbmltcG9ydCB7IHJpY2hUZXh0VmFsaWRhdGUgfSBmcm9tICcuLi9kYXRhL3ZhbGlkYXRpb24nXG5pbXBvcnQgZWxlbWVudFR5cGVzIGZyb20gJy4vZWxlbWVudHMnXG5pbXBvcnQgbGlzdFR5cGVzIGZyb20gJy4vZWxlbWVudHMvbGlzdFR5cGVzJ1xuaW1wb3J0IGVuYWJsZVBsdWdpbnMgZnJvbSAnLi9lbmFibGVQbHVnaW5zJ1xuaW1wb3J0IGhvdGtleXMgZnJvbSAnLi9ob3RrZXlzJ1xuaW1wb3J0ICcuL2luZGV4LnNjc3MnXG5pbXBvcnQgbGVhZlR5cGVzIGZyb20gJy4vbGVhdmVzJ1xuaW1wb3J0IHRvZ2dsZUxlYWYgZnJvbSAnLi9sZWF2ZXMvdG9nZ2xlJ1xuaW1wb3J0IG1lcmdlQ3VzdG9tRnVuY3Rpb25zIGZyb20gJy4vbWVyZ2VDdXN0b21GdW5jdGlvbnMnXG5pbXBvcnQgd2l0aEVudGVyQnJlYWtPdXQgZnJvbSAnLi9wbHVnaW5zL3dpdGhFbnRlckJyZWFrT3V0J1xuaW1wb3J0IHdpdGhIVE1MIGZyb20gJy4vcGx1Z2lucy93aXRoSFRNTCdcblxuY29uc3QgZGVmYXVsdEVsZW1lbnRzOiBSaWNoVGV4dEVsZW1lbnRbXSA9IFtcbiAgJ2gxJyxcbiAgJ2gyJyxcbiAgJ2gzJyxcbiAgJ2g0JyxcbiAgJ2g1JyxcbiAgJ2g2JyxcbiAgJ3VsJyxcbiAgJ29sJyxcbiAgJ2luZGVudCcsXG4gICdsaW5rJyxcbiAgJ3JlbGF0aW9uc2hpcCcsXG4gICd1cGxvYWQnLFxuXVxuY29uc3QgZGVmYXVsdExlYXZlczogUmljaFRleHRMZWFmW10gPSBbJ2JvbGQnLCAnaXRhbGljJywgJ3VuZGVybGluZScsICdzdHJpa2V0aHJvdWdoJywgJ2NvZGUnXVxuXG5jb25zdCBiYXNlQ2xhc3MgPSAncmljaC10ZXh0J1xuXG5kZWNsYXJlIG1vZHVsZSAnc2xhdGUnIHtcbiAgaW50ZXJmYWNlIEN1c3RvbVR5cGVzIHtcbiAgICBFZGl0b3I6IEJhc2VFZGl0b3IgJiBSZWFjdEVkaXRvciAmIEhpc3RvcnlFZGl0b3JcbiAgICBFbGVtZW50OiBFbGVtZW50Tm9kZVxuICAgIFRleHQ6IFRleHROb2RlXG4gIH1cbn1cblxuY29uc3QgUmljaFRleHQ6IFJlYWN0LkZDPEZpZWxkUHJvcHM+ID0gKHByb3BzKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBuYW1lLFxuICAgIGFkbWluOiB7XG4gICAgICBjbGFzc05hbWUsXG4gICAgICBjb25kaXRpb24sXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIGhpZGVHdXR0ZXIsXG4gICAgICBwbGFjZWhvbGRlcixcbiAgICAgIHJlYWRPbmx5LFxuICAgICAgc3R5bGUsXG4gICAgICB3aWR0aCxcbiAgICB9ID0ge1xuICAgICAgY2xhc3NOYW1lOiB1bmRlZmluZWQsXG4gICAgICBjb25kaXRpb246IHVuZGVmaW5lZCxcbiAgICAgIGRlc2NyaXB0aW9uOiB1bmRlZmluZWQsXG4gICAgICBoaWRlR3V0dGVyOiB1bmRlZmluZWQsXG4gICAgICBwbGFjZWhvbGRlcjogdW5kZWZpbmVkLFxuICAgICAgcmVhZE9ubHk6IHVuZGVmaW5lZCxcbiAgICAgIHN0eWxlOiB1bmRlZmluZWQsXG4gICAgICB3aWR0aDogdW5kZWZpbmVkLFxuICAgIH0sXG4gICAgYWRtaW4sXG4gICAgZGVmYXVsdFZhbHVlOiBkZWZhdWx0VmFsdWVGcm9tUHJvcHMsXG4gICAgbGFiZWwsXG4gICAgcGF0aDogcGF0aEZyb21Qcm9wcyxcbiAgICByZXF1aXJlZCxcbiAgICB2YWxpZGF0ZSA9IHJpY2hUZXh0VmFsaWRhdGUsXG4gIH0gPSBwcm9wc1xuXG4gIGNvbnN0IGVsZW1lbnRzOiBSaWNoVGV4dEVsZW1lbnRbXSA9IGFkbWluPy5lbGVtZW50cyB8fCBkZWZhdWx0RWxlbWVudHNcbiAgY29uc3QgbGVhdmVzOiBSaWNoVGV4dExlYWZbXSA9IGFkbWluPy5sZWF2ZXMgfHwgZGVmYXVsdExlYXZlc1xuXG4gIGNvbnN0IHBhdGggPSBwYXRoRnJvbVByb3BzIHx8IG5hbWVcblxuICBjb25zdCB7IGkxOG4gfSA9IHVzZVRyYW5zbGF0aW9uKClcbiAgY29uc3QgW2xvYWRlZCwgc2V0TG9hZGVkXSA9IHVzZVN0YXRlKGZhbHNlKVxuICBjb25zdCBbZW5hYmxlZEVsZW1lbnRzLCBzZXRFbmFibGVkRWxlbWVudHNdID0gdXNlU3RhdGUoe30pXG4gIGNvbnN0IFtlbmFibGVkTGVhdmVzLCBzZXRFbmFibGVkTGVhdmVzXSA9IHVzZVN0YXRlKHt9KVxuICBjb25zdCBlZGl0b3JSZWYgPSB1c2VSZWYobnVsbClcbiAgY29uc3QgdG9vbGJhclJlZiA9IHVzZVJlZihudWxsKVxuXG4gIGNvbnN0IGRyYXdlckRlcHRoID0gdXNlRWRpdERlcHRoKClcbiAgY29uc3QgZHJhd2VySXNPcGVuID0gZHJhd2VyRGVwdGggPiAxXG5cbiAgY29uc3QgcmVuZGVyRWxlbWVudCA9IHVzZUNhbGxiYWNrKFxuICAgICh7IGF0dHJpYnV0ZXMsIGNoaWxkcmVuLCBlbGVtZW50IH0pID0+IHtcbiAgICAgIGNvbnN0IG1hdGNoZWRFbGVtZW50ID0gZW5hYmxlZEVsZW1lbnRzW2VsZW1lbnQudHlwZV1cbiAgICAgIGNvbnN0IEVsZW1lbnQgPSBtYXRjaGVkRWxlbWVudD8uRWxlbWVudFxuXG4gICAgICBsZXQgYXR0ciA9IHsgLi4uYXR0cmlidXRlcyB9XG5cbiAgICAgIC8vIHRoaXMgY29udmVydHMgdGV4dCBhbGlnbm1lbnQgdG8gbWFyZ2luIHdoZW4gZGVhbGluZyB3aXRoIHZvaWQgZWxlbWVudHNcbiAgICAgIGlmIChlbGVtZW50LnRleHRBbGlnbikge1xuICAgICAgICBpZiAoZWxlbWVudC50eXBlID09PSAncmVsYXRpb25zaGlwJyB8fCBlbGVtZW50LnR5cGUgPT09ICd1cGxvYWQnKSB7XG4gICAgICAgICAgc3dpdGNoIChlbGVtZW50LnRleHRBbGlnbikge1xuICAgICAgICAgICAgY2FzZSAnbGVmdCc6XG4gICAgICAgICAgICAgIGF0dHIgPSB7IC4uLmF0dHIsIHN0eWxlOiB7IG1hcmdpblJpZ2h0OiAnYXV0bycgfSB9XG4gICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICBjYXNlICdyaWdodCc6XG4gICAgICAgICAgICAgIGF0dHIgPSB7IC4uLmF0dHIsIHN0eWxlOiB7IG1hcmdpbkxlZnQ6ICdhdXRvJyB9IH1cbiAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIGNhc2UgJ2NlbnRlcic6XG4gICAgICAgICAgICAgIGF0dHIgPSB7IC4uLmF0dHIsIHN0eWxlOiB7IG1hcmdpbkxlZnQ6ICdhdXRvJywgbWFyZ2luUmlnaHQ6ICdhdXRvJyB9IH1cbiAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIGF0dHIgPSB7IC4uLmF0dHIsIHN0eWxlOiB7IHRleHRBbGlnbjogZWxlbWVudC50ZXh0QWxpZ24gfSB9XG4gICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnQudHlwZSA9PT0gJ2xpJykge1xuICAgICAgICAgIHN3aXRjaCAoZWxlbWVudC50ZXh0QWxpZ24pIHtcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgICAgICAgICAgYXR0ciA9IHsgLi4uYXR0ciwgc3R5bGU6IHsgbGlzdFN0eWxlUG9zaXRpb246ICdpbnNpZGUnLCB0ZXh0QWxpZ246ICdyaWdodCcgfSB9XG4gICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICBjYXNlICdjZW50ZXInOlxuICAgICAgICAgICAgICBhdHRyID0geyAuLi5hdHRyLCBzdHlsZTogeyBsaXN0U3R5bGVQb3NpdGlvbjogJ2luc2lkZScsIHRleHRBbGlnbjogJ2NlbnRlcicgfSB9XG4gICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICBjYXNlICdsZWZ0JzpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIGF0dHIgPSB7IC4uLmF0dHIsIHN0eWxlOiB7IGxpc3RTdHlsZVBvc2l0aW9uOiAnb3V0c2lkZScsIHRleHRBbGlnbjogJ2xlZnQnIH0gfVxuICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhdHRyID0geyAuLi5hdHRyLCBzdHlsZTogeyB0ZXh0QWxpZ246IGVsZW1lbnQudGV4dEFsaWduIH0gfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGVsID0gKFxuICAgICAgICAgIDxFbGVtZW50XG4gICAgICAgICAgICBhdHRyaWJ1dGVzPXthdHRyfVxuICAgICAgICAgICAgZWRpdG9yUmVmPXtlZGl0b3JSZWZ9XG4gICAgICAgICAgICBlbGVtZW50PXtlbGVtZW50fVxuICAgICAgICAgICAgZmllbGRQcm9wcz17cHJvcHN9XG4gICAgICAgICAgICBwYXRoPXtwYXRofVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgICA8L0VsZW1lbnQ+XG4gICAgICAgIClcblxuICAgICAgICByZXR1cm4gZWxcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIDxkaXYgey4uLmF0dHJ9PntjaGlsZHJlbn08L2Rpdj5cbiAgICB9LFxuICAgIFtlbmFibGVkRWxlbWVudHMsIHBhdGgsIHByb3BzXSxcbiAgKVxuXG4gIGNvbnN0IHJlbmRlckxlYWYgPSB1c2VDYWxsYmFjayhcbiAgICAoeyBhdHRyaWJ1dGVzLCBjaGlsZHJlbiwgbGVhZiB9KSA9PiB7XG4gICAgICBjb25zdCBtYXRjaGVkTGVhdmVzID0gT2JqZWN0LmVudHJpZXMoZW5hYmxlZExlYXZlcykuZmlsdGVyKChbbGVhZk5hbWVdKSA9PiBsZWFmW2xlYWZOYW1lXSlcblxuICAgICAgaWYgKG1hdGNoZWRMZWF2ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hlZExlYXZlcy5yZWR1Y2UoXG4gICAgICAgICAgKHJlc3VsdCwgW2xlYWZOYW1lXSwgaSkgPT4ge1xuICAgICAgICAgICAgaWYgKGVuYWJsZWRMZWF2ZXNbbGVhZk5hbWVdPy5MZWFmKSB7XG4gICAgICAgICAgICAgIGNvbnN0IExlYWYgPSBlbmFibGVkTGVhdmVzW2xlYWZOYW1lXT8uTGVhZlxuICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDxMZWFmIGVkaXRvclJlZj17ZWRpdG9yUmVmfSBmaWVsZFByb3BzPXtwcm9wc30ga2V5PXtpfSBsZWFmPXtsZWFmfSBwYXRoPXtwYXRofT5cbiAgICAgICAgICAgICAgICAgIHtyZXN1bHR9XG4gICAgICAgICAgICAgICAgPC9MZWFmPlxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHRcbiAgICAgICAgICB9LFxuICAgICAgICAgIDxzcGFuIHsuLi5hdHRyaWJ1dGVzfT57Y2hpbGRyZW59PC9zcGFuPixcbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gPHNwYW4gey4uLmF0dHJpYnV0ZXN9PntjaGlsZHJlbn08L3NwYW4+XG4gICAgfSxcbiAgICBbZW5hYmxlZExlYXZlcywgcGF0aCwgcHJvcHNdLFxuICApXG5cbiAgY29uc3QgbWVtb2l6ZWRWYWxpZGF0ZSA9IHVzZUNhbGxiYWNrKFxuICAgICh2YWx1ZSwgdmFsaWRhdGlvbk9wdGlvbnMpID0+IHtcbiAgICAgIHJldHVybiB2YWxpZGF0ZSh2YWx1ZSwgeyAuLi52YWxpZGF0aW9uT3B0aW9ucywgcmVxdWlyZWQgfSlcbiAgICB9LFxuICAgIFt2YWxpZGF0ZSwgcmVxdWlyZWRdLFxuICApXG5cbiAgY29uc3QgZmllbGRUeXBlID0gdXNlRmllbGQoe1xuICAgIGNvbmRpdGlvbixcbiAgICBwYXRoLFxuICAgIHZhbGlkYXRlOiBtZW1vaXplZFZhbGlkYXRlLFxuICB9KVxuXG4gIGNvbnN0IHsgZXJyb3JNZXNzYWdlLCBpbml0aWFsVmFsdWUsIHNldFZhbHVlLCBzaG93RXJyb3IsIHZhbHVlIH0gPSBmaWVsZFR5cGVcblxuICBjb25zdCBjbGFzc2VzID0gW1xuICAgIGJhc2VDbGFzcyxcbiAgICAnZmllbGQtdHlwZScsXG4gICAgY2xhc3NOYW1lLFxuICAgIHNob3dFcnJvciAmJiAnZXJyb3InLFxuICAgIHJlYWRPbmx5ICYmIGAke2Jhc2VDbGFzc30tLXJlYWQtb25seWAsXG4gICAgIWhpZGVHdXR0ZXIgJiYgYCR7YmFzZUNsYXNzfS0tZ3V0dGVyYCxcbiAgXVxuICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAuam9pbignICcpXG5cbiAgY29uc3QgZWRpdG9yID0gdXNlTWVtbygoKSA9PiB7XG4gICAgbGV0IENyZWF0ZWRFZGl0b3IgPSB3aXRoRW50ZXJCcmVha091dCh3aXRoSGlzdG9yeSh3aXRoUmVhY3QoY3JlYXRlRWRpdG9yKCkpKSlcblxuICAgIENyZWF0ZWRFZGl0b3IgPSB3aXRoSFRNTChDcmVhdGVkRWRpdG9yKVxuICAgIENyZWF0ZWRFZGl0b3IgPSBlbmFibGVQbHVnaW5zKENyZWF0ZWRFZGl0b3IsIGVsZW1lbnRzKVxuICAgIENyZWF0ZWRFZGl0b3IgPSBlbmFibGVQbHVnaW5zKENyZWF0ZWRFZGl0b3IsIGxlYXZlcylcblxuICAgIHJldHVybiBDcmVhdGVkRWRpdG9yXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwc1xuICB9LCBbZWxlbWVudHMsIGxlYXZlcywgcGF0aF0pXG5cbiAgLy8gQWxsIHNsYXRlIGNoYW5nZXMgZmlyZSB0aGUgb25DaGFuZ2UgZXZlbnRcbiAgLy8gaW5jbHVkaW5nIHNlbGVjdGlvbiBjaGFuZ2VzXG4gIC8vIHNvIHdlIHdpbGwgZmlsdGVyIHRoZSBzZXRfc2VsZWN0aW9uIG9wZXJhdGlvbnMgb3V0XG4gIC8vIGFuZCBvbmx5IGZpcmUgc2V0VmFsdWUgd2hlbiBvbkNoYW5nZSBpcyBiZWNhdXNlIG9mIHZhbHVlXG4gIGNvbnN0IGhhbmRsZUNoYW5nZSA9IHVzZUNhbGxiYWNrKFxuICAgICh2YWw6IHVua25vd24pID0+IHtcbiAgICAgIGNvbnN0IG9wcyA9IGVkaXRvci5vcGVyYXRpb25zLmZpbHRlcigobzogQmFzZU9wZXJhdGlvbikgPT4ge1xuICAgICAgICBpZiAobykge1xuICAgICAgICAgIHJldHVybiBvLnR5cGUgIT09ICdzZXRfc2VsZWN0aW9uJ1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgfSlcblxuICAgICAgaWYgKG9wcyAmJiBBcnJheS5pc0FycmF5KG9wcykgJiYgb3BzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKCFyZWFkT25seSAmJiB2YWwgIT09IGRlZmF1bHRSaWNoVGV4dFZhbHVlICYmIHZhbCAhPT0gdmFsdWUpIHtcbiAgICAgICAgICBzZXRWYWx1ZSh2YWwpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIFtlZGl0b3Iub3BlcmF0aW9ucywgcmVhZE9ubHksIHNldFZhbHVlLCB2YWx1ZV0sXG4gIClcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICghbG9hZGVkKSB7XG4gICAgICBjb25zdCBtZXJnZWRFbGVtZW50cyA9IG1lcmdlQ3VzdG9tRnVuY3Rpb25zKGVsZW1lbnRzLCBlbGVtZW50VHlwZXMpXG4gICAgICBjb25zdCBtZXJnZWRMZWF2ZXMgPSBtZXJnZUN1c3RvbUZ1bmN0aW9ucyhsZWF2ZXMsIGxlYWZUeXBlcylcblxuICAgICAgc2V0RW5hYmxlZEVsZW1lbnRzKG1lcmdlZEVsZW1lbnRzKVxuICAgICAgc2V0RW5hYmxlZExlYXZlcyhtZXJnZWRMZWF2ZXMpXG5cbiAgICAgIHNldExvYWRlZCh0cnVlKVxuICAgIH1cbiAgfSwgW2xvYWRlZCwgZWxlbWVudHMsIGxlYXZlc10pXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBmdW5jdGlvbiBzZXRDbGlja2FibGVTdGF0ZShjbGlja1N0YXRlOiAnZGlzYWJsZWQnIHwgJ2VuYWJsZWQnKSB7XG4gICAgICBjb25zdCBzZWxlY3RvcnMgPSAnYnV0dG9uLCBhLCBbcm9sZT1cImJ1dHRvblwiXSdcbiAgICAgIGNvbnN0IHRvb2xiYXJCdXR0b25zOiAoSFRNTEFuY2hvckVsZW1lbnQgfCBIVE1MQnV0dG9uRWxlbWVudClbXSA9XG4gICAgICAgIHRvb2xiYXJSZWYuY3VycmVudD8ucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcnMpXG5cbiAgICAgIDsodG9vbGJhckJ1dHRvbnMgfHwgW10pLmZvckVhY2goKGNoaWxkKSA9PiB7XG4gICAgICAgIGNvbnN0IGlzQnV0dG9uID0gY2hpbGQudGFnTmFtZSA9PT0gJ0JVVFRPTidcbiAgICAgICAgY29uc3QgaXNEaXNhYmxpbmcgPSBjbGlja1N0YXRlID09PSAnZGlzYWJsZWQnXG4gICAgICAgIGNoaWxkLnNldEF0dHJpYnV0ZSgndGFiSW5kZXgnLCBpc0Rpc2FibGluZyA/ICctMScgOiAnMCcpXG4gICAgICAgIGlmIChpc0J1dHRvbikgY2hpbGQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsIGlzRGlzYWJsaW5nID8gJ2Rpc2FibGVkJyA6IG51bGwpXG4gICAgICB9KVxuICAgIH1cblxuICAgIGlmIChsb2FkZWQgJiYgcmVhZE9ubHkpIHtcbiAgICAgIHNldENsaWNrYWJsZVN0YXRlKCdkaXNhYmxlZCcpXG4gICAgfVxuXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGlmIChsb2FkZWQgJiYgcmVhZE9ubHkpIHtcbiAgICAgICAgc2V0Q2xpY2thYmxlU3RhdGUoJ2VuYWJsZWQnKVxuICAgICAgfVxuICAgIH1cbiAgfSwgW2xvYWRlZCwgcmVhZE9ubHldKVxuXG4gIC8vIHVzZUVmZmVjdCgoKSA9PiB7XG4gIC8vICAgLy8gSWYgdGhlcmUgaXMgYSBjaGFuZ2UgdG8gdGhlIGluaXRpYWwgdmFsdWUsIHdlIG5lZWQgdG8gcmVzZXQgU2xhdGUgaGlzdG9yeVxuICAvLyAgIC8vIGFuZCBjbGVhciBzZWxlY3Rpb24gYmVjYXVzZSB0aGUgb2xkIHNlbGVjdGlvbiBtYXkgbm8gbG9uZ2VyIGJlIHZhbGlkXG4gIC8vICAgLy8gYXMgcmV0dXJuZWQgSlNPTiBtYXkgYmUgbW9kaWZpZWQgaW4gaG9va3MgYW5kIGhhdmUgYSBkaWZmZXJlbnQgc2hhcGVcbiAgLy8gICBpZiAoZWRpdG9yLnNlbGVjdGlvbikge1xuICAvLyAgICAgY29uc29sZS5sb2coJ2Rlc2VsZWN0aW5nJyk7XG4gIC8vICAgICBSZWFjdEVkaXRvci5kZXNlbGVjdChlZGl0b3IpO1xuICAvLyAgIH1cbiAgLy8gfSwgW3BhdGgsIGVkaXRvcl0pO1xuXG4gIGlmICghbG9hZGVkKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIGxldCB2YWx1ZVRvUmVuZGVyID0gdmFsdWVcblxuICBpZiAodHlwZW9mIHZhbHVlVG9SZW5kZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcnNlZEpTT04gPSBKU09OLnBhcnNlKHZhbHVlVG9SZW5kZXIpXG4gICAgICB2YWx1ZVRvUmVuZGVyID0gcGFyc2VkSlNPTlxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdmFsdWVUb1JlbmRlciA9IG51bGxcbiAgICB9XG4gIH1cblxuICBpZiAoIXZhbHVlVG9SZW5kZXIpIHZhbHVlVG9SZW5kZXIgPSBkZWZhdWx0VmFsdWVGcm9tUHJvcHMgfHwgZGVmYXVsdFJpY2hUZXh0VmFsdWVcblxuICByZXR1cm4gKFxuICAgIDxkaXZcbiAgICAgIGNsYXNzTmFtZT17Y2xhc3Nlc31cbiAgICAgIHN0eWxlPXt7XG4gICAgICAgIC4uLnN0eWxlLFxuICAgICAgICB3aWR0aCxcbiAgICAgIH19XG4gICAgPlxuICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3dyYXBgfT5cbiAgICAgICAgPEVycm9yIG1lc3NhZ2U9e2Vycm9yTWVzc2FnZX0gc2hvd0Vycm9yPXtzaG93RXJyb3J9IC8+XG4gICAgICAgIDxMYWJlbCBodG1sRm9yPXtgZmllbGQtJHtwYXRoLnJlcGxhY2UoL1xcLi9nLCAnX18nKX1gfSBsYWJlbD17bGFiZWx9IHJlcXVpcmVkPXtyZXF1aXJlZH0gLz5cbiAgICAgICAgPFNsYXRlXG4gICAgICAgICAgZWRpdG9yPXtlZGl0b3J9XG4gICAgICAgICAga2V5PXtKU09OLnN0cmluZ2lmeSh7IGluaXRpYWxWYWx1ZSwgcGF0aCB9KX1cbiAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlQ2hhbmdlfVxuICAgICAgICAgIHZhbHVlPXt2YWx1ZVRvUmVuZGVyIGFzIGFueVtdfVxuICAgICAgICA+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3dyYXBwZXJgfT5cbiAgICAgICAgICAgIHtlbGVtZW50cz8ubGVuZ3RoICsgbGVhdmVzPy5sZW5ndGggPiAwICYmIChcbiAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17W2Ake2Jhc2VDbGFzc31fX3Rvb2xiYXJgLCBkcmF3ZXJJc09wZW4gJiYgYCR7YmFzZUNsYXNzfV9fZHJhd2VySXNPcGVuYF1cbiAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICAgICAgICAgICAgIC5qb2luKCcgJyl9XG4gICAgICAgICAgICAgICAgcmVmPXt0b29sYmFyUmVmfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3Rvb2xiYXItd3JhcGB9PlxuICAgICAgICAgICAgICAgICAge2VsZW1lbnRzLm1hcCgoZWxlbWVudCwgaSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgZWxlbWVudE5hbWU6IHN0cmluZ1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGVsZW1lbnQgPT09ICdvYmplY3QnICYmIGVsZW1lbnQ/Lm5hbWUpIGVsZW1lbnROYW1lID0gZWxlbWVudC5uYW1lXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gJ3N0cmluZycpIGVsZW1lbnROYW1lID0gZWxlbWVudFxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRUeXBlID0gZW5hYmxlZEVsZW1lbnRzW2VsZW1lbnROYW1lXVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBCdXR0b24gPSBlbGVtZW50VHlwZT8uQnV0dG9uXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKEJ1dHRvbikge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiA8QnV0dG9uIGZpZWxkUHJvcHM9e3Byb3BzfSBrZXk9e2l9IHBhdGg9e3BhdGh9IC8+XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgICAgICB7bGVhdmVzLm1hcCgobGVhZiwgaSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbGVhZk5hbWU6IHN0cmluZ1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGxlYWYgPT09ICdvYmplY3QnICYmIGxlYWY/Lm5hbWUpIGxlYWZOYW1lID0gbGVhZi5uYW1lXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbGVhZiA9PT0gJ3N0cmluZycpIGxlYWZOYW1lID0gbGVhZlxuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGxlYWZUeXBlID0gZW5hYmxlZExlYXZlc1tsZWFmTmFtZV1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgQnV0dG9uID0gbGVhZlR5cGU/LkJ1dHRvblxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChCdXR0b24pIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gPEJ1dHRvbiBmaWVsZFByb3BzPXtwcm9wc30ga2V5PXtpfSBwYXRoPXtwYXRofSAvPlxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fZWRpdG9yYH0gcmVmPXtlZGl0b3JSZWZ9PlxuICAgICAgICAgICAgICA8RWRpdGFibGVcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2lucHV0YH1cbiAgICAgICAgICAgICAgICBpZD17YGZpZWxkLSR7cGF0aC5yZXBsYWNlKC9cXC4vZywgJ19fJyl9YH1cbiAgICAgICAgICAgICAgICBvbktleURvd249eyhldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0VudGVyJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLmluc2VydFRleHQoJ1xcbicpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRFbGVtZW50ID0gTm9kZS5kZXNjZW5kYW50KFxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5hbmNob3IucGF0aC5zbGljZSgwLCAtMSksXG4gICAgICAgICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgICAgICAgaWYgKFNsYXRlRWxlbWVudC5pc0VsZW1lbnQoc2VsZWN0ZWRFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWxsb3cgaGFyZCBlbnRlciB0byBcImJyZWFrIG91dFwiIG9mIGNlcnRhaW4gZWxlbWVudHNcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlZGl0b3Iuc2hvdWxkQnJlYWtPdXRPbkVudGVyKHNlbGVjdGVkRWxlbWVudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZExlYWYgPSBOb2RlLmRlc2NlbmRhbnQoZWRpdG9yLCBlZGl0b3Iuc2VsZWN0aW9uLmFuY2hvci5wYXRoKVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0LmlzVGV4dChzZWxlY3RlZExlYWYpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nKHNlbGVjdGVkTGVhZi50ZXh0KS5sZW5ndGggPT09IGVkaXRvci5zZWxlY3Rpb24uYW5jaG9yLm9mZnNldFxuICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2Zvcm1zLmluc2VydE5vZGVzKGVkaXRvciwgeyBjaGlsZHJlbjogW3sgdGV4dDogJycgfV0gfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2Zvcm1zLnNwbGl0Tm9kZXMoZWRpdG9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zZm9ybXMuc2V0Tm9kZXMoZWRpdG9yLCB7fSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAnQmFja3NwYWNlJykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZEVsZW1lbnQgPSBOb2RlLmRlc2NlbmRhbnQoXG4gICAgICAgICAgICAgICAgICAgICAgZWRpdG9yLFxuICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uYW5jaG9yLnBhdGguc2xpY2UoMCwgLTEpLFxuICAgICAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKFNsYXRlRWxlbWVudC5pc0VsZW1lbnQoc2VsZWN0ZWRFbGVtZW50KSAmJiBzZWxlY3RlZEVsZW1lbnQudHlwZSA9PT0gJ2xpJykge1xuICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkTGVhZiA9IE5vZGUuZGVzY2VuZGFudChlZGl0b3IsIGVkaXRvci5zZWxlY3Rpb24uYW5jaG9yLnBhdGgpXG4gICAgICAgICAgICAgICAgICAgICAgaWYgKFRleHQuaXNUZXh0KHNlbGVjdGVkTGVhZikgJiYgU3RyaW5nKHNlbGVjdGVkTGVhZi50ZXh0KS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zZm9ybXMudW53cmFwTm9kZXMoZWRpdG9yLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoOiAobikgPT4gU2xhdGVFbGVtZW50LmlzRWxlbWVudChuKSAmJiBsaXN0VHlwZXMuaW5jbHVkZXMobi50eXBlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2xvd2VzdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIHsgdHlwZTogdW5kZWZpbmVkIH0pXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVkaXRvci5pc1ZvaWQoc2VsZWN0ZWRFbGVtZW50KSkge1xuICAgICAgICAgICAgICAgICAgICAgIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGhvdGtleXMpLmZvckVhY2goKGhvdGtleSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNIb3RrZXkoaG90a2V5LCBldmVudCBhcyBhbnkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hcmsgPSBob3RrZXlzW2hvdGtleV1cbiAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVMZWFmKGVkaXRvciwgbWFyaylcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXtnZXRUcmFuc2xhdGlvbihwbGFjZWhvbGRlciwgaTE4bil9XG4gICAgICAgICAgICAgICAgcmVhZE9ubHk9e3JlYWRPbmx5fVxuICAgICAgICAgICAgICAgIHJlbmRlckVsZW1lbnQ9e3JlbmRlckVsZW1lbnR9XG4gICAgICAgICAgICAgICAgcmVuZGVyTGVhZj17cmVuZGVyTGVhZn1cbiAgICAgICAgICAgICAgICBzcGVsbENoZWNrXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9TbGF0ZT5cbiAgICAgICAgPEZpZWxkRGVzY3JpcHRpb24gZGVzY3JpcHRpb249e2Rlc2NyaXB0aW9ufSB2YWx1ZT17dmFsdWV9IC8+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKVxufVxuZXhwb3J0IGRlZmF1bHQgd2l0aENvbmRpdGlvbihSaWNoVGV4dClcbiJdLCJuYW1lcyI6WyJkZWZhdWx0RWxlbWVudHMiLCJkZWZhdWx0TGVhdmVzIiwiYmFzZUNsYXNzIiwiUmljaFRleHQiLCJwcm9wcyIsIm5hbWUiLCJhZG1pbiIsImNsYXNzTmFtZSIsImNvbmRpdGlvbiIsImRlc2NyaXB0aW9uIiwiaGlkZUd1dHRlciIsInBsYWNlaG9sZGVyIiwicmVhZE9ubHkiLCJzdHlsZSIsIndpZHRoIiwidW5kZWZpbmVkIiwiZGVmYXVsdFZhbHVlIiwiZGVmYXVsdFZhbHVlRnJvbVByb3BzIiwibGFiZWwiLCJwYXRoIiwicGF0aEZyb21Qcm9wcyIsInJlcXVpcmVkIiwidmFsaWRhdGUiLCJyaWNoVGV4dFZhbGlkYXRlIiwiZWxlbWVudHMiLCJsZWF2ZXMiLCJpMThuIiwidXNlVHJhbnNsYXRpb24iLCJsb2FkZWQiLCJzZXRMb2FkZWQiLCJ1c2VTdGF0ZSIsImVuYWJsZWRFbGVtZW50cyIsInNldEVuYWJsZWRFbGVtZW50cyIsImVuYWJsZWRMZWF2ZXMiLCJzZXRFbmFibGVkTGVhdmVzIiwiZWRpdG9yUmVmIiwidXNlUmVmIiwidG9vbGJhclJlZiIsImRyYXdlckRlcHRoIiwidXNlRWRpdERlcHRoIiwiZHJhd2VySXNPcGVuIiwicmVuZGVyRWxlbWVudCIsInVzZUNhbGxiYWNrIiwiYXR0cmlidXRlcyIsImNoaWxkcmVuIiwiZWxlbWVudCIsIm1hdGNoZWRFbGVtZW50IiwidHlwZSIsIkVsZW1lbnQiLCJhdHRyIiwidGV4dEFsaWduIiwibWFyZ2luUmlnaHQiLCJtYXJnaW5MZWZ0IiwibGlzdFN0eWxlUG9zaXRpb24iLCJlbCIsImZpZWxkUHJvcHMiLCJkaXYiLCJyZW5kZXJMZWFmIiwibGVhZiIsIm1hdGNoZWRMZWF2ZXMiLCJPYmplY3QiLCJlbnRyaWVzIiwiZmlsdGVyIiwibGVhZk5hbWUiLCJsZW5ndGgiLCJyZWR1Y2UiLCJyZXN1bHQiLCJpIiwiTGVhZiIsImtleSIsInNwYW4iLCJtZW1vaXplZFZhbGlkYXRlIiwidmFsdWUiLCJ2YWxpZGF0aW9uT3B0aW9ucyIsImZpZWxkVHlwZSIsInVzZUZpZWxkIiwiZXJyb3JNZXNzYWdlIiwiaW5pdGlhbFZhbHVlIiwic2V0VmFsdWUiLCJzaG93RXJyb3IiLCJjbGFzc2VzIiwiQm9vbGVhbiIsImpvaW4iLCJlZGl0b3IiLCJ1c2VNZW1vIiwiQ3JlYXRlZEVkaXRvciIsIndpdGhFbnRlckJyZWFrT3V0Iiwid2l0aEhpc3RvcnkiLCJ3aXRoUmVhY3QiLCJjcmVhdGVFZGl0b3IiLCJ3aXRoSFRNTCIsImVuYWJsZVBsdWdpbnMiLCJoYW5kbGVDaGFuZ2UiLCJ2YWwiLCJvcHMiLCJvcGVyYXRpb25zIiwibyIsIkFycmF5IiwiaXNBcnJheSIsImRlZmF1bHRSaWNoVGV4dFZhbHVlIiwidXNlRWZmZWN0IiwibWVyZ2VkRWxlbWVudHMiLCJtZXJnZUN1c3RvbUZ1bmN0aW9ucyIsImVsZW1lbnRUeXBlcyIsIm1lcmdlZExlYXZlcyIsImxlYWZUeXBlcyIsInNldENsaWNrYWJsZVN0YXRlIiwiY2xpY2tTdGF0ZSIsInNlbGVjdG9ycyIsInRvb2xiYXJCdXR0b25zIiwiY3VycmVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiY2hpbGQiLCJpc0J1dHRvbiIsInRhZ05hbWUiLCJpc0Rpc2FibGluZyIsInNldEF0dHJpYnV0ZSIsInZhbHVlVG9SZW5kZXIiLCJwYXJzZWRKU09OIiwiSlNPTiIsInBhcnNlIiwiZXJyIiwiRXJyb3IiLCJtZXNzYWdlIiwiTGFiZWwiLCJodG1sRm9yIiwicmVwbGFjZSIsIlNsYXRlIiwic3RyaW5naWZ5Iiwib25DaGFuZ2UiLCJyZWYiLCJtYXAiLCJlbGVtZW50TmFtZSIsImVsZW1lbnRUeXBlIiwiQnV0dG9uIiwibGVhZlR5cGUiLCJFZGl0YWJsZSIsImlkIiwib25LZXlEb3duIiwiZXZlbnQiLCJzaGlmdEtleSIsInByZXZlbnREZWZhdWx0IiwiaW5zZXJ0VGV4dCIsInNlbGVjdGVkRWxlbWVudCIsIk5vZGUiLCJkZXNjZW5kYW50Iiwic2VsZWN0aW9uIiwiYW5jaG9yIiwic2xpY2UiLCJTbGF0ZUVsZW1lbnQiLCJpc0VsZW1lbnQiLCJzaG91bGRCcmVha091dE9uRW50ZXIiLCJzZWxlY3RlZExlYWYiLCJUZXh0IiwiaXNUZXh0IiwiU3RyaW5nIiwidGV4dCIsIm9mZnNldCIsIlRyYW5zZm9ybXMiLCJpbnNlcnROb2RlcyIsInNwbGl0Tm9kZXMiLCJzZXROb2RlcyIsInVud3JhcE5vZGVzIiwibWF0Y2giLCJuIiwibGlzdFR5cGVzIiwiaW5jbHVkZXMiLCJtb2RlIiwic3BsaXQiLCJpc1ZvaWQiLCJyZW1vdmVOb2RlcyIsImtleXMiLCJob3RrZXlzIiwiaG90a2V5IiwiaXNIb3RrZXkiLCJtYXJrIiwidG9nZ2xlTGVhZiIsImdldFRyYW5zbGF0aW9uIiwic3BlbGxDaGVjayIsIkZpZWxkRGVzY3JpcHRpb24iLCJ3aXRoQ29uZGl0aW9uIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7K0JBb2NBOzs7ZUFBQTs7O2lFQTlicUI7dUJBQ21EOzJCQUMzQzs0QkFDRTsrREFDMEM7OEJBQzFDO3VCQUMrQzs4QkFDbEQ7NEJBQ2U7OEJBSU47NEJBQ0o7aUVBQ1I7a0VBQ0g7c0VBQ0k7Z0VBQ047UUFDYjsrREFDZTsrREFDQzs2RUFDVTswRUFDSDtpRUFDVDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRXJCLE1BQU1BLGtCQUFxQztJQUN6QztJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7Q0FDRDtBQUNELE1BQU1DLGdCQUFnQztJQUFDO0lBQVE7SUFBVTtJQUFhO0lBQWlCO0NBQU87QUFFOUYsTUFBTUMsWUFBWTtBQVVsQixNQUFNQyxXQUFpQyxDQUFDQztJQUN0QyxNQUFNLEVBQ0pDLElBQUksRUFDSkMsT0FBTyxFQUNMQyxTQUFTLEVBQ1RDLFNBQVMsRUFDVEMsV0FBVyxFQUNYQyxVQUFVLEVBQ1ZDLFdBQVcsRUFDWEMsUUFBUSxFQUNSQyxLQUFLLEVBQ0xDLEtBQUssRUFDTixHQUFHO1FBQ0ZQLFdBQVdRO1FBQ1hQLFdBQVdPO1FBQ1hOLGFBQWFNO1FBQ2JMLFlBQVlLO1FBQ1pKLGFBQWFJO1FBQ2JILFVBQVVHO1FBQ1ZGLE9B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