'use client';
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _components = require("payload/components");
const _elements = require("payload/components/elements");
const _graphics = require("payload/components/graphics");
const _hooks = require("payload/components/hooks");
const _utilities = require("payload/components/utilities");
const _utilities1 = require("payload/utilities");
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _slate = require("slate");
const _slatereact = require("slate-react");
const _EnabledRelationshipsCondition = require("../../EnabledRelationshipsCondition");
const _UploadDrawer = require("./UploadDrawer");
require("./index.scss");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {};
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const baseClass = 'rich-text-upload';
const initialParams = {
    depth: 0
};
const Element = (props)=>{
    const { attributes, children, element: { relationTo, value }, element, enabledCollectionSlugs, fieldProps } = props;
    const { collections, routes: { api }, serverURL } = (0, _utilities.useConfig)();
    const { i18n, t } = (0, _reacti18next.useTranslation)('fields');
    const [cacheBust, dispatchCacheBust] = (0, _react.useReducer)((state)=>state + 1, 0);
    const [relatedCollection, setRelatedCollection] = (0, _react.useState)(()=>collections.find((coll)=>coll.slug === relationTo));
    const drawerSlug = (0, _elements.useDrawerSlug)('upload-drawer');
    const [ListDrawer, ListDrawerToggler, { closeDrawer: closeListDrawer }] = (0, _elements.useListDrawer)({
        collectionSlugs: enabledCollectionSlugs,
        selectedCollection: relatedCollection.slug
    });
    const [DocumentDrawer, DocumentDrawerToggler, { closeDrawer }] = (0, _elements.useDocumentDrawer)({
        id: value?.id,
        collectionSlug: relatedCollection.slug
    });
    const editor = (0, _slatereact.useSlateStatic)();
    const selected = (0, _slatereact.useSelected)();
    const focused = (0, _slatereact.useFocused)();
    // Get the referenced document
    const [{ data }, { setParams }] = (0, _hooks.usePayloadAPI)(`${serverURL}${api}/${relatedCollection.slug}/${value?.id}`, {
        initialParams
    });
    const thumbnailSRC = (0, _hooks.useThumbnail)(relatedCollection, data);
    const removeUpload = (0, _react.useCallback)(()=>{
        const elementPath = _slatereact.ReactEditor.findPath(editor, element);
        _slate.Transforms.removeNodes(editor, {
            at: elementPath
        });
    }, [
        editor,
        element
    ]);
    const updateUpload = (0, _react.useCallback)((json)=>{
        const { doc } = json;
        const newNode = {
            fields: doc
        };
        const elementPath = _slatereact.ReactEditor.findPath(editor, element);
        _slate.Transforms.setNodes(editor, newNode, {
            at: elementPath
        });
        // setRelatedCollection(collections.find((coll) => coll.slug === collectionConfig.slug));
        setParams({
            ...initialParams,
            cacheBust
        });
        dispatchCacheBust();
        closeDrawer();
    }, [
        editor,
        element,
        setParams,
        cacheBust,
        closeDrawer
    ]);
    const swapUpload = _react.default.useCallback(({ collectionConfig, docID })=>{
        const newNode = {
            children: [
                {
                    text: ' '
                }
            ],
            relationTo: collectionConfig.slug,
            type: 'upload',
            value: {
                id: docID
            }
        };
        const elementPath = _slatereact.ReactEditor.findPath(editor, element);
        setRelatedCollection(collections.find((coll)=>coll.slug === collectionConfig.slug));
        _slate.Transforms.setNodes(editor, newNode, {
            at: elementPath
        });
        dispatchCacheBust();
        closeListDrawer();
    }, [
        closeListDrawer,
        editor,
        element,
        collections
    ]);
    const customFields = fieldProps?.admin?.upload?.collections?.[relatedCollection.slug]?.fields;
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: [
            baseClass,
            selected && focused && `${baseClass}--selected`
        ].filter(Boolean).join(' '),
        contentEditable: false,
        ...attributes
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__card`
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__topRow`
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__thumbnail`
    }, thumbnailSRC ? /*#__PURE__*/ _react.default.createElement("img", {
        alt: data?.filename,
        src: thumbnailSRC
    }) : /*#__PURE__*/ _react.default.createElement(_graphics.FileGraphic, null)), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__topRowRightPanel`
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__collectionLabel`
    }, (0, _utilities1.getTranslation)(relatedCollection.labels.singular, i18n)), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__actions`
    }, customFields?.length > 0 && /*#__PURE__*/ _react.default.createElement(_elements.DrawerToggler, {
        className: `${baseClass}__upload-drawer-toggler`,
        disabled: fieldProps?.admin?.readOnly,
        slug: drawerSlug
    }, /*#__PURE__*/ _react.default.createElement(_components.Button, {
        buttonStyle: "icon-label",
        el: "div",
        icon: "edit",
        onClick: (e)=>{
            e.preventDefault();
        },
        round: true,
        tooltip: t('fields:editRelationship')
    })), /*#__PURE__*/ _react.default.createElement(ListDrawerToggler, {
        className: `${baseClass}__list-drawer-toggler`,
        disabled: fieldProps?.admin?.readOnly
    }, /*#__PURE__*/ _react.default.createElement(_components.Button, {
        buttonStyle: "icon-label",
        disabled: fieldProps?.admin?.readOnly,
        el: "div",
        icon: "swap",
        onClick: ()=>{
        // do nothing
        },
        round: true,
        tooltip: t('swapUpload')
    })), /*#__PURE__*/ _react.default.createElement(_components.Button, {
        buttonStyle: "icon-label",
        className: `${baseClass}__removeButton`,
        disabled: fieldProps?.admin?.readOnly,
        icon: "x",
        onClick: (e)=>{
            e.preventDefault();
            removeUpload();
        },
        round: true,
        tooltip: t('removeUpload')
    })))), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__bottomRow`
    }, /*#__PURE__*/ _react.default.createElement(DocumentDrawerToggler, {
        className: `${baseClass}__doc-drawer-toggler`
    }, /*#__PURE__*/ _react.default.createElement("strong", null, data?.filename)))), children, value?.id && /*#__PURE__*/ _react.default.createElement(DocumentDrawer, {
        onSave: updateUpload
    }), /*#__PURE__*/ _react.default.createElement(ListDrawer, {
        onSelect: swapUpload
    }), /*#__PURE__*/ _react.default.createElement(_UploadDrawer.UploadDrawer, {
        drawerSlug: drawerSlug,
        relatedCollection: relatedCollection,
        ...props
    }));
};
const _default = (props)=>{
    return /*#__PURE__*/ _react.default.createElement(_EnabledRelationshipsCondition.EnabledRelationshipsCondition, {
        ...props,
        uploads: true
    }, /*#__PURE__*/ _react.default.createElement(Element, props));
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9maWVsZC9lbGVtZW50cy91cGxvYWQvRWxlbWVudC9pbmRleC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBjbGllbnQnXG5cbmltcG9ydCB0eXBlIHsgU2FuaXRpemVkQ29sbGVjdGlvbkNvbmZpZyB9IGZyb20gJ3BheWxvYWQvdHlwZXMnXG5pbXBvcnQgdHlwZSB7IEhUTUxBdHRyaWJ1dGVzIH0gZnJvbSAncmVhY3QnXG5cbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ3BheWxvYWQvY29tcG9uZW50cydcbmltcG9ydCB7XG4gIERyYXdlclRvZ2dsZXIsXG4gIHVzZURvY3VtZW50RHJhd2VyLFxuICB1c2VEcmF3ZXJTbHVnLFxuICB1c2VMaXN0RHJhd2VyLFxufSBmcm9tICdwYXlsb2FkL2NvbXBvbmVudHMvZWxlbWVudHMnXG5pbXBvcnQgeyBGaWxlR3JhcGhpYyB9IGZyb20gJ3BheWxvYWQvY29tcG9uZW50cy9ncmFwaGljcydcbmltcG9ydCB7IHVzZVBheWxvYWRBUEksIHVzZVRodW1ibmFpbCB9IGZyb20gJ3BheWxvYWQvY29tcG9uZW50cy9ob29rcydcbmltcG9ydCB7IHVzZUNvbmZpZyB9IGZyb20gJ3BheWxvYWQvY29tcG9uZW50cy91dGlsaXRpZXMnXG5pbXBvcnQgeyBnZXRUcmFuc2xhdGlvbiB9IGZyb20gJ3BheWxvYWQvdXRpbGl0aWVzJ1xuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VSZWR1Y2VyLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgdXNlVHJhbnNsYXRpb24gfSBmcm9tICdyZWFjdC1pMThuZXh0J1xuaW1wb3J0IHsgVHJhbnNmb3JtcyB9IGZyb20gJ3NsYXRlJ1xuaW1wb3J0IHsgUmVhY3RFZGl0b3IsIHVzZUZvY3VzZWQsIHVzZVNlbGVjdGVkLCB1c2VTbGF0ZVN0YXRpYyB9IGZyb20gJ3NsYXRlLXJlYWN0J1xuXG5pbXBvcnQgdHlwZSB7IEZpZWxkUHJvcHMgfSBmcm9tICcuLi8uLi8uLi8uLi90eXBlcydcblxuaW1wb3J0IHsgRW5hYmxlZFJlbGF0aW9uc2hpcHNDb25kaXRpb24gfSBmcm9tICcuLi8uLi9FbmFibGVkUmVsYXRpb25zaGlwc0NvbmRpdGlvbidcbmltcG9ydCB7IFVwbG9hZERyYXdlciB9IGZyb20gJy4vVXBsb2FkRHJhd2VyJ1xuaW1wb3J0ICcuL2luZGV4LnNjc3MnXG5cbmNvbnN0IGJhc2VDbGFzcyA9ICdyaWNoLXRleHQtdXBsb2FkJ1xuXG5jb25zdCBpbml0aWFsUGFyYW1zID0ge1xuICBkZXB0aDogMCxcbn1cblxuZXhwb3J0IHR5cGUgRWxlbWVudFByb3BzID0ge1xuICBhdHRyaWJ1dGVzOiBIVE1MQXR0cmlidXRlczxIVE1MRGl2RWxlbWVudD5cbiAgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZVxuICBlbGVtZW50OiBhbnlcbiAgZW5hYmxlZENvbGxlY3Rpb25TbHVnczogc3RyaW5nW11cbiAgZmllbGRQcm9wczogRmllbGRQcm9wc1xufVxuXG5jb25zdCBFbGVtZW50OiBSZWFjdC5GQzxFbGVtZW50UHJvcHM+ID0gKHByb3BzKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBhdHRyaWJ1dGVzLFxuICAgIGNoaWxkcmVuLFxuICAgIGVsZW1lbnQ6IHsgcmVsYXRpb25UbywgdmFsdWUgfSxcbiAgICBlbGVtZW50LFxuICAgIGVuYWJsZWRDb2xsZWN0aW9uU2x1Z3MsXG4gICAgZmllbGRQcm9wcyxcbiAgfSA9IHByb3BzXG5cbiAgY29uc3Qge1xuICAgIGNvbGxlY3Rpb25zLFxuICAgIHJvdXRlczogeyBhcGkgfSxcbiAgICBzZXJ2ZXJVUkwsXG4gIH0gPSB1c2VDb25maWcoKVxuICBjb25zdCB7IGkxOG4sIHQgfSA9IHVzZVRyYW5zbGF0aW9uKCdmaWVsZHMnKVxuICBjb25zdCBbY2FjaGVCdXN0LCBkaXNwYXRjaENhY2hlQnVzdF0gPSB1c2VSZWR1Y2VyKChzdGF0ZSkgPT4gc3RhdGUgKyAxLCAwKVxuICBjb25zdCBbcmVsYXRlZENvbGxlY3Rpb24sIHNldFJlbGF0ZWRDb2xsZWN0aW9uXSA9IHVzZVN0YXRlPFNhbml0aXplZENvbGxlY3Rpb25Db25maWc+KCgpID0+XG4gICAgY29sbGVjdGlvbnMuZmluZCgoY29sbCkgPT4gY29sbC5zbHVnID09PSByZWxhdGlvblRvKSxcbiAgKVxuXG4gIGNvbnN0IGRyYXdlclNsdWcgPSB1c2VEcmF3ZXJTbHVnKCd1cGxvYWQtZHJhd2VyJylcblxuICBjb25zdCBbTGlzdERyYXdlciwgTGlzdERyYXdlclRvZ2dsZXIsIHsgY2xvc2VEcmF3ZXI6IGNsb3NlTGlzdERyYXdlciB9XSA9IHVzZUxpc3REcmF3ZXIoe1xuICAgIGNvbGxlY3Rpb25TbHVnczogZW5hYmxlZENvbGxlY3Rpb25TbHVncyxcbiAgICBzZWxlY3RlZENvbGxlY3Rpb246IHJlbGF0ZWRDb2xsZWN0aW9uLnNsdWcsXG4gIH0pXG5cbiAgY29uc3QgW0RvY3VtZW50RHJhd2VyLCBEb2N1bWVudERyYXdlclRvZ2dsZXIsIHsgY2xvc2VEcmF3ZXIgfV0gPSB1c2VEb2N1bWVudERyYXdlcih7XG4gICAgaWQ6IHZhbHVlPy5pZCxcbiAgICBjb2xsZWN0aW9uU2x1ZzogcmVsYXRlZENvbGxlY3Rpb24uc2x1ZyxcbiAgfSlcblxuICBjb25zdCBlZGl0b3IgPSB1c2VTbGF0ZVN0YXRpYygpXG4gIGNvbnN0IHNlbGVjdGVkID0gdXNlU2VsZWN0ZWQoKVxuICBjb25zdCBmb2N1c2VkID0gdXNlRm9jdXNlZCgpXG5cbiAgLy8gR2V0IHRoZSByZWZlcmVuY2VkIGRvY3VtZW50XG4gIGNvbnN0IFt7IGRhdGEgfSwgeyBzZXRQYXJhbXMgfV0gPSB1c2VQYXlsb2FkQVBJKFxuICAgIGAke3NlcnZlclVSTH0ke2FwaX0vJHtyZWxhdGVkQ29sbGVjdGlvbi5zbHVnfS8ke3ZhbHVlPy5pZH1gLFxuICAgIHsgaW5pdGlhbFBhcmFtcyB9LFxuICApXG5cbiAgY29uc3QgdGh1bWJuYWlsU1JDID0gdXNlVGh1bWJuYWlsKHJlbGF0ZWRDb2xsZWN0aW9uLCBkYXRhKVxuXG4gIGNvbnN0IHJlbW92ZVVwbG9hZCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBjb25zdCBlbGVtZW50UGF0aCA9IFJlYWN0RWRpdG9yLmZpbmRQYXRoKGVkaXRvciwgZWxlbWVudClcblxuICAgIFRyYW5zZm9ybXMucmVtb3ZlTm9kZXMoZWRpdG9yLCB7IGF0OiBlbGVtZW50UGF0aCB9KVxuICB9LCBbZWRpdG9yLCBlbGVtZW50XSlcblxuICBjb25zdCB1cGRhdGVVcGxvYWQgPSB1c2VDYWxsYmFjayhcbiAgICAoanNvbikgPT4ge1xuICAgICAgY29uc3QgeyBkb2MgfSA9IGpzb25cblxuICAgICAgY29uc3QgbmV3Tm9kZSA9IHtcbiAgICAgICAgZmllbGRzOiBkb2MsXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVsZW1lbnRQYXRoID0gUmVhY3RFZGl0b3IuZmluZFBhdGgoZWRpdG9yLCBlbGVtZW50KVxuXG4gICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwgbmV3Tm9kZSwgeyBhdDogZWxlbWVudFBhdGggfSlcblxuICAgICAgLy8gc2V0UmVsYXRlZENvbGxlY3Rpb24oY29sbGVjdGlvbnMuZmluZCgoY29sbCkgPT4gY29sbC5zbHVnID09PSBjb2xsZWN0aW9uQ29uZmlnLnNsdWcpKTtcblxuICAgICAgc2V0UGFyYW1zKHtcbiAgICAgICAgLi4uaW5pdGlhbFBhcmFtcyxcbiAgICAgICAgY2FjaGVCdXN0LCAvLyBkbyB0aGlzIHRvIGdldCB0aGUgdXNlUGF5bG9hZEFQSSB0byByZS1mZXRjaCB0aGUgZGF0YSBldmVuIHRob3VnaCB0aGUgVVJMIHN0cmluZyBoYXNuJ3QgY2hhbmdlZFxuICAgICAgfSlcblxuICAgICAgZGlzcGF0Y2hDYWNoZUJ1c3QoKVxuICAgICAgY2xvc2VEcmF3ZXIoKVxuICAgIH0sXG4gICAgW2VkaXRvciwgZWxlbWVudCwgc2V0UGFyYW1zLCBjYWNoZUJ1c3QsIGNsb3NlRHJhd2VyXSxcbiAgKVxuXG4gIGNvbnN0IHN3YXBVcGxvYWQgPSBSZWFjdC51c2VDYWxsYmFjayhcbiAgICAoeyBjb2xsZWN0aW9uQ29uZmlnLCBkb2NJRCB9KSA9PiB7XG4gICAgICBjb25zdCBuZXdOb2RlID0ge1xuICAgICAgICBjaGlsZHJlbjogW3sgdGV4dDogJyAnIH1dLFxuICAgICAgICByZWxhdGlvblRvOiBjb2xsZWN0aW9uQ29uZmlnLnNsdWcsXG4gICAgICAgIHR5cGU6ICd1cGxvYWQnLFxuICAgICAgICB2YWx1ZTogeyBpZDogZG9jSUQgfSxcbiAgICAgIH1cblxuICAgICAgY29uc3QgZWxlbWVudFBhdGggPSBSZWFjdEVkaXRvci5maW5kUGF0aChlZGl0b3IsIGVsZW1lbnQpXG5cbiAgICAgIHNldFJlbGF0ZWRDb2xsZWN0aW9uKGNvbGxlY3Rpb25zLmZpbmQoKGNvbGwpID0+IGNvbGwuc2x1ZyA9PT0gY29sbGVjdGlvbkNvbmZpZy5zbHVnKSlcblxuICAgICAgVHJhbnNmb3Jtcy5zZXROb2RlcyhlZGl0b3IsIG5ld05vZGUsIHsgYXQ6IGVsZW1lbnRQYXRoIH0pXG5cbiAgICAgIGRpc3BhdGNoQ2FjaGVCdXN0KClcbiAgICAgIGNsb3NlTGlzdERyYXdlcigpXG4gICAgfSxcbiAgICBbY2xvc2VMaXN0RHJhd2VyLCBlZGl0b3IsIGVsZW1lbnQsIGNvbGxlY3Rpb25zXSxcbiAgKVxuXG4gIGNvbnN0IGN1c3RvbUZpZWxkcyA9IGZpZWxkUHJvcHM/LmFkbWluPy51cGxvYWQ/LmNvbGxlY3Rpb25zPy5bcmVsYXRlZENvbGxlY3Rpb24uc2x1Z10/LmZpZWxkc1xuXG4gIHJldHVybiAoXG4gICAgPGRpdlxuICAgICAgY2xhc3NOYW1lPXtbYmFzZUNsYXNzLCBzZWxlY3RlZCAmJiBmb2N1c2VkICYmIGAke2Jhc2VDbGFzc30tLXNlbGVjdGVkYF1cbiAgICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgICAuam9pbignICcpfVxuICAgICAgY29udGVudEVkaXRhYmxlPXtmYWxzZX1cbiAgICAgIHsuLi5hdHRyaWJ1dGVzfVxuICAgID5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19jYXJkYH0+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X190b3BSb3dgfT5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fdGh1bWJuYWlsYH0+XG4gICAgICAgICAgICB7dGh1bWJuYWlsU1JDID8gPGltZyBhbHQ9e2RhdGE/LmZpbGVuYW1lfSBzcmM9e3RodW1ibmFpbFNSQ30gLz4gOiA8RmlsZUdyYXBoaWMgLz59XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3RvcFJvd1JpZ2h0UGFuZWxgfT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19jb2xsZWN0aW9uTGFiZWxgfT5cbiAgICAgICAgICAgICAge2dldFRyYW5zbGF0aW9uKHJlbGF0ZWRDb2xsZWN0aW9uLmxhYmVscy5zaW5ndWxhciwgaTE4bil9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19hY3Rpb25zYH0+XG4gICAgICAgICAgICAgIHtjdXN0b21GaWVsZHM/Lmxlbmd0aCA+IDAgJiYgKFxuICAgICAgICAgICAgICAgIDxEcmF3ZXJUb2dnbGVyXG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3VwbG9hZC1kcmF3ZXItdG9nZ2xlcmB9XG4gICAgICAgICAgICAgICAgICBkaXNhYmxlZD17ZmllbGRQcm9wcz8uYWRtaW4/LnJlYWRPbmx5fVxuICAgICAgICAgICAgICAgICAgc2x1Zz17ZHJhd2VyU2x1Z31cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwiaWNvbi1sYWJlbFwiXG4gICAgICAgICAgICAgICAgICAgIGVsPVwiZGl2XCJcbiAgICAgICAgICAgICAgICAgICAgaWNvbj1cImVkaXRcIlxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICByb3VuZFxuICAgICAgICAgICAgICAgICAgICB0b29sdGlwPXt0KCdmaWVsZHM6ZWRpdFJlbGF0aW9uc2hpcCcpfVxuICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L0RyYXdlclRvZ2dsZXI+XG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIDxMaXN0RHJhd2VyVG9nZ2xlclxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fbGlzdC1kcmF3ZXItdG9nZ2xlcmB9XG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2ZpZWxkUHJvcHM/LmFkbWluPy5yZWFkT25seX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwiaWNvbi1sYWJlbFwiXG4gICAgICAgICAgICAgICAgICBkaXNhYmxlZD17ZmllbGRQcm9wcz8uYWRtaW4/LnJlYWRPbmx5fVxuICAgICAgICAgICAgICAgICAgZWw9XCJkaXZcIlxuICAgICAgICAgICAgICAgICAgaWNvbj1cInN3YXBcIlxuICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nXG4gICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgcm91bmRcbiAgICAgICAgICAgICAgICAgIHRvb2x0aXA9e3QoJ3N3YXBVcGxvYWQnKX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8L0xpc3REcmF3ZXJUb2dnbGVyPlxuICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJpY29uLWxhYmVsXCJcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3JlbW92ZUJ1dHRvbmB9XG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2ZpZWxkUHJvcHM/LmFkbWluPy5yZWFkT25seX1cbiAgICAgICAgICAgICAgICBpY29uPVwieFwiXG4gICAgICAgICAgICAgICAgb25DbGljaz17KGUpID0+IHtcbiAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgICAgICAgICAgICAgICAgcmVtb3ZlVXBsb2FkKClcbiAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgIHJvdW5kXG4gICAgICAgICAgICAgICAgdG9vbHRpcD17dCgncmVtb3ZlVXBsb2FkJyl9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19ib3R0b21Sb3dgfT5cbiAgICAgICAgICA8RG9jdW1lbnREcmF3ZXJUb2dnbGVyIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fZG9jLWRyYXdlci10b2dnbGVyYH0+XG4gICAgICAgICAgICA8c3Ryb25nPntkYXRhPy5maWxlbmFtZX08L3N0cm9uZz5cbiAgICAgICAgICA8L0RvY3VtZW50RHJhd2VyVG9nZ2xlcj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIHtjaGlsZHJlbn1cbiAgICAgIHt2YWx1ZT8uaWQgJiYgPERvY3VtZW50RHJhd2VyIG9uU2F2ZT17dXBkYXRlVXBsb2FkfSAvPn1cbiAgICAgIDxMaXN0RHJhd2VyIG9uU2VsZWN0PXtzd2FwVXBsb2FkfSAvPlxuICAgICAgPFVwbG9hZERyYXdlciBkcmF3ZXJTbHVnPXtkcmF3ZXJTbHVnfSByZWxhdGVkQ29sbGVjdGlvbj17cmVsYXRlZENvbGxlY3Rpb259IHsuLi5wcm9wc30gLz5cbiAgICA8L2Rpdj5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCAocHJvcHM6IEVsZW1lbnRQcm9wcyk6IFJlYWN0LlJlYWN0Tm9kZSA9PiB7XG4gIHJldHVybiAoXG4gICAgPEVuYWJsZWRSZWxhdGlvbnNoaXBzQ29uZGl0aW9uIHsuLi5wcm9wc30gdXBsb2Fkcz5cbiAgICAgIDxFbGVtZW50IHsuLi5wcm9wc30gLz5cbiAgICA8L0VuYWJsZWRSZWxhdGlvbnNoaXBzQ29uZGl0aW9uPlxuICApXG59XG4iXSwibmFtZXMiOlsiYmFzZUNsYXNzIiwiaW5pdGlhbFBhcmFtcyIsImRlcHRoIiwiRWxlbWVudCIsInByb3BzIiwiYXR0cmlidXRlcyIsImNoaWxkcmVuIiwiZWxlbWVudCIsInJlbGF0aW9uVG8iLCJ2YWx1ZSIsImVuYWJsZWRDb2xsZWN0aW9uU2x1Z3MiLCJmaWVsZFByb3BzIiwiY29sbGVjdGlvbnMiLCJyb3V0ZXMiLCJhcGkiLCJzZXJ2ZXJVUkwiLCJ1c2VDb25maWciLCJpMThuIiwidCIsInVzZVRyYW5zbGF0aW9uIiwiY2FjaGVCdXN0IiwiZGlzcGF0Y2hDYWNoZUJ1c3QiLCJ1c2VSZWR1Y2VyIiwic3RhdGUiLCJyZWxhdGVkQ29sbGVjdGlvbiIsInNldFJlbGF0ZWRDb2xsZWN0aW9uIiwidXNlU3RhdGUiLCJmaW5kIiwiY29sbCIsInNsdWciLCJkcmF3ZXJTbHVnIiwidXNlRHJhd2VyU2x1ZyIsIkxpc3REcmF3ZXIiLCJMaXN0RHJhd2VyVG9nZ2xlciIsImNsb3NlRHJhd2VyIiwiY2xvc2VMaXN0RHJhd2VyIiwidXNlTGlzdERyYXdlciIsImNvbGxlY3Rpb25TbHVncyIsInNlbGVjdGVkQ29sbGVjdGlvbiIsIkRvY3VtZW50RHJhd2VyIiwiRG9jdW1lbnREcmF3ZXJUb2dnbGVyIiwidXNlRG9jdW1lbnREcmF3ZXIiLCJpZCIsImNvbGxlY3Rpb25TbHVnIiwiZWRpdG9yIiwidXNlU2xhdGVTdGF0aWMiLCJzZWxlY3RlZCIsInVzZVNlbGVjdGVkIiwiZm9jdXNlZCIsInVzZUZvY3VzZWQiLCJkYXRhIiwic2V0UGFyYW1zIiwidXNlUGF5bG9hZEFQSSIsInRodW1ibmFpbFNSQyIsInVzZVRodW1ibmFpbCIsInJlbW92ZVVwbG9hZCIsInVzZUNhbGxiYWNrIiwiZWxlbWVudFBhdGgiLCJSZWFjdEVkaXRvciIsImZpbmRQYXRoIiwiVHJhbnNmb3JtcyIsInJlbW92ZU5vZGVzIiwiYXQiLCJ1cGRhdGVVcGxvYWQiLCJqc29uIiwiZG9jIiwibmV3Tm9kZSIsImZpZWxkcyIsInNldE5vZGVzIiwic3dhcFVwbG9hZCIsIlJlYWN0IiwiY29sbGVjdGlvbkNvbmZpZyIsImRvY0lEIiwidGV4dCIsInR5cGUiLCJjdXN0b21GaWVsZHMiLCJhZG1pbiIsInVwbG9hZCIsImRpdiIsImNsYXNzTmFtZSIsImZpbHRlciIsIkJvb2xlYW4iLCJqb2luIiwiY29udGVudEVkaXRhYmxlIiwiaW1nIiwiYWx0IiwiZmlsZW5hbWUiLCJzcmMiLCJGaWxlR3JhcGhpYyIsImdldFRyYW5zbGF0aW9uIiwibGFiZWxzIiwic2luZ3VsYXIiLCJsZW5ndGgiLCJEcmF3ZXJUb2dnbGVyIiwiZGlzYWJsZWQiLCJyZWFkT25seSIsIkJ1dHRvbiIsImJ1dHRvblN0eWxlIiwiZWwiLCJpY29uIiwib25DbGljayIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInJvdW5kIiwidG9vbHRpcCIsInN0cm9uZyIsIm9uU2F2ZSIsIm9uU2VsZWN0IiwiVXBsb2FkRHJhd2VyIiwiRW5hYmxlZFJlbGF0aW9uc2hpcHNDb25kaXRpb24iLCJ1cGxvYWRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7K0JBNk5BOzs7ZUFBQTs7OzRCQXhOdUI7MEJBTWhCOzBCQUNxQjt1QkFDZ0I7MkJBQ2xCOzRCQUNLOytEQUMwQjs4QkFDMUI7dUJBQ0o7NEJBQzBDOytDQUl2Qjs4QkFDakI7UUFDdEI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFUCxNQUFNQSxZQUFZO0FBRWxCLE1BQU1DLGdCQUFnQjtJQUNw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