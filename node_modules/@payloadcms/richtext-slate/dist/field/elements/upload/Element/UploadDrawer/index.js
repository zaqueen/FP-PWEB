'use client';
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "UploadDrawer", {
    enumerable: true,
    get: function() {
        return UploadDrawer;
    }
});
const _modal = require("@faceless-ui/modal");
const _elements = require("payload/components/elements");
const _forms = require("payload/components/forms");
const _utilities = require("payload/components/utilities");
const _config = require("payload/config");
const _utilities1 = require("payload/utilities");
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _slate = require("slate");
const _slatereact = require("slate-react");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {};
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const UploadDrawer = (props)=>{
    const editor = (0, _slatereact.useSlateStatic)();
    const { drawerSlug, element, fieldProps, relatedCollection } = props;
    const { i18n, t } = (0, _reacti18next.useTranslation)();
    const { code: locale } = (0, _utilities.useLocale)();
    const { user } = (0, _utilities.useAuth)();
    const { closeModal } = (0, _modal.useModal)();
    const { getDocPreferences } = (0, _utilities.useDocumentInfo)();
    const [initialState, setInitialState] = (0, _react.useState)({});
    const fieldSchemaUnsanitized = fieldProps?.admin?.upload?.collections?.[relatedCollection.slug]?.fields;
    const config = (0, _utilities.useConfig)();
    // Sanitize custom fields here
    const validRelationships = config.collections.map((c)=>c.slug) || [];
    const fieldSchema = (0, _config.sanitizeFields)({
        config: config,
        fields: fieldSchemaUnsanitized,
        validRelationships
    });
    const handleUpdateEditData = (0, _react.useCallback)((_, data)=>{
        const newNode = {
            fields: data
        };
        const elementPath = _slatereact.ReactEditor.findPath(editor, element);
        _slate.Transforms.setNodes(editor, newNode, {
            at: elementPath
        });
        closeModal(drawerSlug);
    }, [
        closeModal,
        editor,
        element,
        drawerSlug
    ]);
    (0, _react.useEffect)(()=>{
        // Sanitize custom fields here
        const validRelationships = config.collections.map((c)=>c.slug) || [];
        const fieldSchema = (0, _config.sanitizeFields)({
            config: config,
            fields: fieldSchemaUnsanitized,
            validRelationships
        });
        const awaitInitialState = async ()=>{
            const preferences = await getDocPreferences();
            const state = await (0, _utilities.buildStateFromSchema)({
                config,
                data: (0, _utilities1.deepCopyObject)(element?.fields || {}),
                fieldSchema,
                locale,
                operation: 'update',
                preferences,
                t,
                user
            });
            setInitialState(state);
        };
        awaitInitialState();
    }, [
        fieldSchemaUnsanitized,
        config,
        element.fields,
        user,
        locale,
        t,
        getDocPreferences
    ]);
    return /*#__PURE__*/ _react.default.createElement(_elements.Drawer, {
        slug: drawerSlug,
        title: t('general:editLabel', {
            label: (0, _utilities1.getTranslation)(relatedCollection.labels.singular, i18n)
        })
    }, /*#__PURE__*/ _react.default.createElement(_forms.Form, {
        initialState: initialState,
        onSubmit: handleUpdateEditData
    }, /*#__PURE__*/ _react.default.createElement(_forms.RenderFields, {
        fieldSchema: fieldSchema,
        fieldTypes: _forms.fieldTypes,
        readOnly: false
    }), /*#__PURE__*/ _react.default.createElement(_forms.FormSubmit, null, t('fields:saveChanges'))));
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9maWVsZC9lbGVtZW50cy91cGxvYWQvRWxlbWVudC9VcGxvYWREcmF3ZXIvaW5kZXgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIid1c2UgY2xpZW50J1xuXG5pbXBvcnQgdHlwZSB7IFNhbml0aXplZENvbGxlY3Rpb25Db25maWcgfSBmcm9tICdwYXlsb2FkL3R5cGVzJ1xuXG5pbXBvcnQgeyB1c2VNb2RhbCB9IGZyb20gJ0BmYWNlbGVzcy11aS9tb2RhbCdcbmltcG9ydCB7IERyYXdlciB9IGZyb20gJ3BheWxvYWQvY29tcG9uZW50cy9lbGVtZW50cydcbmltcG9ydCB7IEZvcm0sIEZvcm1TdWJtaXQsIFJlbmRlckZpZWxkcywgZmllbGRUeXBlcyB9IGZyb20gJ3BheWxvYWQvY29tcG9uZW50cy9mb3JtcydcbmltcG9ydCB7XG4gIGJ1aWxkU3RhdGVGcm9tU2NoZW1hLFxuICB1c2VBdXRoLFxuICB1c2VDb25maWcsXG4gIHVzZURvY3VtZW50SW5mbyxcbiAgdXNlTG9jYWxlLFxufSBmcm9tICdwYXlsb2FkL2NvbXBvbmVudHMvdXRpbGl0aWVzJ1xuaW1wb3J0IHsgc2FuaXRpemVGaWVsZHMgfSBmcm9tICdwYXlsb2FkL2NvbmZpZydcbmltcG9ydCB7IGRlZXBDb3B5T2JqZWN0LCBnZXRUcmFuc2xhdGlvbiB9IGZyb20gJ3BheWxvYWQvdXRpbGl0aWVzJ1xuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyB1c2VUcmFuc2xhdGlvbiB9IGZyb20gJ3JlYWN0LWkxOG5leHQnXG5pbXBvcnQgeyBUcmFuc2Zvcm1zIH0gZnJvbSAnc2xhdGUnXG5pbXBvcnQgeyBSZWFjdEVkaXRvciwgdXNlU2xhdGVTdGF0aWMgfSBmcm9tICdzbGF0ZS1yZWFjdCdcblxuaW1wb3J0IHR5cGUgeyBFbGVtZW50UHJvcHMgfSBmcm9tICcuLidcblxuZXhwb3J0IGNvbnN0IFVwbG9hZERyYXdlcjogUmVhY3QuRkM8XG4gIEVsZW1lbnRQcm9wcyAmIHtcbiAgICBkcmF3ZXJTbHVnOiBzdHJpbmdcbiAgICByZWxhdGVkQ29sbGVjdGlvbjogU2FuaXRpemVkQ29sbGVjdGlvbkNvbmZpZ1xuICB9XG4+ID0gKHByb3BzKSA9PiB7XG4gIGNvbnN0IGVkaXRvciA9IHVzZVNsYXRlU3RhdGljKClcblxuICBjb25zdCB7IGRyYXdlclNsdWcsIGVsZW1lbnQsIGZpZWxkUHJvcHMsIHJlbGF0ZWRDb2xsZWN0aW9uIH0gPSBwcm9wc1xuXG4gIGNvbnN0IHsgaTE4biwgdCB9ID0gdXNlVHJhbnNsYXRpb24oKVxuICBjb25zdCB7IGNvZGU6IGxvY2FsZSB9ID0gdXNlTG9jYWxlKClcbiAgY29uc3QgeyB1c2VyIH0gPSB1c2VBdXRoKClcbiAgY29uc3QgeyBjbG9zZU1vZGFsIH0gPSB1c2VNb2RhbCgpXG4gIGNvbnN0IHsgZ2V0RG9jUHJlZmVyZW5jZXMgfSA9IHVzZURvY3VtZW50SW5mbygpXG4gIGNvbnN0IFtpbml0aWFsU3RhdGUsIHNldEluaXRpYWxTdGF0ZV0gPSB1c2VTdGF0ZSh7fSlcbiAgY29uc3QgZmllbGRTY2hlbWFVbnNhbml0aXplZCA9XG4gICAgZmllbGRQcm9wcz8uYWRtaW4/LnVwbG9hZD8uY29sbGVjdGlvbnM/LltyZWxhdGVkQ29sbGVjdGlvbi5zbHVnXT8uZmllbGRzXG4gIGNvbnN0IGNvbmZpZyA9IHVzZUNvbmZpZygpXG5cbiAgLy8gU2FuaXRpemUgY3VzdG9tIGZpZWxkcyBoZXJlXG4gIGNvbnN0IHZhbGlkUmVsYXRpb25zaGlwcyA9IGNvbmZpZy5jb2xsZWN0aW9ucy5tYXAoKGMpID0+IGMuc2x1ZykgfHwgW11cbiAgY29uc3QgZmllbGRTY2hlbWEgPSBzYW5pdGl6ZUZpZWxkcyh7XG4gICAgY29uZmlnOiBjb25maWcsXG4gICAgZmllbGRzOiBmaWVsZFNjaGVtYVVuc2FuaXRpemVkLFxuICAgIHZhbGlkUmVsYXRpb25zaGlwcyxcbiAgfSlcblxuICBjb25zdCBoYW5kbGVVcGRhdGVFZGl0RGF0YSA9IHVzZUNhbGxiYWNrKFxuICAgIChfLCBkYXRhKSA9PiB7XG4gICAgICBjb25zdCBuZXdOb2RlID0ge1xuICAgICAgICBmaWVsZHM6IGRhdGEsXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVsZW1lbnRQYXRoID0gUmVhY3RFZGl0b3IuZmluZFBhdGgoZWRpdG9yLCBlbGVtZW50KVxuXG4gICAgICBUcmFuc2Zvcm1zLnNldE5vZGVzKGVkaXRvciwgbmV3Tm9kZSwgeyBhdDogZWxlbWVudFBhdGggfSlcbiAgICAgIGNsb3NlTW9kYWwoZHJhd2VyU2x1ZylcbiAgICB9LFxuICAgIFtjbG9zZU1vZGFsLCBlZGl0b3IsIGVsZW1lbnQsIGRyYXdlclNsdWddLFxuICApXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBTYW5pdGl6ZSBjdXN0b20gZmllbGRzIGhlcmVcbiAgICBjb25zdCB2YWxpZFJlbGF0aW9uc2hpcHMgPSBjb25maWcuY29sbGVjdGlvbnMubWFwKChjKSA9PiBjLnNsdWcpIHx8IFtdXG4gICAgY29uc3QgZmllbGRTY2hlbWEgPSBzYW5pdGl6ZUZpZWxkcyh7XG4gICAgICBjb25maWc6IGNvbmZpZyxcbiAgICAgIGZpZWxkczogZmllbGRTY2hlbWFVbnNhbml0aXplZCxcbiAgICAgIHZhbGlkUmVsYXRpb25zaGlwcyxcbiAgICB9KVxuXG4gICAgY29uc3QgYXdhaXRJbml0aWFsU3RhdGUgPSBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwcmVmZXJlbmNlcyA9IGF3YWl0IGdldERvY1ByZWZlcmVuY2VzKClcbiAgICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgYnVpbGRTdGF0ZUZyb21TY2hlbWEoe1xuICAgICAgICBjb25maWcsXG4gICAgICAgIGRhdGE6IGRlZXBDb3B5T2JqZWN0KGVsZW1lbnQ/LmZpZWxkcyB8fCB7fSksXG4gICAgICAgIGZpZWxkU2NoZW1hLFxuICAgICAgICBsb2NhbGUsXG4gICAgICAgIG9wZXJhdGlvbjogJ3VwZGF0ZScsXG4gICAgICAgIHByZWZlcmVuY2VzLFxuICAgICAgICB0LFxuICAgICAgICB1c2VyLFxuICAgICAgfSlcbiAgICAgIHNldEluaXRpYWxTdGF0ZShzdGF0ZSlcbiAgICB9XG5cbiAgICBhd2FpdEluaXRpYWxTdGF0ZSgpXG4gIH0sIFtmaWVsZFNjaGVtYVVuc2FuaXRpemVkLCBjb25maWcsIGVsZW1lbnQuZmllbGRzLCB1c2VyLCBsb2NhbGUsIHQsIGdldERvY1ByZWZlcmVuY2VzXSlcblxuICByZXR1cm4gKFxuICAgIDxEcmF3ZXJcbiAgICAgIHNsdWc9e2RyYXdlclNsdWd9XG4gICAgICB0aXRsZT17dCgnZ2VuZXJhbDplZGl0TGFiZWwnLCB7XG4gICAgICAgIGxhYmVsOiBnZXRUcmFuc2xhdGlvbihyZWxhdGVkQ29sbGVjdGlvbi5sYWJlbHMuc2luZ3VsYXIsIGkxOG4pLFxuICAgICAgfSl9XG4gICAgPlxuICAgICAgPEZvcm0gaW5pdGlhbFN0YXRlPXtpbml0aWFsU3RhdGV9IG9uU3VibWl0PXtoYW5kbGVVcGRhdGVFZGl0RGF0YX0+XG4gICAgICAgIDxSZW5kZXJGaWVsZHMgZmllbGRTY2hlbWE9e2ZpZWxkU2NoZW1hfSBmaWVsZFR5cGVzPXtmaWVsZFR5cGVzfSByZWFkT25seT17ZmFsc2V9IC8+XG4gICAgICAgIDxGb3JtU3VibWl0Pnt0KCdmaWVsZHM6c2F2ZUNoYW5nZXMnKX08L0Zvcm1TdWJtaXQ+XG4gICAgICA8L0Zvcm0+XG4gICAgPC9EcmF3ZXI+XG4gIClcbn1cbiJdLCJuYW1lcyI6WyJVcGxvYWREcmF3ZXIiLCJwcm9wcyIsImVkaXRvciIsInVzZVNsYXRlU3RhdGljIiwiZHJhd2VyU2x1ZyIsImVsZW1lbnQiLCJmaWVsZFByb3BzIiwicmVsYXRlZENvbGxlY3Rpb24iLCJpMThuIiwidCIsInVzZVRyYW5zbGF0aW9uIiwiY29kZSIsImxvY2FsZSIsInVzZUxvY2FsZSIsInVzZXIiLCJ1c2VBdXRoIiwiY2xvc2VNb2RhbCIsInVzZU1vZGFsIiwiZ2V0RG9jUHJlZmVyZW5jZXMiLCJ1c2VEb2N1bWVudEluZm8iLCJpbml0aWFsU3RhdGUiLCJzZXRJbml0aWFsU3RhdGUiLCJ1c2VTdGF0ZSIsImZpZWxkU2NoZW1hVW5zYW5pdGl6ZWQiLCJhZG1pbiIsInVwbG9hZCIsImNvbGxlY3Rpb25zIiwic2x1ZyIsImZpZWxkcyIsImNvbmZpZyIsInVzZUNvbmZpZyIsInZhbGlkUmVsYXRpb25zaGlwcyIsIm1hcCIsImMiLCJmaWVsZFNjaGVtYSIsInNhbml0aXplRmllbGRzIiwiaGFuZGxlVXBkYXRlRWRpdERhdGEiLCJ1c2VDYWxsYmFjayIsIl8iLCJkYXRhIiwibmV3Tm9kZSIsImVsZW1lbnRQYXRoIiwiUmVhY3RFZGl0b3IiLCJmaW5kUGF0aCIsIlRyYW5zZm9ybXMiLCJzZXROb2RlcyIsImF0IiwidXNlRWZmZWN0IiwiYXdhaXRJbml0aWFsU3RhdGUiLCJwcmVmZXJlbmNlcyIsInN0YXRlIiwiYnVpbGRTdGF0ZUZyb21TY2hlbWEiLCJkZWVwQ29weU9iamVjdCIsIm9wZXJhdGlvbiIsIkRyYXdlciIsInRpdGxlIiwibGFiZWwiLCJnZXRUcmFuc2xhdGlvbiIsImxhYmVscyIsInNpbmd1bGFyIiwiRm9ybSIsIm9uU3VibWl0IiwiUmVuZGVyRmllbGRzIiwiZmllbGRUeXBlcyIsInJlYWRPbmx5IiwiRm9ybVN1Ym1pdCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OytCQXVCYUE7OztlQUFBQTs7O3VCQW5CWTswQkFDRjt1QkFDb0M7MkJBT3BEO3dCQUN3Qjs0QkFDZ0I7K0RBQ1M7OEJBQ3pCO3VCQUNKOzRCQUNpQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUlyQyxNQUFNQSxlQUtULENBQUNDO0lBQ0gsTUFBTUMsU0FBU0MsSUFBQUEsMEJBQWM7SUFFN0IsTUFBTSxFQUFFQyxVQUFVLEVBQUVDLE9BQU8sRUFBRUMsVUFBVSxFQUFFQyxpQkFBaUIsRUFBRSxHQUFHTjtJQUUvRCxNQUFNLEVBQUVPLElBQUksRUFBRUMsQ0FBQyxFQUFFLEdBQUdDLElBQUFB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