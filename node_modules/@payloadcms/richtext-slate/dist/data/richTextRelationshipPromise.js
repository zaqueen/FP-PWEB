"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    recurseRichText: function() {
        return recurseRichText;
    },
    richTextRelationshipPromise: function() {
        return richTextRelationshipPromise;
    }
});
const _populate = require("./populate");
const _recurseNestedFields = require("./recurseNestedFields");
const recurseRichText = ({ children, currentDepth = 0, depth, field, overrideAccess = false, promises, req, showHiddenFields })=>{
    if (depth <= 0 || currentDepth > depth) {
        return;
    }
    if (Array.isArray(children)) {
        children.forEach((element)=>{
            if ((element.type === 'relationship' || element.type === 'upload') && element?.value?.id) {
                const collection = req.payload.collections[element?.relationTo];
                if (collection) {
                    promises.push((0, _populate.populate)({
                        id: element.value.id,
                        collection,
                        currentDepth,
                        data: element,
                        depth,
                        field,
                        key: 'value',
                        overrideAccess,
                        req,
                        showHiddenFields
                    }));
                }
                if (element.type === 'upload' && Array.isArray(field.admin?.upload?.collections?.[element?.relationTo]?.fields)) {
                    (0, _recurseNestedFields.recurseNestedFields)({
                        currentDepth,
                        data: element.fields || {},
                        depth,
                        fields: field.admin.upload.collections[element.relationTo].fields,
                        overrideAccess,
                        promises,
                        req,
                        showHiddenFields
                    });
                }
            }
            if (element.type === 'link') {
                if (element?.doc?.value && element?.doc?.relationTo) {
                    const collection = req.payload.collections[element?.doc?.relationTo];
                    if (collection) {
                        promises.push((0, _populate.populate)({
                            id: element.doc.value,
                            collection,
                            currentDepth,
                            data: element.doc,
                            depth,
                            field,
                            key: 'value',
                            overrideAccess,
                            req,
                            showHiddenFields
                        }));
                    }
                }
                if (Array.isArray(field.admin?.link?.fields)) {
                    (0, _recurseNestedFields.recurseNestedFields)({
                        currentDepth,
                        data: element.fields || {},
                        depth,
                        fields: field.admin?.link?.fields,
                        overrideAccess,
                        promises,
                        req,
                        showHiddenFields
                    });
                }
            }
            if (element?.children) {
                recurseRichText({
                    children: element.children,
                    currentDepth,
                    depth,
                    field,
                    overrideAccess,
                    promises,
                    req,
                    showHiddenFields
                });
            }
        });
    }
};
const richTextRelationshipPromise = async ({ currentDepth, depth, field, overrideAccess, req, showHiddenFields, siblingDoc })=>{
    const promises = [];
    recurseRichText({
        children: siblingDoc[field.name],
        currentDepth,
        depth,
        field,
        overrideAccess,
        promises,
        req,
        showHiddenFields
    });
    await Promise.all(promises);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kYXRhL3JpY2hUZXh0UmVsYXRpb25zaGlwUHJvbWlzZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFBheWxvYWRSZXF1ZXN0LCBSaWNoVGV4dEFkYXB0ZXIsIFJpY2hUZXh0RmllbGQgfSBmcm9tICdwYXlsb2FkL3R5cGVzJ1xuXG5pbXBvcnQgdHlwZSB7IEFkYXB0ZXJBcmd1bWVudHMgfSBmcm9tICcuLi90eXBlcydcblxuaW1wb3J0IHsgcG9wdWxhdGUgfSBmcm9tICcuL3BvcHVsYXRlJ1xuaW1wb3J0IHsgcmVjdXJzZU5lc3RlZEZpZWxkcyB9IGZyb20gJy4vcmVjdXJzZU5lc3RlZEZpZWxkcydcblxuZXhwb3J0IHR5cGUgQXJncyA9IFBhcmFtZXRlcnM8UmljaFRleHRBZGFwdGVyPGFueVtdLCBBZGFwdGVyQXJndW1lbnRzPlsncG9wdWxhdGlvblByb21pc2UnXT5bMF1cblxudHlwZSBSZWN1cnNlUmljaFRleHRBcmdzID0ge1xuICBjaGlsZHJlbjogdW5rbm93bltdXG4gIGN1cnJlbnREZXB0aDogbnVtYmVyXG4gIGRlcHRoOiBudW1iZXJcbiAgZmllbGQ6IFJpY2hUZXh0RmllbGQ8YW55W10sIEFkYXB0ZXJBcmd1bWVudHMsIEFkYXB0ZXJBcmd1bWVudHM+XG4gIG92ZXJyaWRlQWNjZXNzOiBib29sZWFuXG4gIHByb21pc2VzOiBQcm9taXNlPHZvaWQ+W11cbiAgcmVxOiBQYXlsb2FkUmVxdWVzdFxuICBzaG93SGlkZGVuRmllbGRzOiBib29sZWFuXG59XG5cbmV4cG9ydCBjb25zdCByZWN1cnNlUmljaFRleHQgPSAoe1xuICBjaGlsZHJlbixcbiAgY3VycmVudERlcHRoID0gMCxcbiAgZGVwdGgsXG4gIGZpZWxkLFxuICBvdmVycmlkZUFjY2VzcyA9IGZhbHNlLFxuICBwcm9taXNlcyxcbiAgcmVxLFxuICBzaG93SGlkZGVuRmllbGRzLFxufTogUmVjdXJzZVJpY2hUZXh0QXJncyk6IHZvaWQgPT4ge1xuICBpZiAoZGVwdGggPD0gMCB8fCBjdXJyZW50RGVwdGggPiBkZXB0aCkge1xuICAgIHJldHVyblxuICB9XG5cbiAgaWYgKEFycmF5LmlzQXJyYXkoY2hpbGRyZW4pKSB7XG4gICAgOyhjaGlsZHJlbiBhcyBhbnlbXSkuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgICAgaWYgKChlbGVtZW50LnR5cGUgPT09ICdyZWxhdGlvbnNoaXAnIHx8IGVsZW1lbnQudHlwZSA9PT0gJ3VwbG9hZCcpICYmIGVsZW1lbnQ/LnZhbHVlPy5pZCkge1xuICAgICAgICBjb25zdCBjb2xsZWN0aW9uID0gcmVxLnBheWxvYWQuY29sbGVjdGlvbnNbZWxlbWVudD8ucmVsYXRpb25Ub11cblxuICAgICAgICBpZiAoY29sbGVjdGlvbikge1xuICAgICAgICAgIHByb21pc2VzLnB1c2goXG4gICAgICAgICAgICBwb3B1bGF0ZSh7XG4gICAgICAgICAgICAgIGlkOiBlbGVtZW50LnZhbHVlLmlkLFxuICAgICAgICAgICAgICBjb2xsZWN0aW9uLFxuICAgICAgICAgICAgICBjdXJyZW50RGVwdGgsXG4gICAgICAgICAgICAgIGRhdGE6IGVsZW1lbnQsXG4gICAgICAgICAgICAgIGRlcHRoLFxuICAgICAgICAgICAgICBmaWVsZCxcbiAgICAgICAgICAgICAga2V5OiAndmFsdWUnLFxuICAgICAgICAgICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgICBzaG93SGlkZGVuRmllbGRzLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICAgIGlmIChcbiAgICAgICAgICBlbGVtZW50LnR5cGUgPT09ICd1cGxvYWQnICYmXG4gICAgICAgICAgQXJyYXkuaXNBcnJheShmaWVsZC5hZG1pbj8udXBsb2FkPy5jb2xsZWN0aW9ucz8uW2VsZW1lbnQ/LnJlbGF0aW9uVG9dPy5maWVsZHMpXG4gICAgICAgICkge1xuICAgICAgICAgIHJlY3Vyc2VOZXN0ZWRGaWVsZHMoe1xuICAgICAgICAgICAgY3VycmVudERlcHRoLFxuICAgICAgICAgICAgZGF0YTogZWxlbWVudC5maWVsZHMgfHwge30sXG4gICAgICAgICAgICBkZXB0aCxcbiAgICAgICAgICAgIGZpZWxkczogZmllbGQuYWRtaW4udXBsb2FkLmNvbGxlY3Rpb25zW2VsZW1lbnQucmVsYXRpb25Ub10uZmllbGRzLFxuICAgICAgICAgICAgb3ZlcnJpZGVBY2Nlc3MsXG4gICAgICAgICAgICBwcm9taXNlcyxcbiAgICAgICAgICAgIHJlcSxcbiAgICAgICAgICAgIHNob3dIaWRkZW5GaWVsZHMsXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZWxlbWVudC50eXBlID09PSAnbGluaycpIHtcbiAgICAgICAgaWYgKGVsZW1lbnQ/LmRvYz8udmFsdWUgJiYgZWxlbWVudD8uZG9jPy5yZWxhdGlvblRvKSB7XG4gICAgICAgICAgY29uc3QgY29sbGVjdGlvbiA9IHJlcS5wYXlsb2FkLmNvbGxlY3Rpb25zW2VsZW1lbnQ/LmRvYz8ucmVsYXRpb25Ub11cblxuICAgICAgICAgIGlmIChjb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICBwcm9taXNlcy5wdXNoKFxuICAgICAgICAgICAgICBwb3B1bGF0ZSh7XG4gICAgICAgICAgICAgICAgaWQ6IGVsZW1lbnQuZG9jLnZhbHVlLFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb24sXG4gICAgICAgICAgICAgICAgY3VycmVudERlcHRoLFxuICAgICAgICAgICAgICAgIGRhdGE6IGVsZW1lbnQuZG9jLFxuICAgICAgICAgICAgICAgIGRlcHRoLFxuICAgICAgICAgICAgICAgIGZpZWxkLFxuICAgICAgICAgICAgICAgIGtleTogJ3ZhbHVlJyxcbiAgICAgICAgICAgICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgICAgICAgICAgICByZXEsXG4gICAgICAgICAgICAgICAgc2hvd0hpZGRlbkZpZWxkcyxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICApXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZmllbGQuYWRtaW4/Lmxpbms/LmZpZWxkcykpIHtcbiAgICAgICAgICByZWN1cnNlTmVzdGVkRmllbGRzKHtcbiAgICAgICAgICAgIGN1cnJlbnREZXB0aCxcbiAgICAgICAgICAgIGRhdGE6IGVsZW1lbnQuZmllbGRzIHx8IHt9LFxuICAgICAgICAgICAgZGVwdGgsXG4gICAgICAgICAgICBmaWVsZHM6IGZpZWxkLmFkbWluPy5saW5rPy5maWVsZHMsXG4gICAgICAgICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgICAgICAgIHByb21pc2VzLFxuICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgc2hvd0hpZGRlbkZpZWxkcyxcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChlbGVtZW50Py5jaGlsZHJlbikge1xuICAgICAgICByZWN1cnNlUmljaFRleHQoe1xuICAgICAgICAgIGNoaWxkcmVuOiBlbGVtZW50LmNoaWxkcmVuLFxuICAgICAgICAgIGN1cnJlbnREZXB0aCxcbiAgICAgICAgICBkZXB0aCxcbiAgICAgICAgICBmaWVsZCxcbiAgICAgICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgICAgICBwcm9taXNlcyxcbiAgICAgICAgICByZXEsXG4gICAgICAgICAgc2hvd0hpZGRlbkZpZWxkcyxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCByaWNoVGV4dFJlbGF0aW9uc2hpcFByb21pc2UgPSBhc3luYyAoe1xuICBjdXJyZW50RGVwdGgsXG4gIGRlcHRoLFxuICBmaWVsZCxcbiAgb3ZlcnJpZGVBY2Nlc3MsXG4gIHJlcSxcbiAgc2hvd0hpZGRlbkZpZWxkcyxcbiAgc2libGluZ0RvYyxcbn06IEFyZ3MpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgY29uc3QgcHJvbWlzZXMgPSBbXVxuXG4gIHJlY3Vyc2VSaWNoVGV4dCh7XG4gICAgY2hpbGRyZW46IHNpYmxpbmdEb2NbZmllbGQubmFtZV0gYXMgdW5rbm93bltdLFxuICAgIGN1cnJlbnREZXB0aCxcbiAgICBkZXB0aCxcbiAgICBmaWVsZCxcbiAgICBvdmVycmlkZUFjY2VzcyxcbiAgICBwcm9taXNlcyxcbiAgICByZXEsXG4gICAgc2hvd0hpZGRlbkZpZWxkcyxcbiAgfSlcblxuICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcylcbn1cbiJdLCJuYW1lcyI6WyJyZWN1cnNlUmljaFRleHQiLCJyaWNoVGV4dFJlbGF0aW9uc2hpcFByb21pc2UiLCJjaGlsZHJlbiIsImN1cnJlbnREZXB0aCIsImRlcHRoIiwiZmllbGQiLCJvdmVycmlkZUFjY2VzcyIsInByb21pc2VzIiwicmVxIiwic2hvd0hpZGRlbkZpZWxkcyIsIkFycmF5IiwiaXNBcnJheSIsImZvckVhY2giLCJlbGVtZW50IiwidHlwZSIsInZhbHVlIiwiaWQiLCJjb2xsZWN0aW9uIiwicGF5bG9hZCIsImNvbGxlY3Rpb25zIiwicmVsYXRpb25UbyIsInB1c2giLCJwb3B1bGF0ZSIsImRhdGEiLCJrZXkiLCJhZG1pbiIsInVwbG9hZCIsImZpZWxkcyIsInJlY3Vyc2VOZXN0ZWRGaWVsZHMiLCJkb2MiLCJsaW5rIiwic2libGluZ0RvYyIsIm5hbWUiLCJQcm9taXNlIiwiYWxsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztJQW9CYUEsZUFBZTtlQUFmQTs7SUF3R0FDLDJCQUEyQjtlQUEzQkE7OzswQkF4SFk7cUNBQ1c7QUFlN0IsTUFBTUQsa0JBQWtCLENBQUMsRUFDOUJFLFFBQVEsRUFDUkMsZUFBZSxDQUFDLEVBQ2hCQyxLQUFLLEVBQ0xDLEtBQUssRUFDTEMsaUJBQWlCLEtBQUssRUFDdEJDLFFBQVEsRUFDUkMsR0FBRyxFQUNIQyxnQkFBZ0IsRUFDSTtJQUNwQixJQUFJTCxTQUFTLEtBQUtELGVBQWVDLE9BQU87UUFDdEM7SUFDRjtJQUVBLElBQUlNLE1BQU1D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