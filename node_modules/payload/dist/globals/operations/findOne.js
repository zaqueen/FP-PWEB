"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _executeAccess = /*#__PURE__*/ _interop_require_default(require("../../auth/executeAccess"));
const _afterRead = require("../../fields/hooks/afterRead");
const _commitTransaction = require("../../utilities/commitTransaction");
const _initTransaction = require("../../utilities/initTransaction");
const _killTransaction = require("../../utilities/killTransaction");
const _replaceWithDraftIfAvailable = /*#__PURE__*/ _interop_require_default(require("../../versions/drafts/replaceWithDraftIfAvailable"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
async function findOne(args) {
    const { depth, draft: draftEnabled = false, globalConfig, overrideAccess = false, req: { locale, payload }, req, showHiddenFields, slug } = args;
    try {
        const shouldCommit = await (0, _initTransaction.initTransaction)(req);
        // /////////////////////////////////////
        // Retrieve and execute access
        // /////////////////////////////////////
        let accessResult;
        if (!overrideAccess) {
            accessResult = await (0, _executeAccess.default)({
                req
            }, globalConfig.access.read);
        }
        // /////////////////////////////////////
        // Perform database operation
        // /////////////////////////////////////
        let doc = await req.payload.db.findGlobal({
            locale,
            req,
            slug,
            where: overrideAccess ? undefined : accessResult
        });
        if (!doc) {
            doc = {};
        }
        // /////////////////////////////////////
        // Replace document with draft if available
        // /////////////////////////////////////
        if (globalConfig.versions?.drafts && draftEnabled) {
            doc = await (0, _replaceWithDraftIfAvailable.default)({
                accessResult,
                doc,
                entity: globalConfig,
                entityType: 'global',
                overrideAccess,
                req
            });
        }
        // /////////////////////////////////////
        // Execute before global hook
        // /////////////////////////////////////
        await globalConfig.hooks.beforeRead.reduce(async (priorHook, hook)=>{
            await priorHook;
            doc = await hook({
                context: req.context,
                doc,
                global: globalConfig,
                req
            }) || doc;
        }, Promise.resolve());
        // /////////////////////////////////////
        // Execute field-level hooks and access
        // /////////////////////////////////////
        doc = await (0, _afterRead.afterRead)({
            collection: null,
            context: req.context,
            depth,
            doc,
            global: globalConfig,
            overrideAccess,
            req,
            showHiddenFields
        });
        // /////////////////////////////////////
        // Execute after global hook
        // /////////////////////////////////////
        await globalConfig.hooks.afterRead.reduce(async (priorHook, hook)=>{
            await priorHook;
            doc = await hook({
                context: req.context,
                doc,
                global: globalConfig,
                req
            }) || doc;
        }, Promise.resolve());
        // /////////////////////////////////////
        // Return results
        // /////////////////////////////////////
        if (shouldCommit) await (0, _commitTransaction.commitTransaction)(req);
        // /////////////////////////////////////
        // Return results
        // /////////////////////////////////////
        return doc;
    } catch (error) {
        await (0, _killTransaction.killTransaction)(req);
        throw error;
    }
}
const _default = findOne;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9nbG9iYWxzL29wZXJhdGlvbnMvZmluZE9uZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEFjY2Vzc1Jlc3VsdCB9IGZyb20gJy4uLy4uL2NvbmZpZy90eXBlcydcbmltcG9ydCB0eXBlIHsgUGF5bG9hZFJlcXVlc3QgfSBmcm9tICcuLi8uLi9leHByZXNzL3R5cGVzJ1xuaW1wb3J0IHR5cGUgeyBXaGVyZSB9IGZyb20gJy4uLy4uL3R5cGVzJ1xuaW1wb3J0IHR5cGUgeyBTYW5pdGl6ZWRHbG9iYWxDb25maWcgfSBmcm9tICcuLi9jb25maWcvdHlwZXMnXG5cbmltcG9ydCBleGVjdXRlQWNjZXNzIGZyb20gJy4uLy4uL2F1dGgvZXhlY3V0ZUFjY2VzcydcbmltcG9ydCB7IGFmdGVyUmVhZCB9IGZyb20gJy4uLy4uL2ZpZWxkcy9ob29rcy9hZnRlclJlYWQnXG5pbXBvcnQgeyBjb21taXRUcmFuc2FjdGlvbiB9IGZyb20gJy4uLy4uL3V0aWxpdGllcy9jb21taXRUcmFuc2FjdGlvbidcbmltcG9ydCB7IGluaXRUcmFuc2FjdGlvbiB9IGZyb20gJy4uLy4uL3V0aWxpdGllcy9pbml0VHJhbnNhY3Rpb24nXG5pbXBvcnQgeyBraWxsVHJhbnNhY3Rpb24gfSBmcm9tICcuLi8uLi91dGlsaXRpZXMva2lsbFRyYW5zYWN0aW9uJ1xuaW1wb3J0IHJlcGxhY2VXaXRoRHJhZnRJZkF2YWlsYWJsZSBmcm9tICcuLi8uLi92ZXJzaW9ucy9kcmFmdHMvcmVwbGFjZVdpdGhEcmFmdElmQXZhaWxhYmxlJ1xuXG50eXBlIEFyZ3MgPSB7XG4gIGRlcHRoPzogbnVtYmVyXG4gIGRyYWZ0PzogYm9vbGVhblxuICBnbG9iYWxDb25maWc6IFNhbml0aXplZEdsb2JhbENvbmZpZ1xuICBsb2NhbGU/OiBzdHJpbmdcbiAgb3ZlcnJpZGVBY2Nlc3M/OiBib29sZWFuXG4gIHJlcTogUGF5bG9hZFJlcXVlc3RcbiAgc2hvd0hpZGRlbkZpZWxkcz86IGJvb2xlYW5cbiAgc2x1Zzogc3RyaW5nXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZpbmRPbmU8VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+PihhcmdzOiBBcmdzKTogUHJvbWlzZTxUPiB7XG4gIGNvbnN0IHtcbiAgICBkZXB0aCxcbiAgICBkcmFmdDogZHJhZnRFbmFibGVkID0gZmFsc2UsXG4gICAgZ2xvYmFsQ29uZmlnLFxuICAgIG92ZXJyaWRlQWNjZXNzID0gZmFsc2UsXG4gICAgcmVxOiB7IGxvY2FsZSwgcGF5bG9hZCB9LFxuICAgIHJlcSxcbiAgICBzaG93SGlkZGVuRmllbGRzLFxuICAgIHNsdWcsXG4gIH0gPSBhcmdzXG5cbiAgdHJ5IHtcbiAgICBjb25zdCBzaG91bGRDb21taXQgPSBhd2FpdCBpbml0VHJhbnNhY3Rpb24ocmVxKVxuXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIFJldHJpZXZlIGFuZCBleGVjdXRlIGFjY2Vzc1xuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIGxldCBhY2Nlc3NSZXN1bHQ6IEFjY2Vzc1Jlc3VsdFxuXG4gICAgaWYgKCFvdmVycmlkZUFjY2Vzcykge1xuICAgICAgYWNjZXNzUmVzdWx0ID0gYXdhaXQgZXhlY3V0ZUFjY2Vzcyh7IHJlcSB9LCBnbG9iYWxDb25maWcuYWNjZXNzLnJlYWQpXG4gICAgfVxuXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIFBlcmZvcm0gZGF0YWJhc2Ugb3BlcmF0aW9uXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgbGV0IGRvYyA9IGF3YWl0IHJlcS5wYXlsb2FkLmRiLmZpbmRHbG9iYWwoe1xuICAgICAgbG9jYWxlLFxuICAgICAgcmVxLFxuICAgICAgc2x1ZyxcbiAgICAgIHdoZXJlOiBvdmVycmlkZUFjY2VzcyA/IHVuZGVmaW5lZCA6IChhY2Nlc3NSZXN1bHQgYXMgV2hlcmUpLFxuICAgIH0pXG4gICAgaWYgKCFkb2MpIHtcbiAgICAgIGRvYyA9IHt9XG4gICAgfVxuXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIFJlcGxhY2UgZG9jdW1lbnQgd2l0aCBkcmFmdCBpZiBhdmFpbGFibGVcbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICBpZiAoZ2xvYmFsQ29uZmlnLnZlcnNpb25zPy5kcmFmdHMgJiYgZHJhZnRFbmFibGVkKSB7XG4gICAgICBkb2MgPSBhd2FpdCByZXBsYWNlV2l0aERyYWZ0SWZBdmFpbGFibGUoe1xuICAgICAgICBhY2Nlc3NSZXN1bHQsXG4gICAgICAgIGRvYyxcbiAgICAgICAgZW50aXR5OiBnbG9iYWxDb25maWcsXG4gICAgICAgIGVudGl0eVR5cGU6ICdnbG9iYWwnLFxuICAgICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgICAgcmVxLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gRXhlY3V0ZSBiZWZvcmUgZ2xvYmFsIGhvb2tcbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICBhd2FpdCBnbG9iYWxDb25maWcuaG9va3MuYmVmb3JlUmVhZC5yZWR1Y2UoYXN5bmMgKHByaW9ySG9vaywgaG9vaykgPT4ge1xuICAgICAgYXdhaXQgcHJpb3JIb29rXG5cbiAgICAgIGRvYyA9XG4gICAgICAgIChhd2FpdCBob29rKHtcbiAgICAgICAgICBjb250ZXh0OiByZXEuY29udGV4dCxcbiAgICAgICAgICBkb2MsXG4gICAgICAgICAgZ2xvYmFsOiBnbG9iYWxDb25maWcsXG4gICAgICAgICAgcmVxLFxuICAgICAgICB9KSkgfHwgZG9jXG4gICAgfSwgUHJvbWlzZS5yZXNvbHZlKCkpXG5cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gRXhlY3V0ZSBmaWVsZC1sZXZlbCBob29rcyBhbmQgYWNjZXNzXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgZG9jID0gYXdhaXQgYWZ0ZXJSZWFkKHtcbiAgICAgIGNvbGxlY3Rpb246IG51bGwsXG4gICAgICBjb250ZXh0OiByZXEuY29udGV4dCxcbiAgICAgIGRlcHRoLFxuICAgICAgZG9jLFxuICAgICAgZ2xvYmFsOiBnbG9iYWxDb25maWcsXG4gICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgIHJlcSxcbiAgICAgIHNob3dIaWRkZW5GaWVsZHMsXG4gICAgfSlcblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBFeGVjdXRlIGFmdGVyIGdsb2JhbCBob29rXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgYXdhaXQgZ2xvYmFsQ29uZmlnLmhvb2tzLmFmdGVyUmVhZC5yZWR1Y2UoYXN5bmMgKHByaW9ySG9vaywgaG9vaykgPT4ge1xuICAgICAgYXdhaXQgcHJpb3JIb29rXG5cbiAgICAgIGRvYyA9XG4gICAgICAgIChhd2FpdCBob29rKHtcbiAgICAgICAgICBjb250ZXh0OiByZXEuY29udGV4dCxcbiAgICAgICAgICBkb2MsXG4gICAgICAgICAgZ2xvYmFsOiBnbG9iYWxDb25maWcsXG4gICAgICAgICAgcmVxLFxuICAgICAgICB9KSkgfHwgZG9jXG4gICAgfSwgUHJvbWlzZS5yZXNvbHZlKCkpXG5cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gUmV0dXJuIHJlc3VsdHNcbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICBpZiAoc2hvdWxkQ29tbWl0KSBhd2FpdCBjb21taXRUcmFuc2FjdGlvbihyZXEpXG5cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gUmV0dXJuIHJlc3VsdHNcbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICByZXR1cm4gZG9jXG4gIH0gY2F0Y2ggKGVycm9yOiB1bmtub3duKSB7XG4gICAgYXdhaXQga2lsbFRyYW5zYWN0aW9uKHJlcSlcbiAgICB0aHJvdyBlcnJvclxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZpbmRPbmVcbiJdLCJuYW1lcyI6WyJmaW5kT25lIiwiYXJncyIsImRlcHRoIiwiZHJhZnQiLCJkcmFmdEVuYWJsZWQiLCJnbG9iYWxDb25maWciLCJvdmVycmlkZUFjY2VzcyIsInJlcSIsImxvY2FsZSIsInBheWxvYWQiLCJzaG93SGlkZGVuRmllbGRzIiwic2x1ZyIsInNob3VsZENvbW1pdCIsImluaXRUcmFuc2FjdGlvbiIsImFjY2Vzc1Jlc3VsdCIsImV4ZWN1dGVBY2Nlc3MiLCJhY2Nlc3MiLCJyZWFkIiwiZG9jIiwiZGIiLCJmaW5kR2xvYmFsIiwid2hlcmUiLCJ1bmRlZmluZWQiLCJ2ZXJzaW9ucyIsImRyYWZ0cyIsInJlcGxhY2VXaXRoRHJhZnRJZkF2YWlsYWJsZSIsImVudGl0eSIsImVudGl0eVR5cGUiLCJob29rcyIsImJlZm9yZVJlYWQiLCJyZWR1Y2UiLCJwcmlvckhvb2siLCJob29rIiwiY29udGV4dCIsImdsb2JhbCIsIlByb21pc2UiLCJyZXNvbHZlIiwiYWZ0ZXJSZWFkIiwiY29sbGVjdGlvbiIsImNvbW1pdFRyYW5zYWN0aW9uIiwiZXJyb3IiLCJraWxsVHJhbnNhY3Rpb24iXSwibWFwcGluZ3MiOiI7Ozs7K0JBNklBOzs7ZUFBQTs7O3NFQXhJMEI7MkJBQ0E7bUNBQ1E7aUNBQ0Y7aUNBQ0E7b0ZBQ1E7Ozs7OztBQWF4QyxlQUFlQSxRQUEyQ0MsSUFBVTtJQUNsRSxNQUFN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