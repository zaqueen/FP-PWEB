"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _crypto = /*#__PURE__*/ _interop_require_default(require("crypto"));
const _fs = /*#__PURE__*/ _interop_require_default(require("fs"));
const _util = require("util");
const _executeAccess = /*#__PURE__*/ _interop_require_default(require("../../auth/executeAccess"));
const _sendVerificationEmail = /*#__PURE__*/ _interop_require_default(require("../../auth/sendVerificationEmail"));
const _register = require("../../auth/strategies/local/register");
const _types = require("../../fields/config/types");
const _afterChange = require("../../fields/hooks/afterChange");
const _afterRead = require("../../fields/hooks/afterRead");
const _beforeChange = require("../../fields/hooks/beforeChange");
const _beforeValidate = require("../../fields/hooks/beforeValidate");
const _generateFileData = require("../../uploads/generateFileData");
const _unlinkTempFiles = require("../../uploads/unlinkTempFiles");
const _uploadFiles = require("../../uploads/uploadFiles");
const _commitTransaction = require("../../utilities/commitTransaction");
const _initTransaction = require("../../utilities/initTransaction");
const _killTransaction = require("../../utilities/killTransaction");
const _sanitizeInternalFields = /*#__PURE__*/ _interop_require_default(require("../../utilities/sanitizeInternalFields"));
const _saveVersion = require("../../versions/saveVersion");
const _utils = require("./utils");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const unlinkFile = (0, _util.promisify)(_fs.default.unlink);
async function create(incomingArgs) {
    let args = incomingArgs;
    // /////////////////////////////////////
    // beforeOperation - Collection
    // /////////////////////////////////////
    await args.collection.config.hooks.beforeOperation.reduce(async (priorHook, hook)=>{
        await priorHook;
        args = await hook({
            args,
            collection: args.collection.config,
            context: args.req.context,
            operation: 'create'
        }) || args;
    }, Promise.resolve());
    const { autosave = false, collection: { config: collectionConfig }, collection, depth, disableVerificationEmail, draft = false, overrideAccess, overwriteExistingFiles = false, req: { payload, payload: { config, emailOptions } }, req, showHiddenFields } = args;
    try {
        const shouldCommit = await (0, _initTransaction.initTransaction)(req);
        let { data } = args;
        const shouldSaveDraft = Boolean(draft && collectionConfig.versions.drafts);
        // /////////////////////////////////////
        // Access
        // /////////////////////////////////////
        if (!overrideAccess) {
            await (0, _executeAccess.default)({
                data,
                req
            }, collectionConfig.access.create);
        }
        // /////////////////////////////////////
        // Custom id
        // /////////////////////////////////////
        const hasIdField = collectionConfig.fields.findIndex((field)=>(0, _types.fieldAffectsData)(field) && field.name === 'id') > -1;
        if (hasIdField) {
            data = {
                _id: data.id,
                ...data
            };
        }
        // /////////////////////////////////////
        // Generate data for all files and sizes
        // /////////////////////////////////////
        const { data: newFileData, files: filesToUpload } = await (0, _generateFileData.generateFileData)({
            collection,
            config,
            data,
            overwriteExistingFiles,
            req,
            throwOnMissingFile: !shouldSaveDraft && collection.config.upload.filesRequiredOnCreate !== false
        });
        data = newFileData;
        // /////////////////////////////////////
        // beforeValidate - Fields
        // /////////////////////////////////////
        data = await (0, _beforeValidate.beforeValidate)({
            collection: collectionConfig,
            context: req.context,
            data,
            doc: {},
            global: null,
            operation: 'create',
            overrideAccess,
            req
        });
        // /////////////////////////////////////
        // beforeValidate - Collections
        // /////////////////////////////////////
        await collectionConfig.hooks.beforeValidate.reduce(async (priorHook, hook)=>{
            await priorHook;
            data = await hook({
                collection: collectionConfig,
                context: req.context,
                data,
                operation: 'create',
                req
            }) || data;
        }, Promise.resolve());
        // /////////////////////////////////////
        // Write files to local storage
        // /////////////////////////////////////
        if (!collectionConfig.upload.disableLocalStorage) {
            await (0, _uploadFiles.uploadFiles)(payload, filesToUpload, req.t);
        }
        // /////////////////////////////////////
        // beforeChange - Collection
        // /////////////////////////////////////
        await collectionConfig.hooks.beforeChange.reduce(async (priorHook, hook)=>{
            await priorHook;
            data = await hook({
                collection: collectionConfig,
                context: req.context,
                data,
                operation: 'create',
                req
            }) || data;
        }, Promise.resolve());
        // /////////////////////////////////////
        // beforeChange - Fields
        // /////////////////////////////////////
        const resultWithLocales = await (0, _beforeChange.beforeChange)({
            collection: collectionConfig,
            context: req.context,
            data,
            doc: {},
            docWithLocales: {},
            global: null,
            operation: 'create',
            req,
            skipValidation: shouldSaveDraft
        });
        // /////////////////////////////////////
        // Create
        // /////////////////////////////////////
        let doc;
        if (collectionConfig.auth && !collectionConfig.auth.disableLocalStrategy) {
            if (data.email) {
                resultWithLocales.email = data.email.toLowerCase();
            }
            if (collectionConfig.auth.verify) {
                resultWithLocales._verified = Boolean(resultWithLocales._verified) || false;
                resultWithLocales._verificationToken = _crypto.default.randomBytes(20).toString('hex');
            }
            doc = await (0, _register.registerLocalStrategy)({
                collection: collectionConfig,
                doc: resultWithLocales,
                password: data.password,
                payload: req.payload,
                req
            });
        } else {
            doc = await payload.db.create({
                collection: collectionConfig.slug,
                data: resultWithLocales,
                req
            });
        }
        const verificationToken = doc._verificationToken;
        let result = (0, _sanitizeInternalFields.default)(doc);
        // /////////////////////////////////////
        // Create version
        // /////////////////////////////////////
        if (collectionConfig.versions) {
            await (0, _saveVersion.saveVersion)({
                id: result.id,
                autosave,
                collection: collectionConfig,
                docWithLocales: result,
                payload,
                req
            });
        }
        // /////////////////////////////////////
        // Send verification email if applicable
        // /////////////////////////////////////
        if (collectionConfig.auth && collectionConfig.auth.verify) {
            // eslint-disable-next-line @typescript-eslint/no-floating-promises
            (0, _sendVerificationEmail.default)({
                collection: {
                    config: collectionConfig
                },
                config: payload.config,
                disableEmail: disableVerificationEmail,
                emailOptions,
                req,
                sendEmail: payload.sendEmail,
                token: verificationToken,
                user: result
            });
        }
        // /////////////////////////////////////
        // afterRead - Fields
        // /////////////////////////////////////
        result = await (0, _afterRead.afterRead)({
            collection: collectionConfig,
            context: req.context,
            depth,
            doc: result,
            global: null,
            overrideAccess,
            req,
            showHiddenFields
        });
        // /////////////////////////////////////
        // afterRead - Collection
        // /////////////////////////////////////
        await collectionConfig.hooks.afterRead.reduce(async (priorHook, hook)=>{
            await priorHook;
            result = await hook({
                collection: collectionConfig,
                context: req.context,
                doc: result,
                req
            }) || result;
        }, Promise.resolve());
        // /////////////////////////////////////
        // afterChange - Fields
        // /////////////////////////////////////
        result = await (0, _afterChange.afterChange)({
            collection: collectionConfig,
            context: req.context,
            data,
            doc: result,
            global: null,
            operation: 'create',
            previousDoc: {},
            req
        });
        // /////////////////////////////////////
        // afterChange - Collection
        // /////////////////////////////////////
        await collectionConfig.hooks.afterChange.reduce(async (priorHook, hook)=>{
            await priorHook;
            result = await hook({
                collection: collectionConfig,
                context: req.context,
                doc: result,
                operation: 'create',
                previousDoc: {},
                req: args.req
            }) || result;
        }, Promise.resolve());
        // /////////////////////////////////////
        // afterOperation - Collection
        // /////////////////////////////////////
        result = await (0, _utils.buildAfterOperation)({
            args,
            collection: collectionConfig,
            operation: 'create',
            result
        });
        await (0, _unlinkTempFiles.unlinkTempFiles)({
            collectionConfig,
            config,
            req
        });
        // /////////////////////////////////////
        // Return results
        // /////////////////////////////////////
        if (shouldCommit) await (0, _commitTransaction.commitTransaction)(req);
        return result;
    } catch (error) {
        await (0, _killTransaction.killTransaction)(req);
        throw error;
    }
}
const _default = create;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb2xsZWN0aW9ucy9vcGVyYXRpb25zL2NyZWF0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE1hcmtPcHRpb25hbCB9IGZyb20gJ3RzLWVzc2VudGlhbHMnXG5cbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJ1xuaW1wb3J0IGZzIGZyb20gJ2ZzJ1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSAndXRpbCdcblxuaW1wb3J0IHR5cGUgeyBHZW5lcmF0ZWRUeXBlcyB9IGZyb20gJy4uLy4uLydcbmltcG9ydCB0eXBlIHsgUGF5bG9hZFJlcXVlc3QgfSBmcm9tICcuLi8uLi9leHByZXNzL3R5cGVzJ1xuaW1wb3J0IHR5cGUgeyBEb2N1bWVudCB9IGZyb20gJy4uLy4uL3R5cGVzJ1xuaW1wb3J0IHR5cGUge1xuICBBZnRlckNoYW5nZUhvb2ssXG4gIEJlZm9yZU9wZXJhdGlvbkhvb2ssXG4gIEJlZm9yZVZhbGlkYXRlSG9vayxcbiAgQ29sbGVjdGlvbixcbn0gZnJvbSAnLi4vY29uZmlnL3R5cGVzJ1xuXG5pbXBvcnQgZXhlY3V0ZUFjY2VzcyBmcm9tICcuLi8uLi9hdXRoL2V4ZWN1dGVBY2Nlc3MnXG5pbXBvcnQgc2VuZFZlcmlmaWNhdGlvbkVtYWlsIGZyb20gJy4uLy4uL2F1dGgvc2VuZFZlcmlmaWNhdGlvbkVtYWlsJ1xuaW1wb3J0IHsgcmVnaXN0ZXJMb2NhbFN0cmF0ZWd5IH0gZnJvbSAnLi4vLi4vYXV0aC9zdHJhdGVnaWVzL2xvY2FsL3JlZ2lzdGVyJ1xuaW1wb3J0IHsgZmllbGRBZmZlY3RzRGF0YSB9IGZyb20gJy4uLy4uL2ZpZWxkcy9jb25maWcvdHlwZXMnXG5pbXBvcnQgeyBhZnRlckNoYW5nZSB9IGZyb20gJy4uLy4uL2ZpZWxkcy9ob29rcy9hZnRlckNoYW5nZSdcbmltcG9ydCB7IGFmdGVyUmVhZCB9IGZyb20gJy4uLy4uL2ZpZWxkcy9ob29rcy9hZnRlclJlYWQnXG5pbXBvcnQgeyBiZWZvcmVDaGFuZ2UgfSBmcm9tICcuLi8uLi9maWVsZHMvaG9va3MvYmVmb3JlQ2hhbmdlJ1xuaW1wb3J0IHsgYmVmb3JlVmFsaWRhdGUgfSBmcm9tICcuLi8uLi9maWVsZHMvaG9va3MvYmVmb3JlVmFsaWRhdGUnXG5pbXBvcnQgeyBnZW5lcmF0ZUZpbGVEYXRhIH0gZnJvbSAnLi4vLi4vdXBsb2Fkcy9nZW5lcmF0ZUZpbGVEYXRhJ1xuaW1wb3J0IHsgdW5saW5rVGVtcEZpbGVzIH0gZnJvbSAnLi4vLi4vdXBsb2Fkcy91bmxpbmtUZW1wRmlsZXMnXG5pbXBvcnQgeyB1cGxvYWRGaWxlcyB9IGZyb20gJy4uLy4uL3VwbG9hZHMvdXBsb2FkRmlsZXMnXG5pbXBvcnQgeyBjb21taXRUcmFuc2FjdGlvbiB9IGZyb20gJy4uLy4uL3V0aWxpdGllcy9jb21taXRUcmFuc2FjdGlvbidcbmltcG9ydCB7IGluaXRUcmFuc2FjdGlvbiB9IGZyb20gJy4uLy4uL3V0aWxpdGllcy9pbml0VHJhbnNhY3Rpb24nXG5pbXBvcnQgeyBraWxsVHJhbnNhY3Rpb24gfSBmcm9tICcuLi8uLi91dGlsaXRpZXMva2lsbFRyYW5zYWN0aW9uJ1xuaW1wb3J0IHNhbml0aXplSW50ZXJuYWxGaWVsZHMgZnJvbSAnLi4vLi4vdXRpbGl0aWVzL3Nhbml0aXplSW50ZXJuYWxGaWVsZHMnXG5pbXBvcnQgeyBzYXZlVmVyc2lvbiB9IGZyb20gJy4uLy4uL3ZlcnNpb25zL3NhdmVWZXJzaW9uJ1xuaW1wb3J0IHsgYnVpbGRBZnRlck9wZXJhdGlvbiB9IGZyb20gJy4vdXRpbHMnXG5cbmNvbnN0IHVubGlua0ZpbGUgPSBwcm9taXNpZnkoZnMudW5saW5rKVxuXG5leHBvcnQgdHlwZSBDcmVhdGVVcGRhdGVUeXBlID0geyBbZmllbGQ6IG51bWJlciB8IHN0cmluZyB8IHN5bWJvbF06IHVua25vd24gfVxuXG5leHBvcnQgdHlwZSBBcmd1bWVudHM8VCBleHRlbmRzIENyZWF0ZVVwZGF0ZVR5cGU+ID0ge1xuICBhdXRvc2F2ZT86IGJvb2xlYW5cbiAgY29sbGVjdGlvbjogQ29sbGVjdGlvblxuICBkYXRhOiBNYXJrT3B0aW9uYWw8VCwgJ2NyZWF0ZWRBdCcgfCAnaWQnIHwgJ3NpemVzJyB8ICd1cGRhdGVkQXQnPlxuICBkZXB0aD86IG51bWJlclxuICBkaXNhYmxlVmVyaWZpY2F0aW9uRW1haWw/OiBib29sZWFuXG4gIGRyYWZ0PzogYm9vbGVhblxuICBvdmVycmlkZUFjY2Vzcz86IGJvb2xlYW5cbiAgb3ZlcndyaXRlRXhpc3RpbmdGaWxlcz86IGJvb2xlYW5cbiAgcmVxOiBQYXlsb2FkUmVxdWVzdFxuICBzaG93SGlkZGVuRmllbGRzPzogYm9vbGVhblxufVxuXG5hc3luYyBmdW5jdGlvbiBjcmVhdGU8VFNsdWcgZXh0ZW5kcyBrZXlvZiBHZW5lcmF0ZWRUeXBlc1snY29sbGVjdGlvbnMnXT4oXG4gIGluY29taW5nQXJnczogQXJndW1lbnRzPEdlbmVyYXRlZFR5cGVzWydjb2xsZWN0aW9ucyddW1RTbHVnXT4sXG4pOiBQcm9taXNlPEdlbmVyYXRlZFR5cGVzWydjb2xsZWN0aW9ucyddW1RTbHVnXT4ge1xuICBsZXQgYXJncyA9IGluY29taW5nQXJnc1xuXG4gIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgLy8gYmVmb3JlT3BlcmF0aW9uIC0gQ29sbGVjdGlvblxuICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgYXdhaXQgYXJncy5jb2xsZWN0aW9uLmNvbmZpZy5ob29rcy5iZWZvcmVPcGVyYXRpb24ucmVkdWNlKFxuICAgIGFzeW5jIChwcmlvckhvb2s6IEJlZm9yZU9wZXJhdGlvbkhvb2sgfCBQcm9taXNlPHZvaWQ+LCBob29rOiBCZWZvcmVPcGVyYXRpb25Ib29rKSA9PiB7XG4gICAgICBhd2FpdCBwcmlvckhvb2tcblxuICAgICAgYXJncyA9XG4gICAgICAgIChhd2FpdCBob29rKHtcbiAgICAgICAgICBhcmdzLFxuICAgICAgICAgIGNvbGxlY3Rpb246IGFyZ3MuY29sbGVjdGlvbi5jb25maWcsXG4gICAgICAgICAgY29udGV4dDogYXJncy5yZXEuY29udGV4dCxcbiAgICAgICAgICBvcGVyYXRpb246ICdjcmVhdGUnLFxuICAgICAgICB9KSkgfHwgYXJnc1xuICAgIH0sXG4gICAgUHJvbWlzZS5yZXNvbHZlKCksXG4gIClcblxuICBjb25zdCB7XG4gICAgYXV0b3NhdmUgPSBmYWxzZSxcbiAgICBjb2xsZWN0aW9uOiB7IGNvbmZpZzogY29sbGVjdGlvbkNvbmZpZyB9LFxuICAgIGNvbGxlY3Rpb24sXG4gICAgZGVwdGgsXG4gICAgZGlzYWJsZVZlcmlmaWNhdGlvbkVtYWlsLFxuICAgIGRyYWZ0ID0gZmFsc2UsXG4gICAgb3ZlcnJpZGVBY2Nlc3MsXG4gICAgb3ZlcndyaXRlRXhpc3RpbmdGaWxlcyA9IGZhbHNlLFxuICAgIHJlcToge1xuICAgICAgcGF5bG9hZCxcbiAgICAgIHBheWxvYWQ6IHsgY29uZmlnLCBlbWFpbE9wdGlvbnMgfSxcbiAgICB9LFxuICAgIHJlcSxcbiAgICBzaG93SGlkZGVuRmllbGRzLFxuICB9ID0gYXJnc1xuXG4gIHRyeSB7XG4gICAgY29uc3Qgc2hvdWxkQ29tbWl0ID0gYXdhaXQgaW5pdFRyYW5zYWN0aW9uKHJlcSlcblxuICAgIGxldCB7IGRhdGEgfSA9IGFyZ3NcblxuICAgIGNvbnN0IHNob3VsZFNhdmVEcmFmdCA9IEJvb2xlYW4oZHJhZnQgJiYgY29sbGVjdGlvbkNvbmZpZy52ZXJzaW9ucy5kcmFmdHMpXG5cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gQWNjZXNzXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgaWYgKCFvdmVycmlkZUFjY2Vzcykge1xuICAgICAgYXdhaXQgZXhlY3V0ZUFjY2Vzcyh7IGRhdGEsIHJlcSB9LCBjb2xsZWN0aW9uQ29uZmlnLmFjY2Vzcy5jcmVhdGUpXG4gICAgfVxuXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIEN1c3RvbSBpZFxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIGNvbnN0IGhhc0lkRmllbGQgPVxuICAgICAgY29sbGVjdGlvbkNvbmZpZy5maWVsZHMuZmluZEluZGV4KChmaWVsZCkgPT4gZmllbGRBZmZlY3RzRGF0YShmaWVsZCkgJiYgZmllbGQubmFtZSA9PT0gJ2lkJykgPlxuICAgICAgLTFcbiAgICBpZiAoaGFzSWRGaWVsZCkge1xuICAgICAgZGF0YSA9IHtcbiAgICAgICAgX2lkOiBkYXRhLmlkLFxuICAgICAgICAuLi5kYXRhLFxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBHZW5lcmF0ZSBkYXRhIGZvciBhbGwgZmlsZXMgYW5kIHNpemVzXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgY29uc3QgeyBkYXRhOiBuZXdGaWxlRGF0YSwgZmlsZXM6IGZpbGVzVG9VcGxvYWQgfSA9IGF3YWl0IGdlbmVyYXRlRmlsZURhdGEoe1xuICAgICAgY29sbGVjdGlvbixcbiAgICAgIGNvbmZpZyxcbiAgICAgIGRhdGEsXG4gICAgICBvdmVyd3JpdGVFeGlzdGluZ0ZpbGVzLFxuICAgICAgcmVxLFxuICAgICAgdGhyb3dPbk1pc3NpbmdGaWxlOlxuICAgICAgICAhc2hvdWxkU2F2ZURyYWZ0ICYmIGNvbGxlY3Rpb24uY29uZmlnLnVwbG9hZC5maWxlc1JlcXVpcmVkT25DcmVhdGUgIT09IGZhbHNlLFxuICAgIH0pXG5cbiAgICBkYXRhID0gbmV3RmlsZURhdGFcblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBiZWZvcmVWYWxpZGF0ZSAtIEZpZWxkc1xuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIGRhdGEgPSBhd2FpdCBiZWZvcmVWYWxpZGF0ZSh7XG4gICAgICBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uQ29uZmlnLFxuICAgICAgY29udGV4dDogcmVxLmNvbnRleHQsXG4gICAgICBkYXRhLFxuICAgICAgZG9jOiB7fSxcbiAgICAgIGdsb2JhbDogbnVsbCxcbiAgICAgIG9wZXJhdGlvbjogJ2NyZWF0ZScsXG4gICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgIHJlcSxcbiAgICB9KVxuXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIGJlZm9yZVZhbGlkYXRlIC0gQ29sbGVjdGlvbnNcbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICBhd2FpdCBjb2xsZWN0aW9uQ29uZmlnLmhvb2tzLmJlZm9yZVZhbGlkYXRlLnJlZHVjZShcbiAgICAgIGFzeW5jIChwcmlvckhvb2s6IEJlZm9yZVZhbGlkYXRlSG9vayB8IFByb21pc2U8dm9pZD4sIGhvb2s6IEJlZm9yZVZhbGlkYXRlSG9vaykgPT4ge1xuICAgICAgICBhd2FpdCBwcmlvckhvb2tcblxuICAgICAgICBkYXRhID1cbiAgICAgICAgICAoYXdhaXQgaG9vayh7XG4gICAgICAgICAgICBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uQ29uZmlnLFxuICAgICAgICAgICAgY29udGV4dDogcmVxLmNvbnRleHQsXG4gICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgb3BlcmF0aW9uOiAnY3JlYXRlJyxcbiAgICAgICAgICAgIHJlcSxcbiAgICAgICAgICB9KSkgfHwgZGF0YVxuICAgICAgfSxcbiAgICAgIFByb21pc2UucmVzb2x2ZSgpLFxuICAgIClcblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBXcml0ZSBmaWxlcyB0byBsb2NhbCBzdG9yYWdlXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgaWYgKCFjb2xsZWN0aW9uQ29uZmlnLnVwbG9hZC5kaXNhYmxlTG9jYWxTdG9yYWdlKSB7XG4gICAgICBhd2FpdCB1cGxvYWRGaWxlcyhwYXlsb2FkLCBmaWxlc1RvVXBsb2FkLCByZXEudClcbiAgICB9XG5cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gYmVmb3JlQ2hhbmdlIC0gQ29sbGVjdGlvblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIGF3YWl0IGNvbGxlY3Rpb25Db25maWcuaG9va3MuYmVmb3JlQ2hhbmdlLnJlZHVjZShhc3luYyAocHJpb3JIb29rLCBob29rKSA9PiB7XG4gICAgICBhd2FpdCBwcmlvckhvb2tcblxuICAgICAgZGF0YSA9XG4gICAgICAgIChhd2FpdCBob29rKHtcbiAgICAgICAgICBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uQ29uZmlnLFxuICAgICAgICAgIGNvbnRleHQ6IHJlcS5jb250ZXh0LFxuICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgb3BlcmF0aW9uOiAnY3JlYXRlJyxcbiAgICAgICAgICByZXEsXG4gICAgICAgIH0pKSB8fCBkYXRhXG4gICAgfSwgUHJvbWlzZS5yZXNvbHZlKCkpXG5cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gYmVmb3JlQ2hhbmdlIC0gRmllbGRzXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgY29uc3QgcmVzdWx0V2l0aExvY2FsZXMgPSBhd2FpdCBiZWZvcmVDaGFuZ2U8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+KHtcbiAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb25Db25maWcsXG4gICAgICBjb250ZXh0OiByZXEuY29udGV4dCxcbiAgICAgIGRhdGEsXG4gICAgICBkb2M6IHt9LFxuICAgICAgZG9jV2l0aExvY2FsZXM6IHt9LFxuICAgICAgZ2xvYmFsOiBudWxsLFxuICAgICAgb3BlcmF0aW9uOiAnY3JlYXRlJyxcbiAgICAgIHJlcSxcbiAgICAgIHNraXBWYWxpZGF0aW9uOiBzaG91bGRTYXZlRHJhZnQsXG4gICAgfSlcblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBDcmVhdGVcbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICBsZXQgZG9jXG5cbiAgICBpZiAoY29sbGVjdGlvbkNvbmZpZy5hdXRoICYmICFjb2xsZWN0aW9uQ29uZmlnLmF1dGguZGlzYWJsZUxvY2FsU3RyYXRlZ3kpIHtcbiAgICAgIGlmIChkYXRhLmVtYWlsKSB7XG4gICAgICAgIHJlc3VsdFdpdGhMb2NhbGVzLmVtYWlsID0gKGRhdGEuZW1haWwgYXMgc3RyaW5nKS50b0xvd2VyQ2FzZSgpXG4gICAgICB9XG5cbiAgICAgIGlmIChjb2xsZWN0aW9uQ29uZmlnLmF1dGgudmVyaWZ5KSB7XG4gICAgICAgIHJlc3VsdFdpdGhMb2NhbGVzLl92ZXJpZmllZCA9IEJvb2xlYW4ocmVzdWx0V2l0aExvY2FsZXMuX3ZlcmlmaWVkKSB8fCBmYWxzZVxuICAgICAgICByZXN1bHRXaXRoTG9jYWxlcy5fdmVyaWZpY2F0aW9uVG9rZW4gPSBjcnlwdG8ucmFuZG9tQnl0ZXMoMjApLnRvU3RyaW5nKCdoZXgnKVxuICAgICAgfVxuXG4gICAgICBkb2MgPSBhd2FpdCByZWdpc3RlckxvY2FsU3RyYXRlZ3koe1xuICAgICAgICBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uQ29uZmlnLFxuICAgICAgICBkb2M6IHJlc3VsdFdpdGhMb2NhbGVzLFxuICAgICAgICBwYXNzd29yZDogZGF0YS5wYXNzd29yZCBhcyBzdHJpbmcsXG4gICAgICAgIHBheWxvYWQ6IHJlcS5wYXlsb2FkLFxuICAgICAgICByZXEsXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICBkb2MgPSBhd2FpdCBwYXlsb2FkLmRiLmNyZWF0ZSh7XG4gICAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb25Db25maWcuc2x1ZyxcbiAgICAgICAgZGF0YTogcmVzdWx0V2l0aExvY2FsZXMsXG4gICAgICAgIHJlcSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW4gPSBkb2MuX3ZlcmlmaWNhdGlvblRva2VuXG4gICAgbGV0IHJlc3VsdDogRG9jdW1lbnQgPSBzYW5pdGl6ZUludGVybmFsRmllbGRzKGRvYylcblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBDcmVhdGUgdmVyc2lvblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIGlmIChjb2xsZWN0aW9uQ29uZmlnLnZlcnNpb25zKSB7XG4gICAgICBhd2FpdCBzYXZlVmVyc2lvbih7XG4gICAgICAgIGlkOiByZXN1bHQuaWQsXG4gICAgICAgIGF1dG9zYXZlLFxuICAgICAgICBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uQ29uZmlnLFxuICAgICAgICBkb2NXaXRoTG9jYWxlczogcmVzdWx0LFxuICAgICAgICBwYXlsb2FkLFxuICAgICAgICByZXEsXG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBTZW5kIHZlcmlmaWNhdGlvbiBlbWFpbCBpZiBhcHBsaWNhYmxlXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgaWYgKGNvbGxlY3Rpb25Db25maWcuYXV0aCAmJiBjb2xsZWN0aW9uQ29uZmlnLmF1dGgudmVyaWZ5KSB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICBzZW5kVmVyaWZpY2F0aW9uRW1haWwoe1xuICAgICAgICBjb2xsZWN0aW9uOiB7IGNvbmZpZzogY29sbGVjdGlvbkNvbmZpZyB9LFxuICAgICAgICBjb25maWc6IHBheWxvYWQuY29uZmlnLFxuICAgICAgICBkaXNhYmxlRW1haWw6IGRpc2FibGVWZXJpZmljYXRpb25FbWFpbCxcbiAgICAgICAgZW1haWxPcHRpb25zLFxuICAgICAgICByZXEsXG4gICAgICAgIHNlbmRFbWFpbDogcGF5bG9hZC5zZW5kRW1haWwsXG4gICAgICAgIHRva2VuOiB2ZXJpZmljYXRpb25Ub2tlbixcbiAgICAgICAgdXNlcjogcmVzdWx0LFxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgLy8gYWZ0ZXJSZWFkIC0gRmllbGRzXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgcmVzdWx0ID0gYXdhaXQgYWZ0ZXJSZWFkKHtcbiAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb25Db25maWcsXG4gICAgICBjb250ZXh0OiByZXEuY29udGV4dCxcbiAgICAgIGRlcHRoLFxuICAgICAgZG9jOiByZXN1bHQsXG4gICAgICBnbG9iYWw6IG51bGwsXG4gICAgICBvdmVycmlkZUFjY2VzcyxcbiAgICAgIHJlcSxcbiAgICAgIHNob3dIaWRkZW5GaWVsZHMsXG4gICAgfSlcblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBhZnRlclJlYWQgLSBDb2xsZWN0aW9uXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgYXdhaXQgY29sbGVjdGlvbkNvbmZpZy5ob29rcy5hZnRlclJlYWQucmVkdWNlKGFzeW5jIChwcmlvckhvb2ssIGhvb2spID0+IHtcbiAgICAgIGF3YWl0IHByaW9ySG9va1xuXG4gICAgICByZXN1bHQgPVxuICAgICAgICAoYXdhaXQgaG9vayh7XG4gICAgICAgICAgY29sbGVjdGlvbjogY29sbGVjdGlvbkNvbmZpZyxcbiAgICAgICAgICBjb250ZXh0OiByZXEuY29udGV4dCxcbiAgICAgICAgICBkb2M6IHJlc3VsdCxcbiAgICAgICAgICByZXEsXG4gICAgICAgIH0pKSB8fCByZXN1bHRcbiAgICB9LCBQcm9taXNlLnJlc29sdmUoKSlcblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBhZnRlckNoYW5nZSAtIEZpZWxkc1xuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIHJlc3VsdCA9IGF3YWl0IGFmdGVyQ2hhbmdlKHtcbiAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb25Db25maWcsXG4gICAgICBjb250ZXh0OiByZXEuY29udGV4dCxcbiAgICAgIGRhdGEsXG4gICAgICBkb2M6IHJlc3VsdCxcbiAgICAgIGdsb2JhbDogbnVsbCxcbiAgICAgIG9wZXJhdGlvbjogJ2NyZWF0ZScsXG4gICAgICBwcmV2aW91c0RvYzoge30sXG4gICAgICByZXEsXG4gICAgfSlcblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBhZnRlckNoYW5nZSAtIENvbGxlY3Rpb25cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICBhd2FpdCBjb2xsZWN0aW9uQ29uZmlnLmhvb2tzLmFmdGVyQ2hhbmdlLnJlZHVjZShcbiAgICAgIGFzeW5jIChwcmlvckhvb2s6IEFmdGVyQ2hhbmdlSG9vayB8IFByb21pc2U8dm9pZD4sIGhvb2s6IEFmdGVyQ2hhbmdlSG9vaykgPT4ge1xuICAgICAgICBhd2FpdCBwcmlvckhvb2tcblxuICAgICAgICByZXN1bHQgPVxuICAgICAgICAgIChhd2FpdCBob29rKHtcbiAgICAgICAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb25Db25maWcsXG4gICAgICAgICAgICBjb250ZXh0OiByZXEuY29udGV4dCxcbiAgICAgICAgICAgIGRvYzogcmVzdWx0LFxuICAgICAgICAgICAgb3BlcmF0aW9uOiAnY3JlYXRlJyxcbiAgICAgICAgICAgIHByZXZpb3VzRG9jOiB7fSxcbiAgICAgICAgICAgIHJlcTogYXJncy5yZXEsXG4gICAgICAgICAgfSkpIHx8IHJlc3VsdFxuICAgICAgfSxcbiAgICAgIFByb21pc2UucmVzb2x2ZSgpLFxuICAgIClcblxuICAgIC8vIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAvLyBhZnRlck9wZXJhdGlvbiAtIENvbGxlY3Rpb25cbiAgICAvLyAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICByZXN1bHQgPSBhd2FpdCBidWlsZEFmdGVyT3BlcmF0aW9uPEdlbmVyYXRlZFR5cGVzWydjb2xsZWN0aW9ucyddW1RTbHVnXT4oe1xuICAgICAgYXJncyxcbiAgICAgIGNvbGxlY3Rpb246IGNvbGxlY3Rpb25Db25maWcsXG4gICAgICBvcGVyYXRpb246ICdjcmVhdGUnLFxuICAgICAgcmVzdWx0LFxuICAgIH0pXG5cbiAgICBhd2FpdCB1bmxpbmtUZW1wRmlsZXMoeyBjb2xsZWN0aW9uQ29uZmlnLCBjb25maWcsIHJlcSB9KVxuXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgIC8vIFJldHVybiByZXN1bHRzXG4gICAgLy8gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgaWYgKHNob3VsZENvbW1pdCkgYXdhaXQgY29tbWl0VHJhbnNhY3Rpb24ocmVxKVxuXG4gICAgcmV0dXJuIHJlc3VsdFxuICB9IGNhdGNoIChlcnJvcjogdW5rbm93bikge1xuICAgIGF3YWl0IGtpbGxUcmFuc2FjdGlvbihyZXEpXG4gICAgdGhyb3cgZXJyb3JcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVcbiJdLCJuYW1lcyI6WyJ1bmxpbmtGaWxlIiwicHJvbWlzaWZ5IiwiZnMiLCJ1bmxpbmsiLCJjcmVhdGUiLCJpbmNvbWluZ0FyZ3MiLCJhcmdzIiwiY29sbGVjdGlvbiIsImNvbmZpZyIsImhvb2tzIiwiYmVmb3JlT3BlcmF0aW9uIiwicmVkdWNlIiwicHJpb3JIb29rIiwiaG9vayIsImNvbnRleHQiLCJyZXEiLCJvcGVyYXRpb24iLCJQcm9taXNlIiwicmVzb2x2ZSIsImF1dG9zYXZlIiwiY29sbGVjdGlvbkNvbmZpZyIsImRlcHRoIiwiZGlzYWJsZVZlcmlmaWNhdGlvbkVtYWlsIiwiZHJhZnQiLCJvdmVycmlkZUFjY2VzcyIsIm92ZXJ3cml0ZUV4aXN0aW5nRmlsZXMiLCJwYXlsb2FkIiwiZW1haWxPcHRpb25zIiwic2hvd0hpZGRlbkZpZWxkcyIsInNob3VsZENvbW1pdCIsImluaXRUcmFuc2FjdGlvbiIsImRhdGEiLCJzaG91bGRTYXZlRHJhZnQiLCJCb29sZWFuIiwidmVyc2lvbnMiLCJkcmFmdHMiLCJleGVjdXRlQWNjZXNzIiwiYWNjZXNzIiwiaGFzSWRGaWVsZCIsImZpZWxkcyIsImZpbmRJbmRleCIsImZpZWxkIiwiZmllbGRBZmZlY3RzRGF0YSIsIm5hbWUiLCJfaWQiLCJpZCIsIm5ld0ZpbGVEYXRhIiwiZmlsZXMiLCJmaWxlc1RvVXBsb2FkIiwiZ2VuZXJhdGVGaWxlRGF0YSIsInRocm93T25NaXNzaW5nRmlsZSIsInVwbG9hZCIsImZpbGVzUmVxdWlyZWRPbkNyZWF0ZSIsImJlZm9yZVZhbGlkYXRlIiwiZG9jIiwiZ2xvYmFsIiwiZGlzYWJsZUxvY2FsU3RvcmFnZSIsInVwbG9hZEZpbGVzIiwidCIsImJlZm9yZUNoYW5nZSIsInJlc3VsdFdpdGhMb2NhbGVzIiwiZG9jV2l0aExvY2FsZXMiLCJza2lwVmFsaWRhdGlvbiIsImF1dGgiLCJkaXNhYmxlTG9jYWxTdHJhdGVneSIsImVtYWlsIiwidG9Mb3dlckNhc2UiLCJ2ZXJpZnkiLCJfdmVyaWZpZWQiLCJfdmVyaWZpY2F0aW9uVG9rZW4iLCJjcnlwdG8iLCJyYW5kb21CeXRlcyIsInRvU3RyaW5nIiwicmVnaXN0ZXJMb2NhbFN0cmF0ZWd5IiwicGFzc3dvcmQiLCJkYiIsInNsdWciLCJ2ZXJpZmljYXRpb25Ub2tlbiIsInJlc3VsdCIsInNhbml0aXplSW50ZXJuYWxGaWVsZHMiLCJzYXZlVmVyc2lvbiIsInNlbmRWZXJpZmljYXRpb25FbWFpbCIsImRpc2FibGVFbWFpbCIsInNlbmRFbWFpbCIsInRva2VuIiwidXNlciIsImFmdGVyUmVhZCIsImFmdGVyQ2hhbmdlIiwicHJldmlvdXNEb2MiLCJidWlsZEFmdGVyT3BlcmF0aW9uIiwidW5saW5rVGVtcEZpbGVzIiwiY29tbWl0VHJhbnNhY3Rpb24iLCJlcnJvciIsImtpbGxUcmFuc2FjdGlvbiJdLCJtYXBwaW5ncyI6Ijs7OzsrQkFxWEE7OztlQUFBOzs7K0RBblhtQjsyREFDSjtzQkFDVztzRUFZQTs4RUFDUTswQkFDSTt1QkFDTDs2QkFDTDsyQkFDRjs4QkFDRztnQ0FDRTtrQ0FDRTtpQ0FDRDs2QkFDSjttQ0FDTTtpQ0FDRjtpQ0FDQTsrRUFDRzs2QkFDUDt1QkFDUTs7Ozs7O0FBRXBDLE1BQU1BLGFBQWFDLElBQUFBLGVBQVMsRUFBQ0MsV0FBRSxDQUFDQyxNQUFNO0FBaUJ0QyxlQUFlQyxPQUNiQyxZQUE2RDtJQUU3RCxJQUFJQyxPQUFPRDtJQUVYLHdDQUF3QztJQUN4QywrQkFBK0I7SUFDL0Isd0NBQXdDO0lBRXhDLE1BQU1DLEtBQUtDLFVBQVUsQ0FBQ0MsTUFBTSxDQUFDQyxLQUFLLENBQUNDLGVBQWUsQ0FBQ0MsTUFBTSxDQUN2RCxPQUFPQyxXQUFnREM7UUFDckQsTUFBTUQ7UUFFTk4sT0FDRSxBQUFDLE1BQU1PLEtBQUs7WUFDVlA7WUFDQUMsWUFBWUQsS0FBS0MsVUFBVSxDQUFDQyxNQUFNO1lBQ2xDTSxTQUFTUixLQUFLUyxHQUFHLENBQUNELE9BQU87WUFDekJFLFdBQVc7UUFDYixN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