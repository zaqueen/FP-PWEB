"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _extractTranslations = require("../translations/extractTranslations");
const _mimeTypeValidator = require("./mimeTypeValidator");
const labels = (0, _extractTranslations.extractTranslations)([
    'upload:width',
    'upload:height',
    'upload:fileSize',
    'upload:fileName',
    'upload:sizes'
]);
const getBaseUploadFields = ({ collection, config })=>{
    const uploadOptions = typeof collection.upload === 'object' ? collection.upload : {};
    const mimeType = {
        name: 'mimeType',
        admin: {
            hidden: true,
            readOnly: true
        },
        label: 'MIME Type',
        type: 'text'
    };
    const url = {
        name: 'url',
        admin: {
            hidden: true,
            readOnly: true
        },
        label: 'URL',
        type: 'text'
    };
    const width = {
        name: 'width',
        admin: {
            hidden: true,
            readOnly: true
        },
        label: labels['upload:width'],
        type: 'number'
    };
    const height = {
        name: 'height',
        admin: {
            hidden: true,
            readOnly: true
        },
        label: labels['upload:height'],
        type: 'number'
    };
    const filesize = {
        name: 'filesize',
        admin: {
            hidden: true,
            readOnly: true
        },
        label: labels['upload:fileSize'],
        type: 'number'
    };
    const filename = {
        name: 'filename',
        admin: {
            disableBulkEdit: true,
            hidden: true,
            readOnly: true
        },
        index: true,
        label: labels['upload:fileName'],
        type: 'text',
        unique: true
    };
    let uploadFields = [
        {
            ...url,
            hooks: {
                afterRead: [
                    ({ data })=>{
                        if (data?.filename) {
                            if (uploadOptions.staticURL.startsWith('/')) {
                                return `${config.serverURL}${uploadOptions.staticURL}/${data.filename}`;
                            }
                            return `${uploadOptions.staticURL}/${data.filename}`;
                        }
                        return undefined;
                    }
                ]
            }
        },
        filename,
        mimeType,
        filesize,
        width,
        height
    ];
    if (uploadOptions.mimeTypes) {
        mimeType.validate = (0, _mimeTypeValidator.mimeTypeValidator)(uploadOptions.mimeTypes);
    }
    if (uploadOptions.imageSizes) {
        uploadFields = uploadFields.concat([
            {
                name: 'sizes',
                admin: {
                    hidden: true
                },
                fields: uploadOptions.imageSizes.map((size)=>({
                        name: size.name,
                        admin: {
                            hidden: true
                        },
                        fields: [
                            {
                                ...url,
                                hooks: {
                                    afterRead: [
                                        ({ data })=>{
                                            const sizeFilename = data?.sizes?.[size.name]?.filename;
                                            if (sizeFilename) {
                                                if (uploadOptions.staticURL.startsWith('/')) {
                                                    return `${config.serverURL}${uploadOptions.staticURL}/${sizeFilename}`;
                                                }
                                                return `${uploadOptions.staticURL}/${sizeFilename}`;
                                            }
                                            return undefined;
                                        }
                                    ]
                                }
                            },
                            width,
                            height,
                            mimeType,
                            filesize,
                            {
                                ...filename,
                                unique: false
                            }
                        ],
                        label: size.name,
                        type: 'group'
                    })),
                label: labels['upload:Sizes'],
                type: 'group'
            }
        ]);
    }
    return uploadFields;
};
const _default = getBaseUploadFields;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91cGxvYWRzL2dldEJhc2VGaWVsZHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDb2xsZWN0aW9uQ29uZmlnIH0gZnJvbSAnLi4vY29sbGVjdGlvbnMvY29uZmlnL3R5cGVzJ1xuaW1wb3J0IHR5cGUgeyBDb25maWcgfSBmcm9tICcuLi9jb25maWcvdHlwZXMnXG5pbXBvcnQgdHlwZSB7IEZpZWxkIH0gZnJvbSAnLi4vZmllbGRzL2NvbmZpZy90eXBlcydcbmltcG9ydCB0eXBlIHsgSW5jb21pbmdVcGxvYWRUeXBlIH0gZnJvbSAnLi90eXBlcydcblxuaW1wb3J0IHsgZXh0cmFjdFRyYW5zbGF0aW9ucyB9IGZyb20gJy4uL3RyYW5zbGF0aW9ucy9leHRyYWN0VHJhbnNsYXRpb25zJ1xuaW1wb3J0IHsgbWltZVR5cGVWYWxpZGF0b3IgfSBmcm9tICcuL21pbWVUeXBlVmFsaWRhdG9yJ1xuXG5jb25zdCBsYWJlbHMgPSBleHRyYWN0VHJhbnNsYXRpb25zKFtcbiAgJ3VwbG9hZDp3aWR0aCcsXG4gICd1cGxvYWQ6aGVpZ2h0JyxcbiAgJ3VwbG9hZDpmaWxlU2l6ZScsXG4gICd1cGxvYWQ6ZmlsZU5hbWUnLFxuICAndXBsb2FkOnNpemVzJyxcbl0pXG5cbnR5cGUgT3B0aW9ucyA9IHtcbiAgY29sbGVjdGlvbjogQ29sbGVjdGlvbkNvbmZpZ1xuICBjb25maWc6IENvbmZpZ1xufVxuXG5jb25zdCBnZXRCYXNlVXBsb2FkRmllbGRzID0gKHsgY29sbGVjdGlvbiwgY29uZmlnIH06IE9wdGlvbnMpOiBGaWVsZFtdID0+IHtcbiAgY29uc3QgdXBsb2FkT3B0aW9uczogSW5jb21pbmdVcGxvYWRUeXBlID1cbiAgICB0eXBlb2YgY29sbGVjdGlvbi51cGxvYWQgPT09ICdvYmplY3QnID8gY29sbGVjdGlvbi51cGxvYWQgOiB7fVxuXG4gIGNvbnN0IG1pbWVUeXBlOiBGaWVsZCA9IHtcbiAgICBuYW1lOiAnbWltZVR5cGUnLFxuICAgIGFkbWluOiB7XG4gICAgICBoaWRkZW46IHRydWUsXG4gICAgICByZWFkT25seTogdHJ1ZSxcbiAgICB9LFxuICAgIGxhYmVsOiAnTUlNRSBUeXBlJyxcbiAgICB0eXBlOiAndGV4dCcsXG4gIH1cblxuICBjb25zdCB1cmw6IEZpZWxkID0ge1xuICAgIG5hbWU6ICd1cmwnLFxuICAgIGFkbWluOiB7XG4gICAgICBoaWRkZW46IHRydWUsXG4gICAgICByZWFkT25seTogdHJ1ZSxcbiAgICB9LFxuICAgIGxhYmVsOiAnVVJMJyxcbiAgICB0eXBlOiAndGV4dCcsXG4gIH1cblxuICBjb25zdCB3aWR0aDogRmllbGQgPSB7XG4gICAgbmFtZTogJ3dpZHRoJyxcbiAgICBhZG1pbjoge1xuICAgICAgaGlkZGVuOiB0cnVlLFxuICAgICAgcmVhZE9ubHk6IHRydWUsXG4gICAgfSxcbiAgICBsYWJlbDogbGFiZWxzWyd1cGxvYWQ6d2lkdGgnXSxcbiAgICB0eXBlOiAnbnVtYmVyJyxcbiAgfVxuXG4gIGNvbnN0IGhlaWdodDogRmllbGQgPSB7XG4gICAgbmFtZTogJ2hlaWdodCcsXG4gICAgYWRtaW46IHtcbiAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgIHJlYWRPbmx5OiB0cnVlLFxuICAgIH0sXG4gICAgbGFiZWw6IGxhYmVsc1sndXBsb2FkOmhlaWdodCddLFxuICAgIHR5cGU6ICdudW1iZXInLFxuICB9XG5cbiAgY29uc3QgZmlsZXNpemU6IEZpZWxkID0ge1xuICAgIG5hbWU6ICdmaWxlc2l6ZScsXG4gICAgYWRtaW46IHtcbiAgICAgIGhpZGRlbjogdHJ1ZSxcbiAgICAgIHJlYWRPbmx5OiB0cnVlLFxuICAgIH0sXG4gICAgbGFiZWw6IGxhYmVsc1sndXBsb2FkOmZpbGVTaXplJ10sXG4gICAgdHlwZTogJ251bWJlcicsXG4gIH1cblxuICBjb25zdCBmaWxlbmFtZTogRmllbGQgPSB7XG4gICAgbmFtZTogJ2ZpbGVuYW1lJyxcbiAgICBhZG1pbjoge1xuICAgICAgZGlzYWJsZUJ1bGtFZGl0OiB0cnVlLFxuICAgICAgaGlkZGVuOiB0cnVlLFxuICAgICAgcmVhZE9ubHk6IHRydWUsXG4gICAgfSxcbiAgICBpbmRleDogdHJ1ZSxcbiAgICBsYWJlbDogbGFiZWxzWyd1cGxvYWQ6ZmlsZU5hbWUnXSxcbiAgICB0eXBlOiAndGV4dCcsXG4gICAgdW5pcXVlOiB0cnVlLFxuICB9XG5cbiAgbGV0IHVwbG9hZEZpZWxkczogRmllbGRbXSA9IFtcbiAgICB7XG4gICAgICAuLi51cmwsXG4gICAgICBob29rczoge1xuICAgICAgICBhZnRlclJlYWQ6IFtcbiAgICAgICAgICAoeyBkYXRhIH0pID0+IHtcbiAgICAgICAgICAgIGlmIChkYXRhPy5maWxlbmFtZSkge1xuICAgICAgICAgICAgICBpZiAodXBsb2FkT3B0aW9ucy5zdGF0aWNVUkwuc3RhcnRzV2l0aCgnLycpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke2NvbmZpZy5zZXJ2ZXJVUkx9JHt1cGxvYWRPcHRpb25zLnN0YXRpY1VSTH0vJHtkYXRhLmZpbGVuYW1lfWBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gYCR7dXBsb2FkT3B0aW9ucy5zdGF0aWNVUkx9LyR7ZGF0YS5maWxlbmFtZX1gXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICB9LFxuICAgIGZpbGVuYW1lLFxuICAgIG1pbWVUeXBlLFxuICAgIGZpbGVzaXplLFxuICAgIHdpZHRoLFxuICAgIGhlaWdodCxcbiAgXVxuXG4gIGlmICh1cGxvYWRPcHRpb25zLm1pbWVUeXBlcykge1xuICAgIG1pbWVUeXBlLnZhbGlkYXRlID0gbWltZVR5cGVWYWxpZGF0b3IodXBsb2FkT3B0aW9ucy5taW1lVHlwZXMpXG4gIH1cblxuICBpZiAodXBsb2FkT3B0aW9ucy5pbWFnZVNpemVzKSB7XG4gICAgdXBsb2FkRmllbGRzID0gdXBsb2FkRmllbGRzLmNvbmNhdChbXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdzaXplcycsXG4gICAgICAgIGFkbWluOiB7XG4gICAgICAgICAgaGlkZGVuOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBmaWVsZHM6IHVwbG9hZE9wdGlvbnMuaW1hZ2VTaXplcy5tYXAoKHNpemUpID0+ICh7XG4gICAgICAgICAgbmFtZTogc2l6ZS5uYW1lLFxuICAgICAgICAgIGFkbWluOiB7XG4gICAgICAgICAgICBoaWRkZW46IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaWVsZHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgLi4udXJsLFxuICAgICAgICAgICAgICBob29rczoge1xuICAgICAgICAgICAgICAgIGFmdGVyUmVhZDogW1xuICAgICAgICAgICAgICAgICAgKHsgZGF0YSB9KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpemVGaWxlbmFtZSA9IGRhdGE/LnNpemVzPy5bc2l6ZS5uYW1lXT8uZmlsZW5hbWVcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2l6ZUZpbGVuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHVwbG9hZE9wdGlvbnMuc3RhdGljVVJMLnN0YXJ0c1dpdGgoJy8nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGAke2NvbmZpZy5zZXJ2ZXJVUkx9JHt1cGxvYWRPcHRpb25zLnN0YXRpY1VSTH0vJHtzaXplRmlsZW5hbWV9YFxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7dXBsb2FkT3B0aW9ucy5zdGF0aWNVUkx9LyR7c2l6ZUZpbGVuYW1lfWBcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB3aWR0aCxcbiAgICAgICAgICAgIGhlaWdodCxcbiAgICAgICAgICAgIG1pbWVUeXBlLFxuICAgICAgICAgICAgZmlsZXNpemUsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIC4uLmZpbGVuYW1lLFxuICAgICAgICAgICAgICB1bmlxdWU6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIGxhYmVsOiBzaXplLm5hbWUsXG4gICAgICAgICAgdHlwZTogJ2dyb3VwJyxcbiAgICAgICAgfSkpLFxuICAgICAgICBsYWJlbDogbGFiZWxzWyd1cGxvYWQ6U2l6ZXMnXSxcbiAgICAgICAgdHlwZTogJ2dyb3VwJyxcbiAgICAgIH0sXG4gICAgXSlcbiAgfVxuICByZXR1cm4gdXBsb2FkRmllbGRzXG59XG5cbmV4cG9ydCBkZWZhdWx0IGdldEJhc2VVcGxvYWRGaWVsZHNcbiJdLCJuYW1lcyI6WyJsYWJlbHMiLCJleHRyYWN0VHJhbnNsYXRpb25zIiwiZ2V0QmFzZVVwbG9hZEZpZWxkcyIsImNvbGxlY3Rpb24iLCJjb25maWciLCJ1cGxvYWRPcHRpb25zIiwidXBsb2FkIiwibWltZVR5cGUiLCJuYW1lIiwiYWRtaW4iLCJoaWRkZW4iLCJyZWFkT25seSIsImxhYmVsIiwidHlwZSIsInVybCIsIndpZHRoIiwiaGVpZ2h0IiwiZmlsZXNpemUiLCJmaWxlbmFtZSIsImRpc2FibGVCdWxrRWRpdCIsImluZGV4IiwidW5pcXVlIiwidXBsb2FkRmllbGRzIiwiaG9va3MiLCJhZnRlclJlYWQiLCJkYXRhIiwic3RhdGljVVJMIiwic3RhcnRzV2l0aCIsInNlcnZlclVSTCIsInVuZGVmaW5lZCIsIm1pbWVUeXBlcyIsInZhbGlkYXRlIiwibWltZVR5cGVWYWxpZGF0b3IiLCJpbWFnZVNpemVzIiwiY29uY2F0IiwiZmllbGRzIiwibWFwIiwic2l6ZSIsInNpemVGaWxlbmFtZSIsInNpemVzIl0sIm1hcHBpbmdzIjoiOzs7OytCQXlL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