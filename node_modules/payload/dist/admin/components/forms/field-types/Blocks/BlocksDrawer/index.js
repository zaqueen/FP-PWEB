"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "BlocksDrawer", {
    enumerable: true,
    get: function() {
        return BlocksDrawer;
    }
});
const _modal = require("@faceless-ui/modal");
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _getTranslation = require("../../../../../../utilities/getTranslation");
const _Drawer = require("../../../../elements/Drawer");
const _ThumbnailCard = require("../../../../elements/ThumbnailCard");
const _DefaultBlockImage = /*#__PURE__*/ _interop_require_default(require("../../../../graphics/DefaultBlockImage"));
const _BlockSearch = /*#__PURE__*/ _interop_require_default(require("./BlockSearch"));
require("./index.scss");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {};
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const baseClass = 'blocks-drawer';
const getBlockLabel = (block, i18n)=>{
    if (typeof block.labels.singular === 'string') return block.labels.singular.toLowerCase();
    if (typeof block.labels.singular === 'object') {
        return (0, _getTranslation.getTranslation)(block.labels.singular, i18n).toLowerCase();
    }
    return '';
};
const BlocksDrawer = (props)=>{
    const { addRow, addRowIndex, blocks, drawerSlug, labels } = props;
    const [searchTerm, setSearchTerm] = (0, _react.useState)('');
    const [filteredBlocks, setFilteredBlocks] = (0, _react.useState)(blocks);
    const { closeModal, isModalOpen } = (0, _modal.useModal)();
    const { i18n, t } = (0, _reacti18next.useTranslation)('fields');
    (0, _react.useEffect)(()=>{
        if (!isModalOpen) {
            setSearchTerm('');
        }
    }, [
        isModalOpen
    ]);
    (0, _react.useEffect)(()=>{
        const searchTermToUse = searchTerm.toLowerCase();
        const matchingBlocks = blocks.reduce((matchedBlocks, block)=>{
            const blockLabel = getBlockLabel(block, i18n);
            if (blockLabel.includes(searchTermToUse)) matchedBlocks.push(block);
            return matchedBlocks;
        }, []);
        setFilteredBlocks(matchingBlocks);
    }, [
        searchTerm,
        blocks,
        i18n
    ]);
    return /*#__PURE__*/ _react.default.createElement(_Drawer.Drawer, {
        slug: drawerSlug,
        title: t('addLabel', {
            label: (0, _getTranslation.getTranslation)(labels.singular, i18n)
        })
    }, /*#__PURE__*/ _react.default.createElement(_BlockSearch.default, {
        setSearchTerm: setSearchTerm
    }), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__blocks-wrapper`
    }, /*#__PURE__*/ _react.default.createElement("ul", {
        className: `${baseClass}__blocks`
    }, filteredBlocks?.map((block, index)=>{
        const { imageAltText, imageURL, labels: blockLabels, slug } = block;
        return /*#__PURE__*/ _react.default.createElement("li", {
            className: `${baseClass}__block`,
            key: index
        }, /*#__PURE__*/ _react.default.createElement(_ThumbnailCard.ThumbnailCard, {
            alignLabel: "center",
            label: (0, _getTranslation.getTranslation)(blockLabels.singular, i18n),
            onClick: ()=>{
                addRow(addRowIndex, slug);
                closeModal(drawerSlug);
            },
            thumbnail: imageURL ? /*#__PURE__*/ _react.default.createElement("img", {
                alt: imageAltText,
                src: imageURL
            }) : /*#__PURE__*/ _react.default.createElement("div", {
                className: `${baseClass}__default-image`
            }, /*#__PURE__*/ _react.default.createElement(_DefaultBlockImage.default, null))
        }));
    }))));
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL2Zvcm1zL2ZpZWxkLXR5cGVzL0Jsb2Nrcy9CbG9ja3NEcmF3ZXIvaW5kZXgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgaTE4biB9IGZyb20gJ2kxOG5leHQnXG5cbmltcG9ydCB7IHVzZU1vZGFsIH0gZnJvbSAnQGZhY2VsZXNzLXVpL21vZGFsJ1xuaW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCdcbmltcG9ydCB7IHVzZVRyYW5zbGF0aW9uIH0gZnJvbSAncmVhY3QtaTE4bmV4dCdcblxuaW1wb3J0IHR5cGUgeyBCbG9jayB9IGZyb20gJy4uLy4uLy4uLy4uLy4uLy4uL2ZpZWxkcy9jb25maWcvdHlwZXMnXG5pbXBvcnQgdHlwZSB7IFByb3BzIH0gZnJvbSAnLi90eXBlcydcblxuaW1wb3J0IHsgZ2V0VHJhbnNsYXRpb24gfSBmcm9tICcuLi8uLi8uLi8uLi8uLi8uLi91dGlsaXRpZXMvZ2V0VHJhbnNsYXRpb24nXG5pbXBvcnQgeyBEcmF3ZXIgfSBmcm9tICcuLi8uLi8uLi8uLi9lbGVtZW50cy9EcmF3ZXInXG5pbXBvcnQgeyBUaHVtYm5haWxDYXJkIH0gZnJvbSAnLi4vLi4vLi4vLi4vZWxlbWVudHMvVGh1bWJuYWlsQ2FyZCdcbmltcG9ydCBEZWZhdWx0QmxvY2tJbWFnZSBmcm9tICcuLi8uLi8uLi8uLi9ncmFwaGljcy9EZWZhdWx0QmxvY2tJbWFnZSdcbmltcG9ydCBCbG9ja1NlYXJjaCBmcm9tICcuL0Jsb2NrU2VhcmNoJ1xuaW1wb3J0ICcuL2luZGV4LnNjc3MnXG5cbmNvbnN0IGJhc2VDbGFzcyA9ICdibG9ja3MtZHJhd2VyJ1xuXG5jb25zdCBnZXRCbG9ja0xhYmVsID0gKGJsb2NrOiBCbG9jaywgaTE4bjogaTE4bikgPT4ge1xuICBpZiAodHlwZW9mIGJsb2NrLmxhYmVscy5zaW5ndWxhciA9PT0gJ3N0cmluZycpIHJldHVybiBibG9jay5sYWJlbHMuc2luZ3VsYXIudG9Mb3dlckNhc2UoKVxuICBpZiAodHlwZW9mIGJsb2NrLmxhYmVscy5zaW5ndWxhciA9PT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gZ2V0VHJhbnNsYXRpb24oYmxvY2subGFiZWxzLnNpbmd1bGFyLCBpMThuKS50b0xvd2VyQ2FzZSgpXG4gIH1cbiAgcmV0dXJuICcnXG59XG5cbmV4cG9ydCBjb25zdCBCbG9ja3NEcmF3ZXI6IFJlYWN0LkZDPFByb3BzPiA9IChwcm9wcykgPT4ge1xuICBjb25zdCB7IGFkZFJvdywgYWRkUm93SW5kZXgsIGJsb2NrcywgZHJhd2VyU2x1ZywgbGFiZWxzIH0gPSBwcm9wc1xuXG4gIGNvbnN0IFtzZWFyY2hUZXJtLCBzZXRTZWFyY2hUZXJtXSA9IHVzZVN0YXRlKCcnKVxuICBjb25zdCBbZmlsdGVyZWRCbG9ja3MsIHNldEZpbHRlcmVkQmxvY2tzXSA9IHVzZVN0YXRlKGJsb2NrcylcbiAgY29uc3QgeyBjbG9zZU1vZGFsLCBpc01vZGFsT3BlbiB9ID0gdXNlTW9kYWwoKVxuICBjb25zdCB7IGkxOG4sIHQgfSA9IHVzZVRyYW5zbGF0aW9uKCdmaWVsZHMnKVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCFpc01vZGFsT3Blbikge1xuICAgICAgc2V0U2VhcmNoVGVybSgnJylcbiAgICB9XG4gIH0sIFtpc01vZGFsT3Blbl0pXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBzZWFyY2hUZXJtVG9Vc2UgPSBzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKClcblxuICAgIGNvbnN0IG1hdGNoaW5nQmxvY2tzID0gYmxvY2tzLnJlZHVjZSgobWF0Y2hlZEJsb2NrcywgYmxvY2spID0+IHtcbiAgICAgIGNvbnN0IGJsb2NrTGFiZWwgPSBnZXRCbG9ja0xhYmVsKGJsb2NrLCBpMThuKVxuICAgICAgaWYgKGJsb2NrTGFiZWwuaW5jbHVkZXMoc2VhcmNoVGVybVRvVXNlKSkgbWF0Y2hlZEJsb2Nrcy5wdXNoKGJsb2NrKVxuICAgICAgcmV0dXJuIG1hdGNoZWRCbG9ja3NcbiAgICB9LCBbXSlcblxuICAgIHNldEZpbHRlcmVkQmxvY2tzKG1hdGNoaW5nQmxvY2tzKVxuICB9LCBbc2VhcmNoVGVybSwgYmxvY2tzLCBpMThuXSlcblxuICByZXR1cm4gKFxuICAgIDxEcmF3ZXJcbiAgICAgIHNsdWc9e2RyYXdlclNsdWd9XG4gICAgICB0aXRsZT17dCgnYWRkTGFiZWwnLCB7IGxhYmVsOiBnZXRUcmFuc2xhdGlvbihsYWJlbHMuc2luZ3VsYXIsIGkxOG4pIH0pfVxuICAgID5cbiAgICAgIDxCbG9ja1NlYXJjaCBzZXRTZWFyY2hUZXJtPXtzZXRTZWFyY2hUZXJtfSAvPlxuICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2Jsb2Nrcy13cmFwcGVyYH0+XG4gICAgICAgIDx1bCBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2Jsb2Nrc2B9PlxuICAgICAgICAgIHtmaWx0ZXJlZEJsb2Nrcz8ubWFwKChibG9jaywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgaW1hZ2VBbHRUZXh0LCBpbWFnZVVSTCwgbGFiZWxzOiBibG9ja0xhYmVscywgc2x1ZyB9ID0gYmxvY2tcblxuICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgPGxpIGNsYXNzTmFtZT17YCR7YmFzZUNsYXNzfV9fYmxvY2tgfSBrZXk9e2luZGV4fT5cbiAgICAgICAgICAgICAgICA8VGh1bWJuYWlsQ2FyZFxuICAgICAgICAgICAgICAgICAgYWxpZ25MYWJlbD1cImNlbnRlclwiXG4gICAgICAgICAgICAgICAgICBsYWJlbD17Z2V0VHJhbnNsYXRpb24oYmxvY2tMYWJlbHMuc2luZ3VsYXIsIGkxOG4pfVxuICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBhZGRSb3coYWRkUm93SW5kZXgsIHNsdWcpXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlTW9kYWwoZHJhd2VyU2x1ZylcbiAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICB0aHVtYm5haWw9e1xuICAgICAgICAgICAgICAgICAgICBpbWFnZVVSTCA/IChcbiAgICAgICAgICAgICAgICAgICAgICA8aW1nIGFsdD17aW1hZ2VBbHRUZXh0fSBzcmM9e2ltYWdlVVJMfSAvPlxuICAgICAgICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19kZWZhdWx0LWltYWdlYH0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8RGVmYXVsdEJsb2NrSW1hZ2UgLz5cbiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICApXG4gICAgICAgICAgfSl9XG4gICAgICAgIDwvdWw+XG4gICAgICA8L2Rpdj5cbiAgICA8L0RyYXdlcj5cbiAgKVxufVxuIl0sIm5hbWVzIjpbIkJsb2Nrc0RyYXdlciIsImJhc2VDbGFzcyIsImdldEJsb2NrTGFiZWwiLCJibG9jayIsImkxOG4iLCJsYWJlbHMiLCJzaW5ndWxhciIsInRvTG93ZXJDYXNlIiwiZ2V0VHJhbnNsYXRpb24iLCJwcm9wcyIsImFkZFJvdyIsImFkZFJvd0luZGV4IiwiYmxvY2tzIiwiZHJhd2VyU2x1ZyIsInNlYXJjaFRlcm0iLCJzZXRTZWFyY2hUZXJtIiwidXNlU3RhdGUiLCJmaWx0ZXJlZEJsb2NrcyIsInNldEZpbHRlcmVkQmxvY2tzIiwiY2xvc2VNb2RhbCIsImlzTW9kYWxPcGVuIiwidXNlTW9kYWwiLCJ0IiwidXNlVHJhbnNsYXRpb24iLCJ1c2VFZmZlY3QiLCJzZWFyY2hUZXJtVG9Vc2UiLCJtYXRjaGluZ0Jsb2NrcyIsInJlZHVjZSIsIm1hdGNoZWRCbG9ja3MiLCJibG9ja0xhYmVsIiwiaW5jbHVkZXMiLCJwdXNoIiwiRHJhd2VyIiwic2x1ZyIsInRpdGxlIiwibGFiZWwiLCJCbG9ja1NlYXJjaCIsImRpdiIsImNsYXNzTmFtZSIsInVsIiwibWFwIiwiaW5kZXgiLCJpbWFnZUFsdFRleHQiLCJpbWFnZVVSTCIsImJsb2NrTGFiZWxzIiwibGkiLCJrZXkiLCJUaHVtYm5haWxDYXJkIiwiYWxpZ25MYWJlbCIsIm9uQ2xpY2siLCJ0aHVtYm5haWwiLCJpbWciLCJhbHQiLCJzcmMiLCJEZWZhdWx0QmxvY2tJbWFnZSJdLCJtYXBwaW5ncyI6Ijs7OzsrQkEwQmFBOzs7ZUFBQUE7Ozt1QkF4Qlk7K0RBQ2tCOzhCQUNaO2dDQUtBO3dCQUNSOytCQUNPOzBFQUNBO29FQUNOO1FBQ2pCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFUCxNQUFNQyxZQUFZO0FBRWxCLE1BQU1DLGdCQUFnQixDQUFDQyxPQUFjQztJQUNuQyxJQUFJLE9BQU9ELE1BQU1FLE1BQU0sQ0FBQ0MsUUFBUSxLQUFLLFVBQVUsT0FBT0gsTUFBTUUsTUFBTSxDQUFDQyxRQUFRLENBQUNDLFdBQVc7SUFDdkYsSUFBSSxPQUFPSixNQUFNRSxNQUFNLENBQUNDLFFBQVEsS0FBSyxVQUFVO1FBQzdDLE9BQU9FLElBQUFBLDhCQUFjLEVBQUNMLE1BQU1FLE1BQU0sQ0FBQ0MsUUFBUSxFQUFFRixNQUFNRyxXQUFXO0lBQ2hFO0lBQ0EsT0FBTztBQUNUO0FBRU8sTUFBTVAsZUFBZ0MsQ0FBQ1M7SUFDNUMsTUFBTSxFQUFFQyxNQUFNLEVBQUVDLFdBQVcsRUFBRUMsTUFBTSxFQUFFQyxVQUFVLEVBQUVSLE1BQU0sRUFBRSxHQUFHSTtJQUU1RCxNQUFNLENBQUNLLFlBQVlDLGNBQWMsR0FBR0MsSUFBQUEsZUFBUSxFQUFDO0lBQzdDLE1BQU0sQ0FBQ0MsZ0JBQWdCQyxrQkFBa0IsR0FBR0YsSUFBQUEsZUFBUSxFQUFDSjtJQUNyRCxNQUFNLEVBQUVPLFVBQVUsRUFBRUMsV0FBVyxFQUFFLEdBQUdDLElBQUFBLGVBQVE7SUFDNUMsTUFBTSxFQUFFakIsSUFBSSxFQUFFa0IsQ0FBQyxFQUFFLEdBQUdDLElBQUFBLDRCQUFjLEVBQUM7SUFFbkNDLElBQUFBLGdCQUFTLEVBQUM7UUFDUixJQUFJLENBQUNKLGFBQWE7WUFDaEJMLGNBQWM7UUFDaEI7SUFDRixHQUFHO1FBQUNLO0tBQVk7SUFFaEJJLElBQUFBLGdCQUFTLEVBQUM7UUFDUixNQUFNQyxrQkFBa0JYLFdBQVdQLFdBQVc7UUFFOUMsTUFBTW1CLGlCQUFpQmQsT0FBT2UsTUFBTSxDQUFDLENBQUNDLGVBQWV6QjtZQUNuRCxNQUFNMEIsYUFBYTNCLGNBQWNDLE9BQU9DO1lBQ3hDLElBQUl5QixXQUFXQyxRQUFRLENBQUNMLGtCQUFrQkcsY0FBY0csSUFBSSxDQUFDNUI7WUFDN0QsT0FBT3lCO1FBQ1QsR0FBRyxFQUFFO1FBRUxWLGtCQUFrQlE7SUFDcEIsR0FBRztRQUFDWjtRQUFZRjtRQUFRUjtLQUFLO0lBRTdCLHFCQUNFLDZCQUFDNEIsY0FBTTtRQUNMQyxNQUFNcEI7UUFDTnFCLE9BQU9aLEVBQUUsWUFBWTtZQUFFYSxPQUFPM0IsSUFBQUEsOEJBQWMsRUFBQ0gsT0FBT0MsUUFBUSxFQUFFRjtRQUFNO3FCQUVwRSw2QkFBQ2dDLG9CQUFXO1FBQUNyQixlQUFlQTtzQkFDNUIsNkJBQUNzQjtRQUFJQyxXQUFXLENBQUMsRUFBRXJDLFVBQVUsZ0JBQWdCLENBQUM7cUJBQzVDLDZCQUFDc0M7UUFBR0QsV0FBVyxDQUFDLEVBQUVyQyxVQUFVLFFBQVEsQ0FBQztPQUNsQ2dCLGdCQUFnQnVCLElBQUksQ0FBQ3JDLE9BQU9zQztRQUMzQixNQUFNLEVBQUVDLFlBQVksRUFBRUMsUUFBUSxFQUFFdEMsUUFBUXVDLFdBQVcsRUFBRVgsSUFBSSxFQUFFLEdBQUc5QjtRQUU5RCxxQkFDRSw2QkFBQzBDO1lBQUdQLFdBQVcsQ0FBQyxFQUFFckMsVUFBVSxPQUFPLENBQUM7WUFBRTZDLEtBQUtMO3lCQUN6Qyw2QkFBQ00sNEJBQWE7WUFDWkMsWUFBVztZQUNYYixPQUFPM0IsSUFBQUEsOEJBQWMsRUFBQ29DLFlBQVl0QyxRQUFRLEVBQUVGO1lBQzVDNkMsU0FBUztnQkFDUHZDLE9BQU9DLGFBQWFzQjtnQkFDcEJkLFdBQVdOO1lBQ2I7WUFDQXFDLFdBQ0VQLHlCQUNFLDZCQUFDUTtnQkFBSUMsS0FBS1Y7Z0JBQWNXLEtBQUtWOytCQUU3Qiw2QkFBQ047Z0JBQUlDLFdBQVcsQ0FBQyxFQUFFckMsVUFBVSxlQUFlLENBQUM7NkJBQzNDLDZCQUFDcUQsMEJBQWlCOztJQU9oQztBQUtWIn0=