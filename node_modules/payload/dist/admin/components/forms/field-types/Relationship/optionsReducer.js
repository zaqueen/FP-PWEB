"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _getTranslation = require("../../../../../utilities/getTranslation");
const _useTitle = require("../../../../hooks/useTitle");
const reduceToIDs = (options)=>options.reduce((ids, option)=>{
        if (option.options) {
            return [
                ...ids,
                ...reduceToIDs(option.options)
            ];
        }
        return [
            ...ids,
            option.value
        ];
    }, []);
const sortOptions = (options)=>options.sort((a, b)=>{
        if (typeof a?.label?.localeCompare === 'function' && typeof b?.label?.localeCompare === 'function') {
            return a.label.localeCompare(b.label);
        }
        return 0;
    });
const optionsReducer = (state, action)=>{
    switch(action.type){
        case 'CLEAR':
            {
                return [];
            }
        case 'UPDATE':
            {
                const { collection, config, doc, i18n } = action;
                const relation = collection.slug;
                const newOptions = [
                    ...state
                ];
                const docTitle = (0, _useTitle.formatUseAsTitle)({
                    collection,
                    config,
                    doc,
                    i18n
                });
                const foundOptionGroup = newOptions.find((optionGroup)=>optionGroup.label === collection.labels.plural);
                const foundOption = foundOptionGroup?.options?.find((option)=>option.value === doc.id);
                if (foundOption) {
                    foundOption.label = docTitle || `${i18n.t('general:untitled')} - ID: ${doc.id}`;
                    foundOption.relationTo = relation;
                }
                return newOptions;
            }
        case 'ADD':
            {
                const { collection, config, docs, i18n, ids = [], sort } = action;
                const relation = collection.slug;
                const loadedIDs = reduceToIDs(state);
                const newOptions = [
                    ...state
                ];
                const optionsToAddTo = newOptions.find((optionGroup)=>optionGroup.label === collection.labels.plural);
                const newSubOptions = docs.reduce((docSubOptions, doc)=>{
                    if (loadedIDs.indexOf(doc.id) === -1) {
                        loadedIDs.push(doc.id);
                        const docTitle = (0, _useTitle.formatUseAsTitle)({
                            collection,
                            config,
                            doc,
                            i18n
                        });
                        return [
                            ...docSubOptions,
                            {
                                label: docTitle || `${i18n.t('general:untitled')} - ID: ${doc.id}`,
                                relationTo: relation,
                                value: doc.id
                            }
                        ];
                    }
                    return docSubOptions;
                }, []);
                ids.forEach((id)=>{
                    if (!loadedIDs.includes(id)) {
                        newSubOptions.push({
                            label: `${i18n.t('general:untitled')} - ID: ${id}`,
                            relationTo: relation,
                            value: id
                        });
                    }
                });
                if (optionsToAddTo) {
                    const subOptions = [
                        ...optionsToAddTo.options,
                        ...newSubOptions
                    ];
                    optionsToAddTo.options = sort ? sortOptions(subOptions) : subOptions;
                } else {
                    newOptions.push({
                        label: (0, _getTranslation.getTranslation)(collection.labels.plural, i18n),
                        options: sort ? sortOptions(newSubOptions) : newSubOptions
                    });
                }
                return newOptions;
            }
        default:
            {
                return state;
            }
    }
};
const _default = optionsReducer;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL2Zvcm1zL2ZpZWxkLXR5cGVzL1JlbGF0aW9uc2hpcC9vcHRpb25zUmVkdWNlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEFjdGlvbiwgT3B0aW9uLCBPcHRpb25Hcm91cCB9IGZyb20gJy4vdHlwZXMnXG5cbmltcG9ydCB7IGdldFRyYW5zbGF0aW9uIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vdXRpbGl0aWVzL2dldFRyYW5zbGF0aW9uJ1xuaW1wb3J0IHsgZm9ybWF0VXNlQXNUaXRsZSB9IGZyb20gJy4uLy4uLy4uLy4uL2hvb2tzL3VzZVRpdGxlJ1xuXG5jb25zdCByZWR1Y2VUb0lEcyA9IChvcHRpb25zKSA9PlxuICBvcHRpb25zLnJlZHVjZSgoaWRzLCBvcHRpb24pID0+IHtcbiAgICBpZiAob3B0aW9uLm9wdGlvbnMpIHtcbiAgICAgIHJldHVybiBbLi4uaWRzLCAuLi5yZWR1Y2VUb0lEcyhvcHRpb24ub3B0aW9ucyldXG4gICAgfVxuXG4gICAgcmV0dXJuIFsuLi5pZHMsIG9wdGlvbi52YWx1ZV1cbiAgfSwgW10pXG5cbmNvbnN0IHNvcnRPcHRpb25zID0gKG9wdGlvbnM6IE9wdGlvbltdKTogT3B0aW9uW10gPT5cbiAgb3B0aW9ucy5zb3J0KChhOiBPcHRpb24sIGI6IE9wdGlvbikgPT4ge1xuICAgIGlmIChcbiAgICAgIHR5cGVvZiBhPy5sYWJlbD8ubG9jYWxlQ29tcGFyZSA9PT0gJ2Z1bmN0aW9uJyAmJlxuICAgICAgdHlwZW9mIGI/LmxhYmVsPy5sb2NhbGVDb21wYXJlID09PSAnZnVuY3Rpb24nXG4gICAgKSB7XG4gICAgICByZXR1cm4gYS5sYWJlbC5sb2NhbGVDb21wYXJlKGIubGFiZWwpXG4gICAgfVxuXG4gICAgcmV0dXJuIDBcbiAgfSlcblxuY29uc3Qgb3B0aW9uc1JlZHVjZXIgPSAoc3RhdGU6IE9wdGlvbkdyb3VwW10sIGFjdGlvbjogQWN0aW9uKTogT3B0aW9uR3JvdXBbXSA9PiB7XG4gIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICBjYXNlICdDTEVBUic6IHtcbiAgICAgIHJldHVybiBbXVxuICAgIH1cblxuICAgIGNhc2UgJ1VQREFURSc6IHtcbiAgICAgIGNvbnN0IHsgY29sbGVjdGlvbiwgY29uZmlnLCBkb2MsIGkxOG4gfSA9IGFjdGlvblxuICAgICAgY29uc3QgcmVsYXRpb24gPSBjb2xsZWN0aW9uLnNsdWdcbiAgICAgIGNvbnN0IG5ld09wdGlvbnMgPSBbLi4uc3RhdGVdXG5cbiAgICAgIGNvbnN0IGRvY1RpdGxlID0gZm9ybWF0VXNlQXNUaXRsZSh7XG4gICAgICAgIGNvbGxlY3Rpb24sXG4gICAgICAgIGNvbmZpZyxcbiAgICAgICAgZG9jLFxuICAgICAgICBpMThuLFxuICAgICAgfSlcblxuICAgICAgY29uc3QgZm91bmRPcHRpb25Hcm91cCA9IG5ld09wdGlvbnMuZmluZChcbiAgICAgICAgKG9wdGlvbkdyb3VwKSA9PiBvcHRpb25Hcm91cC5sYWJlbCA9PT0gY29sbGVjdGlvbi5sYWJlbHMucGx1cmFsLFxuICAgICAgKVxuICAgICAgY29uc3QgZm91bmRPcHRpb24gPSBmb3VuZE9wdGlvbkdyb3VwPy5vcHRpb25zPy5maW5kKChvcHRpb24pID0+IG9wdGlvbi52YWx1ZSA9PT0gZG9jLmlkKVxuXG4gICAgICBpZiAoZm91bmRPcHRpb24pIHtcbiAgICAgICAgZm91bmRPcHRpb24ubGFiZWwgPSBkb2NUaXRsZSB8fCBgJHtpMThuLnQoJ2dlbmVyYWw6dW50aXRsZWQnKX0gLSBJRDogJHtkb2MuaWR9YFxuICAgICAgICBmb3VuZE9wdGlvbi5yZWxhdGlvblRvID0gcmVsYXRpb25cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ld09wdGlvbnNcbiAgICB9XG5cbiAgICBjYXNlICdBREQnOiB7XG4gICAgICBjb25zdCB7IGNvbGxlY3Rpb24sIGNvbmZpZywgZG9jcywgaTE4biwgaWRzID0gW10sIHNvcnQgfSA9IGFjdGlvblxuICAgICAgY29uc3QgcmVsYXRpb24gPSBjb2xsZWN0aW9uLnNsdWdcbiAgICAgIGNvbnN0IGxvYWRlZElEcyA9IHJlZHVjZVRvSURzKHN0YXRlKVxuICAgICAgY29uc3QgbmV3T3B0aW9ucyA9IFsuLi5zdGF0ZV1cbiAgICAgIGNvbnN0IG9wdGlvbnNUb0FkZFRvID0gbmV3T3B0aW9ucy5maW5kKFxuICAgICAgICAob3B0aW9uR3JvdXApID0+IG9wdGlvbkdyb3VwLmxhYmVsID09PSBjb2xsZWN0aW9uLmxhYmVscy5wbHVyYWwsXG4gICAgICApXG5cbiAgICAgIGNvbnN0IG5ld1N1Yk9wdGlvbnMgPSBkb2NzLnJlZHVjZSgoZG9jU3ViT3B0aW9ucywgZG9jKSA9PiB7XG4gICAgICAgIGlmIChsb2FkZWRJRHMuaW5kZXhPZihkb2MuaWQpID09PSAtMSkge1xuICAgICAgICAgIGxvYWRlZElEcy5wdXNoKGRvYy5pZClcblxuICAgICAgICAgIGNvbnN0IGRvY1RpdGxlID0gZm9ybWF0VXNlQXNUaXRsZSh7XG4gICAgICAgICAgICBjb2xsZWN0aW9uLFxuICAgICAgICAgICAgY29uZmlnLFxuICAgICAgICAgICAgZG9jLFxuICAgICAgICAgICAgaTE4bixcbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLmRvY1N1Yk9wdGlvbnMsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGxhYmVsOiBkb2NUaXRsZSB8fCBgJHtpMThuLnQoJ2dlbmVyYWw6dW50aXRsZWQnKX0gLSBJRDogJHtkb2MuaWR9YCxcbiAgICAgICAgICAgICAgcmVsYXRpb25UbzogcmVsYXRpb24sXG4gICAgICAgICAgICAgIHZhbHVlOiBkb2MuaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBkb2NTdWJPcHRpb25zXG4gICAgICB9LCBbXSlcblxuICAgICAgaWRzLmZvckVhY2goKGlkKSA9PiB7XG4gICAgICAgIGlmICghbG9hZGVkSURzLmluY2x1ZGVzKGlkKSkge1xuICAgICAgICAgIG5ld1N1Yk9wdGlvbnMucHVzaCh7XG4gICAgICAgICAgICBsYWJlbDogYCR7aTE4bi50KCdnZW5lcmFsOnVudGl0bGVkJyl9IC0gSUQ6ICR7aWR9YCxcbiAgICAgICAgICAgIHJlbGF0aW9uVG86IHJlbGF0aW9uLFxuICAgICAgICAgICAgdmFsdWU6IGlkLFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG5cbiAgICAgIGlmIChvcHRpb25zVG9BZGRUbykge1xuICAgICAgICBjb25zdCBzdWJPcHRpb25zID0gWy4uLm9wdGlvbnNUb0FkZFRvLm9wdGlvbnMsIC4uLm5ld1N1Yk9wdGlvbnNdXG5cbiAgICAgICAgb3B0aW9uc1RvQWRkVG8ub3B0aW9ucyA9IHNvcnQgPyBzb3J0T3B0aW9ucyhzdWJPcHRpb25zKSA6IHN1Yk9wdGlvbnNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld09wdGlvbnMucHVzaCh7XG4gICAgICAgICAgbGFiZWw6IGdldFRyYW5zbGF0aW9uKGNvbGxlY3Rpb24ubGFiZWxzLnBsdXJhbCwgaTE4biksXG4gICAgICAgICAgb3B0aW9uczogc29ydCA/IHNvcnRPcHRpb25zKG5ld1N1Yk9wdGlvbnMpIDogbmV3U3ViT3B0aW9ucyxcbiAgICAgICAgfSlcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ld09wdGlvbnNcbiAgICB9XG5cbiAgICBkZWZhdWx0OiB7XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgb3B0aW9uc1JlZHVjZXJcbiJdLCJuYW1lcyI6WyJyZWR1Y2VUb0lEcyIsIm9wdGlvbnMiLCJyZWR1Y2UiLCJpZHMiLCJvcHRpb24iLCJ2YWx1ZSIsInNvcnRPcHRpb25zIiwic29ydCIsImEiLCJiIiwibGFiZWwiLCJsb2NhbGVDb21wYXJlIiwib3B0aW9uc1JlZHVjZXIiLCJzdGF0ZSIsImFjdGlvbiIsInR5cGUiLCJjb2xsZWN0aW9uIiwiY29uZmlnIiwiZG9jIiwiaTE4biIsInJlbGF0aW9uIiwic2x1ZyIsIm5ld09wdGlvbnMiLCJkb2NUaXRsZSIsImZvcm1hdFVzZUFzVGl0bGUiLCJmb3VuZE9wdGlvbkdyb3VwIiwiZmluZCIsIm9wdGlvbkdyb3VwIiwibGFiZWxzIiwicGx1cmFsIiwiZm91bmRPcHRpb24iLCJpZCIsInQiLCJyZWxhdGlvblRvIiwiZG9jcyIsImxvYWRlZElEcyIsIm9wdGlvbnNUb0FkZFRvIiwibmV3U3ViT3B0aW9ucyIsImRvY1N1Yk9wdGlvbnMiLCJpbmRleE9mIiwicHVzaCIsImZvckVhY2giLCJpbmNsdWRlcyIsInN1Yk9wdGlvbnMiLCJnZXRUcmFuc2xhdGlvbiJdLCJtYXBwaW5ncyI6Ijs7OzsrQkF3SEE7OztlQUFBOzs7Z0NBdEgrQjswQkFDRTtBQUVqQyxNQUFNQSxjQUFjLENBQUNDLFVBQ25CQSxRQUFRQyxNQUFNLENBQUMsQ0FBQ0MsS0FBS0M7UUFDbkIsSUFBSUEsT0FBT0gsT0FBTyxFQUFFO1lBQ2xCLE9BQU87bUJBQUlFO21CQUFRSCxZQUFZSSxPQUFPSCxPQUFPO2FBQUU7UUFDakQ7UUFFQSxPQUFPO2VBQUlFO1lBQUtDLE9BQU9DLEtBQUs7U0FBQztJQUMvQixHQUFHLEVBQUU7QUFFUCxNQUFNQyxjQUFjLENBQUNMLFVBQ25CQSxRQUFRTSxJQUFJLENBQUMsQ0FBQ0MsR0FBV0M7UUFDdkIsSUFDRSxPQUFPRCxHQUFHRSxPQUFPQyxrQkFBa0IsY0FDbkMsT0FBT0YsR0FBR0MsT0FBT0Msa0JBQWtCLFlBQ25DO1lBQ0EsT0FBT0gsRUFBRUUsS0FBSyxDQUFDQyxhQUFhLENBQUNGLEVBQUVDLEtBQUs7UUFDdEM7UUFFQSxPQUFPO0lBQ1Q7QUFFRixNQUFNRSxpQkFBaUIsQ0FBQ0MsT0FBc0JDO0lBQzVDLE9BQVFBLE9BQU9DLElBQUk7UUFDakIsS0FBSztZQUFTO2dCQUNaLE9BQU8sRUFBRTtZQUNYO1FBRUEsS0FBSztZQUFVO2dCQUNiLE1BQU0sRUFBRUMsVUFBVSxFQUFFQyxNQUFNLEVBQUVD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