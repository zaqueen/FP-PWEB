"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
const _react = /*#__PURE__*/ _interop_require_wildcard(require("react"));
const _reacti18next = require("react-i18next");
const _types = require("../../../../../fields/config/types");
const _getTranslation = require("../../../../../utilities/getTranslation");
const _toKebabCase = /*#__PURE__*/ _interop_require_default(require("../../../../../utilities/toKebabCase"));
const _provider = require("../../../elements/Collapsible/provider");
const _ErrorPill = require("../../../elements/ErrorPill");
const _DocumentInfo = require("../../../utilities/DocumentInfo");
const _Preferences = require("../../../utilities/Preferences");
const _FieldDescription = /*#__PURE__*/ _interop_require_default(require("../../FieldDescription"));
const _context = require("../../Form/context");
const _createNestedFieldPath = require("../../Form/createNestedFieldPath");
const _RenderFields = /*#__PURE__*/ _interop_require_default(require("../../RenderFields"));
const _WatchChildErrors = require("../../WatchChildErrors");
const _withCondition = /*#__PURE__*/ _interop_require_default(require("../../withCondition"));
const _shared = require("../shared");
require("./index.scss");
const _provider1 = require("./provider");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {};
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
const baseClass = 'tabs-field';
const TabComponent = ({ isActive, parentPath, setIsActive, tab })=>{
    const { i18n } = (0, _reacti18next.useTranslation)();
    const [errorCount, setErrorCount] = (0, _react.useState)(undefined);
    const hasName = (0, _types.tabHasName)(tab);
    const submitted = (0, _context.useFormSubmitted)();
    const pathSegments = [];
    if (parentPath) pathSegments.push(parentPath);
    if (hasName) pathSegments.push(tab.name);
    const path = pathSegments.join('.');
    const tabHasErrors = submitted && errorCount > 0;
    return /*#__PURE__*/ _react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/ _react.default.createElement(_WatchChildErrors.WatchChildErrors, {
        fieldSchema: hasName ? undefined : tab.fields,
        path: path,
        setErrorCount: setErrorCount
    }), /*#__PURE__*/ _react.default.createElement("button", {
        className: [
            `${baseClass}__tab-button`,
            tabHasErrors && `${baseClass}__tab-button--has-error`,
            isActive && `${baseClass}__tab-button--active`
        ].filter(Boolean).join(' '),
        onClick: setIsActive,
        type: "button"
    }, tab.label ? (0, _getTranslation.getTranslation)(tab.label, i18n) : hasName && tab.name, tabHasErrors && /*#__PURE__*/ _react.default.createElement(_ErrorPill.ErrorPill, {
        count: errorCount
    })));
};
const TabsField = (props)=>{
    const { admin: { className, readOnly }, fieldTypes, forceRender = false, indexPath, path, permissions, tabs } = props;
    const { getPreference, setPreference } = (0, _Preferences.usePreferences)();
    const { preferencesKey } = (0, _DocumentInfo.useDocumentInfo)();
    const { i18n } = (0, _reacti18next.useTranslation)();
    const isWithinCollapsible = (0, _provider.useCollapsible)();
    const [activeTabIndex, setActiveTabIndex] = (0, _react.useState)(0);
    const tabsPrefKey = `tabs-${indexPath}`;
    (0, _react.useEffect)(()=>{
        const getInitialPref = async ()=>{
            const existingPreferences = await getPreference(preferencesKey);
            const initialIndex = path ? existingPreferences?.fields?.[path]?.tabIndex : existingPreferences?.fields?.[tabsPrefKey]?.tabIndex;
            setActiveTabIndex(initialIndex || 0);
        };
        void getInitialPref();
    }, [
        path,
        indexPath,
        getPreference,
        preferencesKey,
        tabsPrefKey
    ]);
    const handleTabChange = (0, _react.useCallback)(async (incomingTabIndex)=>{
        setActiveTabIndex(incomingTabIndex);
        const existingPreferences = await getPreference(preferencesKey);
        setPreference(preferencesKey, {
            ...existingPreferences,
            ...path ? {
                fields: {
                    ...existingPreferences?.fields || {},
                    [path]: {
                        ...existingPreferences?.fields?.[path],
                        tabIndex: incomingTabIndex
                    }
                }
            } : {
                fields: {
                    ...existingPreferences?.fields,
                    [tabsPrefKey]: {
                        ...existingPreferences?.fields?.[tabsPrefKey],
                        tabIndex: incomingTabIndex
                    }
                }
            }
        });
    }, [
        preferencesKey,
        getPreference,
        setPreference,
        path,
        tabsPrefKey
    ]);
    const activeTabConfig = tabs[activeTabIndex];
    return /*#__PURE__*/ _react.default.createElement("div", {
        className: [
            _shared.fieldBaseClass,
            className,
            baseClass,
            isWithinCollapsible && `${baseClass}--within-collapsible`
        ].filter(Boolean).join(' ')
    }, /*#__PURE__*/ _react.default.createElement(_provider1.TabsProvider, null, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__tabs-wrap`
    }, /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__tabs`
    }, tabs.map((tab, tabIndex)=>{
        return /*#__PURE__*/ _react.default.createElement(TabComponent, {
            isActive: activeTabIndex === tabIndex,
            key: tabIndex,
            parentPath: path,
            setIsActive: ()=>handleTabChange(tabIndex),
            tab: tab
        });
    }))), /*#__PURE__*/ _react.default.createElement("div", {
        className: `${baseClass}__content-wrap`
    }, activeTabConfig && /*#__PURE__*/ _react.default.createElement(_react.default.Fragment, null, /*#__PURE__*/ _react.default.createElement("div", {
        className: [
            `${baseClass}__tab`,
            activeTabConfig.label && `${baseClass}__tabConfigLabel-${(0, _toKebabCase.default)((0, _getTranslation.getTranslation)(activeTabConfig.label, i18n))}`
        ].filter(Boolean).join(' ')
    }, /*#__PURE__*/ _react.default.createElement(_FieldDescription.default, {
        className: `${baseClass}__description`,
        description: activeTabConfig.description,
        marginPlacement: "bottom"
    }), /*#__PURE__*/ _react.default.createElement(_RenderFields.default, {
        fieldSchema: activeTabConfig.fields.map((field)=>{
            const pathSegments = [];
            if (path) pathSegments.push(path);
            if ((0, _types.tabHasName)(activeTabConfig)) pathSegments.push(activeTabConfig.name);
            return {
                ...field,
                path: (0, _createNestedFieldPath.createNestedFieldPath)(pathSegments.join('.'), field)
            };
        }),
        fieldTypes: fieldTypes,
        forceRender: forceRender,
        indexPath: indexPath,
        key: activeTabConfig.label ? (0, _getTranslation.getTranslation)(activeTabConfig.label, i18n) : activeTabConfig['name'],
        margins: "small",
        permissions: (0, _types.tabHasName)(activeTabConfig) && permissions?.[activeTabConfig.name] ? permissions[activeTabConfig.name].fields : permissions,
        readOnly: readOnly
    }))))));
};
const _default = (0, _withCondition.default)(TabsField);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL2Zvcm1zL2ZpZWxkLXR5cGVzL1RhYnMvaW5kZXgudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgdXNlVHJhbnNsYXRpb24gfSBmcm9tICdyZWFjdC1pMThuZXh0J1xuXG5pbXBvcnQgdHlwZSB7IFRhYiB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2ZpZWxkcy9jb25maWcvdHlwZXMnXG5pbXBvcnQgdHlwZSB7IERvY3VtZW50UHJlZmVyZW5jZXMgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9wcmVmZXJlbmNlcy90eXBlcydcbmltcG9ydCB0eXBlIHsgUHJvcHMgfSBmcm9tICcuL3R5cGVzJ1xuXG5pbXBvcnQgeyB0YWJIYXNOYW1lIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vZmllbGRzL2NvbmZpZy90eXBlcydcbmltcG9ydCB7IGdldFRyYW5zbGF0aW9uIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vdXRpbGl0aWVzL2dldFRyYW5zbGF0aW9uJ1xuaW1wb3J0IHRvS2ViYWJDYXNlIGZyb20gJy4uLy4uLy4uLy4uLy4uL3V0aWxpdGllcy90b0tlYmFiQ2FzZSdcbmltcG9ydCB7IHVzZUNvbGxhcHNpYmxlIH0gZnJvbSAnLi4vLi4vLi4vZWxlbWVudHMvQ29sbGFwc2libGUvcHJvdmlkZXInXG5pbXBvcnQgeyBFcnJvclBpbGwgfSBmcm9tICcuLi8uLi8uLi9lbGVtZW50cy9FcnJvclBpbGwnXG5pbXBvcnQgeyB1c2VEb2N1bWVudEluZm8gfSBmcm9tICcuLi8uLi8uLi91dGlsaXRpZXMvRG9jdW1lbnRJbmZvJ1xuaW1wb3J0IHsgdXNlUHJlZmVyZW5jZXMgfSBmcm9tICcuLi8uLi8uLi91dGlsaXRpZXMvUHJlZmVyZW5jZXMnXG5pbXBvcnQgRmllbGREZXNjcmlwdGlvbiBmcm9tICcuLi8uLi9GaWVsZERlc2NyaXB0aW9uJ1xuaW1wb3J0IHsgdXNlRm9ybVN1Ym1pdHRlZCB9IGZyb20gJy4uLy4uL0Zvcm0vY29udGV4dCdcbmltcG9ydCB7IGNyZWF0ZU5lc3RlZEZpZWxkUGF0aCB9IGZyb20gJy4uLy4uL0Zvcm0vY3JlYXRlTmVzdGVkRmllbGRQYXRoJ1xuaW1wb3J0IFJlbmRlckZpZWxkcyBmcm9tICcuLi8uLi9SZW5kZXJGaWVsZHMnXG5pbXBvcnQgeyBXYXRjaENoaWxkRXJyb3JzIH0gZnJvbSAnLi4vLi4vV2F0Y2hDaGlsZEVycm9ycydcbmltcG9ydCB3aXRoQ29uZGl0aW9uIGZyb20gJy4uLy4uL3dpdGhDb25kaXRpb24nXG5pbXBvcnQgeyBmaWVsZEJhc2VDbGFzcyB9IGZyb20gJy4uL3NoYXJlZCdcbmltcG9ydCAnLi9pbmRleC5zY3NzJ1xuaW1wb3J0IHsgVGFic1Byb3ZpZGVyIH0gZnJvbSAnLi9wcm92aWRlcidcblxuY29uc3QgYmFzZUNsYXNzID0gJ3RhYnMtZmllbGQnXG5cbnR5cGUgVGFiUHJvcHMgPSB7XG4gIGlzQWN0aXZlPzogYm9vbGVhblxuICBwYXJlbnRQYXRoOiBzdHJpbmdcbiAgc2V0SXNBY3RpdmU6ICgpID0+IHZvaWRcbiAgdGFiOiBUYWJcbn1cblxuY29uc3QgVGFiQ29tcG9uZW50OiBSZWFjdC5GQzxUYWJQcm9wcz4gPSAoeyBpc0FjdGl2ZSwgcGFyZW50UGF0aCwgc2V0SXNBY3RpdmUsIHRhYiB9KSA9PiB7XG4gIGNvbnN0IHsgaTE4biB9ID0gdXNlVHJhbnNsYXRpb24oKVxuICBjb25zdCBbZXJyb3JDb3VudCwgc2V0RXJyb3JDb3VudF0gPSB1c2VTdGF0ZSh1bmRlZmluZWQpXG4gIGNvbnN0IGhhc05hbWUgPSB0YWJIYXNOYW1lKHRhYilcbiAgY29uc3Qgc3VibWl0dGVkID0gdXNlRm9ybVN1Ym1pdHRlZCgpXG5cbiAgY29uc3QgcGF0aFNlZ21lbnRzID0gW11cbiAgaWYgKHBhcmVudFBhdGgpIHBhdGhTZWdtZW50cy5wdXNoKHBhcmVudFBhdGgpXG4gIGlmIChoYXNOYW1lKSBwYXRoU2VnbWVudHMucHVzaCh0YWIubmFtZSlcbiAgY29uc3QgcGF0aCA9IHBhdGhTZWdtZW50cy5qb2luKCcuJylcbiAgY29uc3QgdGFiSGFzRXJyb3JzID0gc3VibWl0dGVkICYmIGVycm9yQ291bnQgPiAwXG5cbiAgcmV0dXJuIChcbiAgICA8UmVhY3QuRnJhZ21lbnQ+XG4gICAgICA8V2F0Y2hDaGlsZEVycm9yc1xuICAgICAgICBmaWVsZFNjaGVtYT17aGFzTmFtZSA/IHVuZGVmaW5lZCA6IHRhYi5maWVsZHN9XG4gICAgICAgIHBhdGg9e3BhdGh9XG4gICAgICAgIHNldEVycm9yQ291bnQ9e3NldEVycm9yQ291bnR9XG4gICAgICAvPlxuICAgICAgPGJ1dHRvblxuICAgICAgICBjbGFzc05hbWU9e1tcbiAgICAgICAgICBgJHtiYXNlQ2xhc3N9X190YWItYnV0dG9uYCxcbiAgICAgICAgICB0YWJIYXNFcnJvcnMgJiYgYCR7YmFzZUNsYXNzfV9fdGFiLWJ1dHRvbi0taGFzLWVycm9yYCxcbiAgICAgICAgICBpc0FjdGl2ZSAmJiBgJHtiYXNlQ2xhc3N9X190YWItYnV0dG9uLS1hY3RpdmVgLFxuICAgICAgICBdXG4gICAgICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgICAgIC5qb2luKCcgJyl9XG4gICAgICAgIG9uQ2xpY2s9e3NldElzQWN0aXZlfVxuICAgICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgID5cbiAgICAgICAge3RhYi5sYWJlbCA/IGdldFRyYW5zbGF0aW9uKHRhYi5sYWJlbCwgaTE4bikgOiBoYXNOYW1lICYmIHRhYi5uYW1lfVxuICAgICAgICB7dGFiSGFzRXJyb3JzICYmIDxFcnJvclBpbGwgY291bnQ9e2Vycm9yQ291bnR9IC8+fVxuICAgICAgPC9idXR0b24+XG4gICAgPC9SZWFjdC5GcmFnbWVudD5cbiAgKVxufVxuXG5jb25zdCBUYWJzRmllbGQ6IFJlYWN0LkZDPFByb3BzPiA9IChwcm9wcykgPT4ge1xuICBjb25zdCB7XG4gICAgYWRtaW46IHsgY2xhc3NOYW1lLCByZWFkT25seSB9LFxuICAgIGZpZWxkVHlwZXMsXG4gICAgZm9yY2VSZW5kZXIgPSBmYWxzZSxcbiAgICBpbmRleFBhdGgsXG4gICAgcGF0aCxcbiAgICBwZXJtaXNzaW9ucyxcbiAgICB0YWJzLFxuICB9ID0gcHJvcHNcblxuICBjb25zdCB7IGdldFByZWZlcmVuY2UsIHNldFByZWZlcmVuY2UgfSA9IHVzZVByZWZlcmVuY2VzKClcbiAgY29uc3QgeyBwcmVmZXJlbmNlc0tleSB9ID0gdXNlRG9jdW1lbnRJbmZvKClcbiAgY29uc3QgeyBpMThuIH0gPSB1c2VUcmFuc2xhdGlvbigpXG5cbiAgY29uc3QgaXNXaXRoaW5Db2xsYXBzaWJsZSA9IHVzZUNvbGxhcHNpYmxlKClcbiAgY29uc3QgW2FjdGl2ZVRhYkluZGV4LCBzZXRBY3RpdmVUYWJJbmRleF0gPSB1c2VTdGF0ZTxudW1iZXI+KDApXG4gIGNvbnN0IHRhYnNQcmVmS2V5ID0gYHRhYnMtJHtpbmRleFBhdGh9YFxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgZ2V0SW5pdGlhbFByZWYgPSBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleGlzdGluZ1ByZWZlcmVuY2VzOiBEb2N1bWVudFByZWZlcmVuY2VzID0gYXdhaXQgZ2V0UHJlZmVyZW5jZShwcmVmZXJlbmNlc0tleSlcbiAgICAgIGNvbnN0IGluaXRpYWxJbmRleCA9IHBhdGhcbiAgICAgICAgPyBleGlzdGluZ1ByZWZlcmVuY2VzPy5maWVsZHM/LltwYXRoXT8udGFiSW5kZXhcbiAgICAgICAgOiBleGlzdGluZ1ByZWZlcmVuY2VzPy5maWVsZHM/Llt0YWJzUHJlZktleV0/LnRhYkluZGV4XG4gICAgICBzZXRBY3RpdmVUYWJJbmRleChpbml0aWFsSW5kZXggfHwgMClcbiAgICB9XG4gICAgdm9pZCBnZXRJbml0aWFsUHJlZigpXG4gIH0sIFtwYXRoLCBpbmRleFBhdGgsIGdldFByZWZlcmVuY2UsIHByZWZlcmVuY2VzS2V5LCB0YWJzUHJlZktleV0pXG5cbiAgY29uc3QgaGFuZGxlVGFiQ2hhbmdlID0gdXNlQ2FsbGJhY2soXG4gICAgYXN5bmMgKGluY29taW5nVGFiSW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgc2V0QWN0aXZlVGFiSW5kZXgoaW5jb21pbmdUYWJJbmRleClcblxuICAgICAgY29uc3QgZXhpc3RpbmdQcmVmZXJlbmNlczogRG9jdW1lbnRQcmVmZXJlbmNlcyA9IGF3YWl0IGdldFByZWZlcmVuY2UocHJlZmVyZW5jZXNLZXkpXG5cbiAgICAgIHNldFByZWZlcmVuY2UocHJlZmVyZW5jZXNLZXksIHtcbiAgICAgICAgLi4uZXhpc3RpbmdQcmVmZXJlbmNlcyxcbiAgICAgICAgLi4uKHBhdGhcbiAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICAgICAgLi4uKGV4aXN0aW5nUHJlZmVyZW5jZXM/LmZpZWxkcyB8fCB7fSksXG4gICAgICAgICAgICAgICAgW3BhdGhdOiB7XG4gICAgICAgICAgICAgICAgICAuLi5leGlzdGluZ1ByZWZlcmVuY2VzPy5maWVsZHM/LltwYXRoXSxcbiAgICAgICAgICAgICAgICAgIHRhYkluZGV4OiBpbmNvbWluZ1RhYkluZGV4LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiB7XG4gICAgICAgICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAgICAgIC4uLmV4aXN0aW5nUHJlZmVyZW5jZXM/LmZpZWxkcyxcbiAgICAgICAgICAgICAgICBbdGFic1ByZWZLZXldOiB7XG4gICAgICAgICAgICAgICAgICAuLi5leGlzdGluZ1ByZWZlcmVuY2VzPy5maWVsZHM/Llt0YWJzUHJlZktleV0sXG4gICAgICAgICAgICAgICAgICB0YWJJbmRleDogaW5jb21pbmdUYWJJbmRleCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSksXG4gICAgICB9KVxuICAgIH0sXG4gICAgW3ByZWZlcmVuY2VzS2V5LCBnZXRQcmVmZXJlbmNlLCBzZXRQcmVmZXJlbmNlLCBwYXRoLCB0YWJzUHJlZktleV0sXG4gIClcblxuICBjb25zdCBhY3RpdmVUYWJDb25maWcgPSB0YWJzW2FjdGl2ZVRhYkluZGV4XVxuXG4gIHJldHVybiAoXG4gICAgPGRpdlxuICAgICAgY2xhc3NOYW1lPXtbXG4gICAgICAgIGZpZWxkQmFzZUNsYXNzLFxuICAgICAgICBjbGFzc05hbWUsXG4gICAgICAgIGJhc2VDbGFzcyxcbiAgICAgICAgaXNXaXRoaW5Db2xsYXBzaWJsZSAmJiBgJHtiYXNlQ2xhc3N9LS13aXRoaW4tY29sbGFwc2libGVgLFxuICAgICAgXVxuICAgICAgICAuZmlsdGVyKEJvb2xlYW4pXG4gICAgICAgIC5qb2luKCcgJyl9XG4gICAgPlxuICAgICAgPFRhYnNQcm92aWRlcj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX3RhYnMtd3JhcGB9PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X190YWJzYH0+XG4gICAgICAgICAgICB7dGFicy5tYXAoKHRhYiwgdGFiSW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICA8VGFiQ29tcG9uZW50XG4gICAgICAgICAgICAgICAgICBpc0FjdGl2ZT17YWN0aXZlVGFiSW5kZXggPT09IHRhYkluZGV4fVxuICAgICAgICAgICAgICAgICAga2V5PXt0YWJJbmRleH1cbiAgICAgICAgICAgICAgICAgIHBhcmVudFBhdGg9e3BhdGh9XG4gICAgICAgICAgICAgICAgICBzZXRJc0FjdGl2ZT17KCkgPT4gaGFuZGxlVGFiQ2hhbmdlKHRhYkluZGV4KX1cbiAgICAgICAgICAgICAgICAgIHRhYj17dGFifVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH0pfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e2Ake2Jhc2VDbGFzc31fX2NvbnRlbnQtd3JhcGB9PlxuICAgICAgICAgIHthY3RpdmVUYWJDb25maWcgJiYgKFxuICAgICAgICAgICAgPFJlYWN0LkZyYWdtZW50PlxuICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtbXG4gICAgICAgICAgICAgICAgICBgJHtiYXNlQ2xhc3N9X190YWJgLFxuICAgICAgICAgICAgICAgICAgYWN0aXZlVGFiQ29uZmlnLmxhYmVsICYmXG4gICAgICAgICAgICAgICAgICAgIGAke2Jhc2VDbGFzc31fX3RhYkNvbmZpZ0xhYmVsLSR7dG9LZWJhYkNhc2UoXG4gICAgICAgICAgICAgICAgICAgICAgZ2V0VHJhbnNsYXRpb24oYWN0aXZlVGFiQ29uZmlnLmxhYmVsLCBpMThuKSxcbiAgICAgICAgICAgICAgICAgICAgKX1gLFxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICAgICAgICAgICAgIC5qb2luKCcgJyl9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8RmllbGREZXNjcmlwdGlvblxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgJHtiYXNlQ2xhc3N9X19kZXNjcmlwdGlvbmB9XG4gICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj17YWN0aXZlVGFiQ29uZmlnLmRlc2NyaXB0aW9ufVxuICAgICAgICAgICAgICAgICAgbWFyZ2luUGxhY2VtZW50PVwiYm90dG9tXCJcbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDxSZW5kZXJGaWVsZHNcbiAgICAgICAgICAgICAgICAgIGZpZWxkU2NoZW1hPXthY3RpdmVUYWJDb25maWcuZmllbGRzLm1hcCgoZmllbGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGF0aFNlZ21lbnRzID0gW11cblxuICAgICAgICAgICAgICAgICAgICBpZiAocGF0aCkgcGF0aFNlZ21lbnRzLnB1c2gocGF0aClcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhYkhhc05hbWUoYWN0aXZlVGFiQ29uZmlnKSkgcGF0aFNlZ21lbnRzLnB1c2goYWN0aXZlVGFiQ29uZmlnLm5hbWUpXG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAuLi5maWVsZCxcbiAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBjcmVhdGVOZXN0ZWRGaWVsZFBhdGgocGF0aFNlZ21lbnRzLmpvaW4oJy4nKSwgZmllbGQpLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgICAgICAgIGZpZWxkVHlwZXM9e2ZpZWxkVHlwZXN9XG4gICAgICAgICAgICAgICAgICBmb3JjZVJlbmRlcj17Zm9yY2VSZW5kZXJ9XG4gICAgICAgICAgICAgICAgICBpbmRleFBhdGg9e2luZGV4UGF0aH1cbiAgICAgICAgICAgICAgICAgIGtleT17XG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhYkNvbmZpZy5sYWJlbFxuICAgICAgICAgICAgICAgICAgICAgID8gZ2V0VHJhbnNsYXRpb24oYWN0aXZlVGFiQ29uZmlnLmxhYmVsLCBpMThuKVxuICAgICAgICAgICAgICAgICAgICAgIDogYWN0aXZlVGFiQ29uZmlnWyduYW1lJ11cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIG1hcmdpbnM9XCJzbWFsbFwiXG4gICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucz17XG4gICAgICAgICAgICAgICAgICAgIHRhYkhhc05hbWUoYWN0aXZlVGFiQ29uZmlnKSAmJiBwZXJtaXNzaW9ucz8uW2FjdGl2ZVRhYkNvbmZpZy5uYW1lXVxuICAgICAgICAgICAgICAgICAgICAgID8gcGVybWlzc2lvbnNbYWN0aXZlVGFiQ29uZmlnLm5hbWVdLmZpZWxkc1xuICAgICAgICAgICAgICAgICAgICAgIDogcGVybWlzc2lvbnNcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHJlYWRPbmx5PXtyZWFkT25seX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvUmVhY3QuRnJhZ21lbnQ+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L1RhYnNQcm92aWRlcj5cbiAgICA8L2Rpdj5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCB3aXRoQ29uZGl0aW9uKFRhYnNGaWVsZClcbiJdLCJuYW1lcyI6WyJiYXNlQ2xhc3MiLCJUYWJDb21wb25lbnQiLCJpc0FjdGl2ZSIsInBhcmVudFBhdGgiLCJzZXRJc0FjdGl2ZSIsInRhYiIsImkxOG4iLCJ1c2VUcmFuc2xhdGlvbiIsImVycm9yQ291bnQiLCJzZXRFcnJvckNvdW50IiwidXNlU3RhdGUiLCJ1bmRlZmluZWQiLCJoYXNOYW1lIiwidGFiSGFzTmFtZSIsInN1Ym1pdHRlZCIsInVzZUZvcm1TdWJtaXR0ZWQiLCJwYXRoU2VnbWVudHMiLCJwdXNoIiwibmFtZSIsInBhdGgiLCJqb2luIiwidGFiSGFzRXJyb3JzIiwiUmVhY3QiLCJGcmFnbWVudCIsIldhdGNoQ2hpbGRFcnJvcnMiLCJmaWVsZFNjaGVtYSIsImZpZWxkcyIsImJ1dHRvbiIsImNsYXNzTmFtZSIsImZpbHRlciIsIkJvb2xlYW4iLCJvbkNsaWNrIiwidHlwZSIsImxhYmVsIiwiZ2V0VHJhbnNsYXRpb24iLCJFcnJvclBpbGwiLCJjb3VudCIsIlRhYnNGaWVsZCIsInByb3BzIiwiYWRtaW4iLCJyZWFkT25seSIsImZpZWxkVHlwZXMiLCJmb3JjZVJlbmRlciIsImluZGV4UGF0aCIsInBlcm1pc3Npb25zIiwidGFicyIsImdldFByZWZlcmVuY2UiLCJzZXRQcmVmZXJlbmNlIiwidXNlUHJlZmVyZW5jZXMiLCJwcmVmZXJlbmNlc0tleSIsInVzZURvY3VtZW50SW5mbyIsImlzV2l0aGluQ29sbGFwc2libGUiLCJ1c2VDb2xsYXBzaWJsZSIsImFjdGl2ZVRhYkluZGV4Iiwic2V0QWN0aXZlVGFiSW5kZXgiLCJ0YWJzUHJlZktleSIsInVzZUVmZmVjdCIsImdldEluaXRpYWxQcmVmIiwiZXhpc3RpbmdQcmVmZXJlbmNlcyIsImluaXRpYWxJbmRleCIsInRhYkluZGV4IiwiaGFuZGxlVGFiQ2hhbmdlIiwidXNlQ2FsbGJhY2siLCJpbmNvbWluZ1RhYkluZGV4IiwiYWN0aXZlVGFiQ29uZmlnIiwiZGl2IiwiZmllbGRCYXNlQ2xhc3MiLCJUYWJzUHJvdmlkZXIiLCJtYXAiLCJrZXkiLCJ0b0tlYmFiQ2FzZSIsIkZpZWxkRGVzY3JpcHRpb24iLCJkZXNjcmlwdGlvbiIsIm1hcmdpblBsYWNlbWVudCIsIlJlbmRlckZpZWxkcyIsImZpZWxkIiwiY3JlYXRlTmVzdGVkRmllbGRQYXRoIiwibWFyZ2lucyIsIndpdGhDb25kaXRpb24iXSwibWFwcGluZ3MiOiI7Ozs7K0JBeU5BOzs7ZUFBQTs7OytEQXpOd0Q7OEJBQ3pCO3VCQU1KO2dDQUNJO29FQUNQOzBCQUNPOzJCQUNMOzhCQUNNOzZCQUNEO3lFQUNGO3lCQUNJO3VDQUNLO3FFQUNiO2tDQUNRO3NFQUNQO3dCQUNLO1FBQ3hCOzJCQUNzQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRTdCLE1BQU1BLFlBQVk7QUFTbEIsTUFBTUMsZUFBbUMsQ0FBQyxFQUFFQyxRQUFRLEVBQUVDLFVBQVUsRUFBRUMsV0FBVyxFQUFFQyxHQUFHLEVBQUU7SUFDbEYsTUFBTSxFQUFFQyxJQUFJLEVBQUUsR0FBR0MsSUFBQUEsNEJBQWM7SUFDL0IsTUFBTSxDQUFDQyxZQUFZQyxjQUFjLEdBQUdDLElBQUFBLGVBQVEsRUFBQ0M7SUFDN0MsTUFBTUMsVUFBVUMsSUFBQUEsaUJBQVUsRUFBQ1I7SUFDM0IsTUFBTVMsWUFBWUMsSUFBQUEseUJBQWdCO0lBRWxDLE1BQU1D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