/* eslint-disable no-param-reassign */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "addFieldStatePromise", {
    enumerable: true,
    get: function() {
        return addFieldStatePromise;
    }
});
const _bsonobjectid = /*#__PURE__*/ _interop_require_default(require("bson-objectid"));
const _types = require("../../../../../fields/config/types");
const _getDefaultValue = /*#__PURE__*/ _interop_require_default(require("../../../../../fields/getDefaultValue"));
const _iterateFields = require("./iterateFields");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const addFieldStatePromise = async ({ id, config, data, field, fullData, locale, operation, passesCondition, path, preferences, state, t, user })=>{
    if ((0, _types.fieldAffectsData)(field)) {
        const fieldState = {
            condition: field.admin?.condition,
            initialValue: undefined,
            passesCondition,
            valid: true,
            validate: field.validate,
            value: undefined
        };
        const valueWithDefault = await (0, _getDefaultValue.default)({
            defaultValue: field.defaultValue,
            locale,
            user,
            value: data?.[field.name]
        });
        if (data?.[field.name]) {
            data[field.name] = valueWithDefault;
        }
        let validationResult = true;
        if (typeof fieldState.validate === 'function') {
            validationResult = await fieldState.validate(data?.[field.name], {
                ...field,
                id,
                config,
                data: fullData,
                operation,
                siblingData: data,
                t,
                user
            });
        }
        if (typeof validationResult === 'string') {
            fieldState.errorMessage = validationResult;
            fieldState.valid = false;
        } else {
            fieldState.valid = true;
        }
        switch(field.type){
            case 'array':
                {
                    const arrayValue = Array.isArray(valueWithDefault) ? valueWithDefault : [];
                    const { promises, rowMetadata } = arrayValue.reduce((acc, row, i)=>{
                        const rowPath = `${path}${field.name}.${i}.`;
                        row.id = row?.id || new _bsonobjectid.default().toHexString();
                        state[`${rowPath}id`] = {
                            initialValue: row.id,
                            valid: true,
                            value: row.id
                        };
                        acc.promises.push((0, _iterateFields.iterateFields)({
                            id,
                            config,
                            data: row,
                            fields: field.fields,
                            fullData,
                            locale,
                            operation,
                            parentPassesCondition: passesCondition,
                            path: rowPath,
                            preferences,
                            state,
                            t,
                            user
                        }));
                        const collapsedRowIDs = preferences?.fields?.[`${path}${field.name}`]?.collapsed;
                        acc.rowMetadata.push({
                            id: row.id,
                            childErrorPaths: new Set(),
                            collapsed: collapsedRowIDs === undefined ? field.admin.initCollapsed : collapsedRowIDs.includes(row.id)
                        });
                        return acc;
                    }, {
                        promises: [],
                        rowMetadata: []
                    });
                    await Promise.all(promises);
                    // Add values to field state
                    if (valueWithDefault === null) {
                        fieldState.value = null;
                        fieldState.initialValue = null;
                    } else {
                        fieldState.value = arrayValue.length;
                        fieldState.initialValue = arrayValue.length;
                        if (arrayValue.length > 0) {
                            fieldState.disableFormData = true;
                        }
                    }
                    fieldState.rows = rowMetadata;
                    // Add field to state
                    state[`${path}${field.name}`] = fieldState;
                    break;
                }
            case 'blocks':
                {
                    const blocksValue = Array.isArray(valueWithDefault) ? valueWithDefault : [];
                    const { promises, rowMetadata } = blocksValue.reduce((acc, row, i)=>{
                        const block = field.blocks.find((blockType)=>blockType.slug === row.blockType);
                        const rowPath = `${path}${field.name}.${i}.`;
                        if (block) {
                            row.id = row?.id || new _bsonobjectid.default().toHexString();
                            state[`${rowPath}id`] = {
                                initialValue: row.id,
                                valid: true,
                                value: row.id
                            };
                            state[`${rowPath}blockType`] = {
                                initialValue: row.blockType,
                                valid: true,
                                value: row.blockType
                            };
                            state[`${rowPath}blockName`] = {
                                initialValue: row.blockName,
                                valid: true,
                                value: row.blockName
                            };
                            acc.promises.push((0, _iterateFields.iterateFields)({
                                id,
                                config,
                                data: row,
                                fields: block.fields,
                                fullData,
                                locale,
                                operation,
                                parentPassesCondition: passesCondition,
                                path: rowPath,
                                preferences,
                                state,
                                t,
                                user
                            }));
                            const collapsedRowIDs = preferences?.fields?.[`${path}${field.name}`]?.collapsed;
                            acc.rowMetadata.push({
                                id: row.id,
                                blockType: row.blockType,
                                childErrorPaths: new Set(),
                                collapsed: collapsedRowIDs === undefined ? field.admin.initCollapsed : collapsedRowIDs.includes(row.id)
                            });
                        }
                        return acc;
                    }, {
                        promises: [],
                        rowMetadata: []
                    });
                    await Promise.all(promises);
                    // Add values to field state
                    if (valueWithDefault === null) {
                        fieldState.value = null;
                        fieldState.initialValue = null;
                    } else {
                        fieldState.value = blocksValue.length;
                        fieldState.initialValue = blocksValue.length;
                        if (blocksValue.length > 0) {
                            fieldState.disableFormData = true;
                        }
                    }
                    fieldState.rows = rowMetadata;
                    // Add field to state
                    state[`${path}${field.name}`] = fieldState;
                    break;
                }
            case 'group':
                {
                    await (0, _iterateFields.iterateFields)({
                        id,
                        config,
                        data: data?.[field.name] || {},
                        fields: field.fields,
                        fullData,
                        locale,
                        operation,
                        parentPassesCondition: passesCondition,
                        path: `${path}${field.name}.`,
                        preferences,
                        state,
                        t,
                        user
                    });
                    break;
                }
            case 'relationship':
                {
                    if (field.hasMany) {
                        const relationshipValue = Array.isArray(valueWithDefault) ? valueWithDefault.map((relationship)=>{
                            if (Array.isArray(field.relationTo)) {
                                return {
                                    relationTo: relationship.relationTo,
                                    value: relationship.value && typeof relationship.value === 'object' ? relationship.value?.id : relationship.value
                                };
                            }
                            if (typeof relationship === 'object' && relationship !== null) {
                                return relationship.id;
                            }
                            return relationship;
                        }) : undefined;
                        fieldState.value = relationshipValue;
                        fieldState.initialValue = relationshipValue;
                    } else if (Array.isArray(field.relationTo)) {
                        if (valueWithDefault && typeof valueWithDefault === 'object' && 'relationTo' in valueWithDefault && 'value' in valueWithDefault) {
                            const value = typeof valueWithDefault?.value === 'object' && valueWithDefault?.value && 'id' in valueWithDefault.value ? valueWithDefault.value.id : valueWithDefault.value;
                            const relationshipValue = {
                                relationTo: valueWithDefault?.relationTo,
                                value
                            };
                            fieldState.value = relationshipValue;
                            fieldState.initialValue = relationshipValue;
                        }
                    } else {
                        const relationshipValue = valueWithDefault && typeof valueWithDefault === 'object' && 'id' in valueWithDefault ? valueWithDefault.id : valueWithDefault;
                        fieldState.value = relationshipValue;
                        fieldState.initialValue = relationshipValue;
                    }
                    state[`${path}${field.name}`] = fieldState;
                    break;
                }
            case 'upload':
                {
                    const relationshipValue = valueWithDefault && typeof valueWithDefault === 'object' && 'id' in valueWithDefault ? valueWithDefault.id : valueWithDefault;
                    fieldState.value = relationshipValue;
                    fieldState.initialValue = relationshipValue;
                    state[`${path}${field.name}`] = fieldState;
                    break;
                }
            default:
                {
                    fieldState.value = valueWithDefault;
                    fieldState.initialValue = valueWithDefault;
                    // Add field to state
                    state[`${path}${field.name}`] = fieldState;
                    break;
                }
        }
    } else if ((0, _types.fieldHasSubFields)(field)) {
        // Handle field types that do not use names (row, etc)
        await (0, _iterateFields.iterateFields)({
            id,
            config,
            data,
            fields: field.fields,
            fullData,
            locale,
            operation,
            parentPassesCondition: passesCondition,
            path,
            preferences,
            state,
            t,
            user
        });
    } else if (field.type === 'tabs') {
        const promises = field.tabs.map((tab)=>(0, _iterateFields.iterateFields)({
                id,
                config,
                data: (0, _types.tabHasName)(tab) ? data?.[tab.name] : data,
                fields: tab.fields,
                fullData,
                locale,
                operation,
                parentPassesCondition: passesCondition,
                path: (0, _types.tabHasName)(tab) ? `${path}${tab.name}.` : path,
                preferences,
                state,
                t,
                user
            }));
        await Promise.all(promises);
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9hZG1pbi9jb21wb25lbnRzL2Zvcm1zL0Zvcm0vYnVpbGRTdGF0ZUZyb21TY2hlbWEvYWRkRmllbGRTdGF0ZVByb21pc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbmltcG9ydCB0eXBlIHsgVEZ1bmN0aW9uIH0gZnJvbSAnaTE4bmV4dCdcblxuaW1wb3J0IE9iamVjdElEIGZyb20gJ2Jzb24tb2JqZWN0aWQnXG5cbmltcG9ydCB0eXBlIHsgVXNlciB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2F1dGgnXG5pbXBvcnQgdHlwZSB7IFNhbml0aXplZENvbmZpZyB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2NvbmZpZy90eXBlcydcbmltcG9ydCB0eXBlIHsgTm9uUHJlc2VudGF0aW9uYWxGaWVsZCB9IGZyb20gJy4uLy4uLy4uLy4uLy4uL2ZpZWxkcy9jb25maWcvdHlwZXMnXG5pbXBvcnQgdHlwZSB7IERhdGEsIEZpZWxkcywgRm9ybUZpZWxkIH0gZnJvbSAnLi4vdHlwZXMnXG5cbmltcG9ydCB7IGZpZWxkQWZmZWN0c0RhdGEsIGZpZWxkSGFzU3ViRmllbGRzLCB0YWJIYXNOYW1lIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vZmllbGRzL2NvbmZpZy90eXBlcydcbmltcG9ydCBnZXRWYWx1ZVdpdGhEZWZhdWx0IGZyb20gJy4uLy4uLy4uLy4uLy4uL2ZpZWxkcy9nZXREZWZhdWx0VmFsdWUnXG5pbXBvcnQgeyBpdGVyYXRlRmllbGRzIH0gZnJvbSAnLi9pdGVyYXRlRmllbGRzJ1xuXG50eXBlIEFyZ3MgPSB7XG4gIGNvbmZpZzogU2FuaXRpemVkQ29uZmlnXG4gIGRhdGE6IERhdGFcbiAgZmllbGQ6IE5vblByZXNlbnRhdGlvbmFsRmllbGRcbiAgZnVsbERhdGE6IERhdGFcbiAgaWQ6IG51bWJlciB8IHN0cmluZ1xuICBsb2NhbGU6IHN0cmluZ1xuICBvcGVyYXRpb246ICdjcmVhdGUnIHwgJ3VwZGF0ZSdcbiAgcGFzc2VzQ29uZGl0aW9uOiBib29sZWFuXG4gIHBhdGg6IHN0cmluZ1xuICBwcmVmZXJlbmNlczoge1xuICAgIFtrZXk6IHN0cmluZ106IHVua25vd25cbiAgfVxuICBzdGF0ZTogRmllbGRzXG4gIHQ6IFRGdW5jdGlvblxuICB1c2VyOiBVc2VyXG59XG5cbmV4cG9ydCBjb25zdCBhZGRGaWVsZFN0YXRlUHJvbWlzZSA9IGFzeW5jICh7XG4gIGlkLFxuICBjb25maWcsXG4gIGRhdGEsXG4gIGZpZWxkLFxuICBmdWxsRGF0YSxcbiAgbG9jYWxlLFxuICBvcGVyYXRpb24sXG4gIHBhc3Nlc0NvbmRpdGlvbixcbiAgcGF0aCxcbiAgcHJlZmVyZW5jZXMsXG4gIHN0YXRlLFxuICB0LFxuICB1c2VyLFxufTogQXJncyk6IFByb21pc2U8dm9pZD4gPT4ge1xuICBpZiAoZmllbGRBZmZlY3RzRGF0YShmaWVsZCkpIHtcbiAgICBjb25zdCBmaWVsZFN0YXRlOiBGb3JtRmllbGQgPSB7XG4gICAgICBjb25kaXRpb246IGZpZWxkLmFkbWluPy5jb25kaXRpb24sXG4gICAgICBpbml0aWFsVmFsdWU6IHVuZGVmaW5lZCxcbiAgICAgIHBhc3Nlc0NvbmRpdGlvbixcbiAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgdmFsaWRhdGU6IGZpZWxkLnZhbGlkYXRlLFxuICAgICAgdmFsdWU6IHVuZGVmaW5lZCxcbiAgICB9XG5cbiAgICBjb25zdCB2YWx1ZVdpdGhEZWZhdWx0ID0gYXdhaXQgZ2V0VmFsdWVXaXRoRGVmYXVsdCh7XG4gICAgICBkZWZhdWx0VmFsdWU6IGZpZWxkLmRlZmF1bHRWYWx1ZSxcbiAgICAgIGxvY2FsZSxcbiAgICAgIHVzZXIsXG4gICAgICB2YWx1ZTogZGF0YT8uW2ZpZWxkLm5hbWVdLFxuICAgIH0pXG5cbiAgICBpZiAoZGF0YT8uW2ZpZWxkLm5hbWVdKSB7XG4gICAgICBkYXRhW2ZpZWxkLm5hbWVdID0gdmFsdWVXaXRoRGVmYXVsdFxuICAgIH1cblxuICAgIGxldCB2YWxpZGF0aW9uUmVzdWx0OiBib29sZWFuIHwgc3RyaW5nID0gdHJ1ZVxuXG4gICAgaWYgKHR5cGVvZiBmaWVsZFN0YXRlLnZhbGlkYXRlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB2YWxpZGF0aW9uUmVzdWx0ID0gYXdhaXQgZmllbGRTdGF0ZS52YWxpZGF0ZShkYXRhPy5bZmllbGQubmFtZV0sIHtcbiAgICAgICAgLi4uZmllbGQsXG4gICAgICAgIGlkLFxuICAgICAgICBjb25maWcsXG4gICAgICAgIGRhdGE6IGZ1bGxEYXRhLFxuICAgICAgICBvcGVyYXRpb24sXG4gICAgICAgIHNpYmxpbmdEYXRhOiBkYXRhLFxuICAgICAgICB0LFxuICAgICAgICB1c2VyLFxuICAgICAgfSlcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHZhbGlkYXRpb25SZXN1bHQgPT09ICdzdHJpbmcnKSB7XG4gICAgICBmaWVsZFN0YXRlLmVycm9yTWVzc2FnZSA9IHZhbGlkYXRpb25SZXN1bHRcbiAgICAgIGZpZWxkU3RhdGUudmFsaWQgPSBmYWxzZVxuICAgIH0gZWxzZSB7XG4gICAgICBmaWVsZFN0YXRlLnZhbGlkID0gdHJ1ZVxuICAgIH1cblxuICAgIHN3aXRjaCAoZmllbGQudHlwZSkge1xuICAgICAgY2FzZSAnYXJyYXknOiB7XG4gICAgICAgIGNvbnN0IGFycmF5VmFsdWUgPSBBcnJheS5pc0FycmF5KHZhbHVlV2l0aERlZmF1bHQpID8gdmFsdWVXaXRoRGVmYXVsdCA6IFtdXG4gICAgICAgIGNvbnN0IHsgcHJvbWlzZXMsIHJvd01ldGFkYXRhIH0gPSBhcnJheVZhbHVlLnJlZHVjZShcbiAgICAgICAgICAoYWNjLCByb3csIGkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJvd1BhdGggPSBgJHtwYXRofSR7ZmllbGQubmFtZX0uJHtpfS5gXG4gICAgICAgICAgICByb3cuaWQgPSByb3c/LmlkIHx8IG5ldyBPYmplY3RJRCgpLnRvSGV4U3RyaW5nKClcblxuICAgICAgICAgICAgc3RhdGVbYCR7cm93UGF0aH1pZGBdID0ge1xuICAgICAgICAgICAgICBpbml0aWFsVmFsdWU6IHJvdy5pZCxcbiAgICAgICAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgICAgICAgIHZhbHVlOiByb3cuaWQsXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFjYy5wcm9taXNlcy5wdXNoKFxuICAgICAgICAgICAgICBpdGVyYXRlRmllbGRzKHtcbiAgICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICAgICAgZGF0YTogcm93LFxuICAgICAgICAgICAgICAgIGZpZWxkczogZmllbGQuZmllbGRzLFxuICAgICAgICAgICAgICAgIGZ1bGxEYXRhLFxuICAgICAgICAgICAgICAgIGxvY2FsZSxcbiAgICAgICAgICAgICAgICBvcGVyYXRpb24sXG4gICAgICAgICAgICAgICAgcGFyZW50UGFzc2VzQ29uZGl0aW9uOiBwYXNzZXNDb25kaXRpb24sXG4gICAgICAgICAgICAgICAgcGF0aDogcm93UGF0aCxcbiAgICAgICAgICAgICAgICBwcmVmZXJlbmNlcyxcbiAgICAgICAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAgICAgICB0LFxuICAgICAgICAgICAgICAgIHVzZXIsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICBjb25zdCBjb2xsYXBzZWRSb3dJRHMgPSBwcmVmZXJlbmNlcz8uZmllbGRzPy5bYCR7cGF0aH0ke2ZpZWxkLm5hbWV9YF0/LmNvbGxhcHNlZFxuXG4gICAgICAgICAgICBhY2Mucm93TWV0YWRhdGEucHVzaCh7XG4gICAgICAgICAgICAgIGlkOiByb3cuaWQsXG4gICAgICAgICAgICAgIGNoaWxkRXJyb3JQYXRoczogbmV3IFNldCgpLFxuICAgICAgICAgICAgICBjb2xsYXBzZWQ6XG4gICAgICAgICAgICAgICAgY29sbGFwc2VkUm93SURzID09PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgID8gZmllbGQuYWRtaW4uaW5pdENvbGxhcHNlZFxuICAgICAgICAgICAgICAgICAgOiBjb2xsYXBzZWRSb3dJRHMuaW5jbHVkZXMocm93LmlkKSxcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHJldHVybiBhY2NcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb21pc2VzOiBbXSxcbiAgICAgICAgICAgIHJvd01ldGFkYXRhOiBbXSxcbiAgICAgICAgICB9LFxuICAgICAgICApXG5cbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpXG5cbiAgICAgICAgLy8gQWRkIHZhbHVlcyB0byBmaWVsZCBzdGF0ZVxuICAgICAgICBpZiAodmFsdWVXaXRoRGVmYXVsdCA9PT0gbnVsbCkge1xuICAgICAgICAgIGZpZWxkU3RhdGUudmFsdWUgPSBudWxsXG4gICAgICAgICAgZmllbGRTdGF0ZS5pbml0aWFsVmFsdWUgPSBudWxsXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZmllbGRTdGF0ZS52YWx1ZSA9IGFycmF5VmFsdWUubGVuZ3RoXG4gICAgICAgICAgZmllbGRTdGF0ZS5pbml0aWFsVmFsdWUgPSBhcnJheVZhbHVlLmxlbmd0aFxuXG4gICAgICAgICAgaWYgKGFycmF5VmFsdWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZmllbGRTdGF0ZS5kaXNhYmxlRm9ybURhdGEgPSB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZmllbGRTdGF0ZS5yb3dzID0gcm93TWV0YWRhdGFcblxuICAgICAgICAvLyBBZGQgZmllbGQgdG8gc3RhdGVcbiAgICAgICAgc3RhdGVbYCR7cGF0aH0ke2ZpZWxkLm5hbWV9YF0gPSBmaWVsZFN0YXRlXG5cbiAgICAgICAgYnJlYWtcbiAgICAgIH1cblxuICAgICAgY2FzZSAnYmxvY2tzJzoge1xuICAgICAgICBjb25zdCBibG9ja3NWYWx1ZSA9IEFycmF5LmlzQXJyYXkodmFsdWVXaXRoRGVmYXVsdCkgPyB2YWx1ZVdpdGhEZWZhdWx0IDogW11cblxuICAgICAgICBjb25zdCB7IHByb21pc2VzLCByb3dNZXRhZGF0YSB9ID0gYmxvY2tzVmFsdWUucmVkdWNlKFxuICAgICAgICAgIChhY2MsIHJvdywgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmxvY2sgPSBmaWVsZC5ibG9ja3MuZmluZCgoYmxvY2tUeXBlKSA9PiBibG9ja1R5cGUuc2x1ZyA9PT0gcm93LmJsb2NrVHlwZSlcbiAgICAgICAgICAgIGNvbnN0IHJvd1BhdGggPSBgJHtwYXRofSR7ZmllbGQubmFtZX0uJHtpfS5gXG5cbiAgICAgICAgICAgIGlmIChibG9jaykge1xuICAgICAgICAgICAgICByb3cuaWQgPSByb3c/LmlkIHx8IG5ldyBPYmplY3RJRCgpLnRvSGV4U3RyaW5nKClcblxuICAgICAgICAgICAgICBzdGF0ZVtgJHtyb3dQYXRofWlkYF0gPSB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiByb3cuaWQsXG4gICAgICAgICAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHJvdy5pZCxcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHN0YXRlW2Ake3Jvd1BhdGh9YmxvY2tUeXBlYF0gPSB7XG4gICAgICAgICAgICAgICAgaW5pdGlhbFZhbHVlOiByb3cuYmxvY2tUeXBlLFxuICAgICAgICAgICAgICAgIHZhbGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiByb3cuYmxvY2tUeXBlLFxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgc3RhdGVbYCR7cm93UGF0aH1ibG9ja05hbWVgXSA9IHtcbiAgICAgICAgICAgICAgICBpbml0aWFsVmFsdWU6IHJvdy5ibG9ja05hbWUsXG4gICAgICAgICAgICAgICAgdmFsaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHJvdy5ibG9ja05hbWUsXG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBhY2MucHJvbWlzZXMucHVzaChcbiAgICAgICAgICAgICAgICBpdGVyYXRlRmllbGRzKHtcbiAgICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgICAgY29uZmlnLFxuICAgICAgICAgICAgICAgICAgZGF0YTogcm93LFxuICAgICAgICAgICAgICAgICAgZmllbGRzOiBibG9jay5maWVsZHMsXG4gICAgICAgICAgICAgICAgICBmdWxsRGF0YSxcbiAgICAgICAgICAgICAgICAgIGxvY2FsZSxcbiAgICAgICAgICAgICAgICAgIG9wZXJhdGlvbixcbiAgICAgICAgICAgICAgICAgIHBhcmVudFBhc3Nlc0NvbmRpdGlvbjogcGFzc2VzQ29uZGl0aW9uLFxuICAgICAgICAgICAgICAgICAgcGF0aDogcm93UGF0aCxcbiAgICAgICAgICAgICAgICAgIHByZWZlcmVuY2VzLFxuICAgICAgICAgICAgICAgICAgc3RhdGUsXG4gICAgICAgICAgICAgICAgICB0LFxuICAgICAgICAgICAgICAgICAgdXNlcixcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgIGNvbnN0IGNvbGxhcHNlZFJvd0lEcyA9IHByZWZlcmVuY2VzPy5maWVsZHM/LltgJHtwYXRofSR7ZmllbGQubmFtZX1gXT8uY29sbGFwc2VkXG5cbiAgICAgICAgICAgICAgYWNjLnJvd01ldGFkYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgIGlkOiByb3cuaWQsXG4gICAgICAgICAgICAgICAgYmxvY2tUeXBlOiByb3cuYmxvY2tUeXBlLFxuICAgICAgICAgICAgICAgIGNoaWxkRXJyb3JQYXRoczogbmV3IFNldCgpLFxuICAgICAgICAgICAgICAgIGNvbGxhcHNlZDpcbiAgICAgICAgICAgICAgICAgIGNvbGxhcHNlZFJvd0lEcyA9PT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgID8gZmllbGQuYWRtaW4uaW5pdENvbGxhcHNlZFxuICAgICAgICAgICAgICAgICAgICA6IGNvbGxhcHNlZFJvd0lEcy5pbmNsdWRlcyhyb3cuaWQpLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYWNjXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBwcm9taXNlczogW10sXG4gICAgICAgICAgICByb3dNZXRhZGF0YTogW10sXG4gICAgICAgICAgfSxcbiAgICAgICAgKVxuXG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKVxuXG4gICAgICAgIC8vIEFkZCB2YWx1ZXMgdG8gZmllbGQgc3RhdGVcbiAgICAgICAgaWYgKHZhbHVlV2l0aERlZmF1bHQgPT09IG51bGwpIHtcbiAgICAgICAgICBmaWVsZFN0YXRlLnZhbHVlID0gbnVsbFxuICAgICAgICAgIGZpZWxkU3RhdGUuaW5pdGlhbFZhbHVlID0gbnVsbFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZpZWxkU3RhdGUudmFsdWUgPSBibG9ja3NWYWx1ZS5sZW5ndGhcbiAgICAgICAgICBmaWVsZFN0YXRlLmluaXRpYWxWYWx1ZSA9IGJsb2Nrc1ZhbHVlLmxlbmd0aFxuXG4gICAgICAgICAgaWYgKGJsb2Nrc1ZhbHVlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGZpZWxkU3RhdGUuZGlzYWJsZUZvcm1EYXRhID0gdHJ1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZpZWxkU3RhdGUucm93cyA9IHJvd01ldGFkYXRhXG5cbiAgICAgICAgLy8gQWRkIGZpZWxkIHRvIHN0YXRlXG4gICAgICAgIHN0YXRlW2Ake3BhdGh9JHtmaWVsZC5uYW1lfWBdID0gZmllbGRTdGF0ZVxuXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGNhc2UgJ2dyb3VwJzoge1xuICAgICAgICBhd2FpdCBpdGVyYXRlRmllbGRzKHtcbiAgICAgICAgICBpZCxcbiAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgZGF0YTogZGF0YT8uW2ZpZWxkLm5hbWVdIHx8IHt9LFxuICAgICAgICAgIGZpZWxkczogZmllbGQuZmllbGRzLFxuICAgICAgICAgIGZ1bGxEYXRhLFxuICAgICAgICAgIGxvY2FsZSxcbiAgICAgICAgICBvcGVyYXRpb24sXG4gICAgICAgICAgcGFyZW50UGFzc2VzQ29uZGl0aW9uOiBwYXNzZXNDb25kaXRpb24sXG4gICAgICAgICAgcGF0aDogYCR7cGF0aH0ke2ZpZWxkLm5hbWV9LmAsXG4gICAgICAgICAgcHJlZmVyZW5jZXMsXG4gICAgICAgICAgc3RhdGUsXG4gICAgICAgICAgdCxcbiAgICAgICAgICB1c2VyLFxuICAgICAgICB9KVxuXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGNhc2UgJ3JlbGF0aW9uc2hpcCc6IHtcbiAgICAgICAgaWYgKGZpZWxkLmhhc01hbnkpIHtcbiAgICAgICAgICBjb25zdCByZWxhdGlvbnNoaXBWYWx1ZSA9IEFycmF5LmlzQXJyYXkodmFsdWVXaXRoRGVmYXVsdClcbiAgICAgICAgICAgID8gdmFsdWVXaXRoRGVmYXVsdC5tYXAoKHJlbGF0aW9uc2hpcCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGZpZWxkLnJlbGF0aW9uVG8pKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICByZWxhdGlvblRvOiByZWxhdGlvbnNoaXAucmVsYXRpb25UbyxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6XG4gICAgICAgICAgICAgICAgICAgICAgcmVsYXRpb25zaGlwLnZhbHVlICYmIHR5cGVvZiByZWxhdGlvbnNoaXAudmFsdWUgPT09ICdvYmplY3QnXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHJlbGF0aW9uc2hpcC52YWx1ZT8uaWRcbiAgICAgICAgICAgICAgICAgICAgICAgIDogcmVsYXRpb25zaGlwLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlbGF0aW9uc2hpcCA9PT0gJ29iamVjdCcgJiYgcmVsYXRpb25zaGlwICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gcmVsYXRpb25zaGlwLmlkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZWxhdGlvbnNoaXBcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDogdW5kZWZpbmVkXG5cbiAgICAgICAgICBmaWVsZFN0YXRlLnZhbHVlID0gcmVsYXRpb25zaGlwVmFsdWVcbiAgICAgICAgICBmaWVsZFN0YXRlLmluaXRpYWxWYWx1ZSA9IHJlbGF0aW9uc2hpcFZhbHVlXG4gICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShmaWVsZC5yZWxhdGlvblRvKSkge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHZhbHVlV2l0aERlZmF1bHQgJiZcbiAgICAgICAgICAgIHR5cGVvZiB2YWx1ZVdpdGhEZWZhdWx0ID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAgICAgJ3JlbGF0aW9uVG8nIGluIHZhbHVlV2l0aERlZmF1bHQgJiZcbiAgICAgICAgICAgICd2YWx1ZScgaW4gdmFsdWVXaXRoRGVmYXVsdFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPVxuICAgICAgICAgICAgICB0eXBlb2YgdmFsdWVXaXRoRGVmYXVsdD8udmFsdWUgPT09ICdvYmplY3QnICYmXG4gICAgICAgICAgICAgIHZhbHVlV2l0aERlZmF1bHQ/LnZhbHVlICYmXG4gICAgICAgICAgICAgICdpZCcgaW4gdmFsdWVXaXRoRGVmYXVsdC52YWx1ZVxuICAgICAgICAgICAgICAgID8gdmFsdWVXaXRoRGVmYXVsdC52YWx1ZS5pZFxuICAgICAgICAgICAgICAgIDogdmFsdWVXaXRoRGVmYXVsdC52YWx1ZVxuICAgICAgICAgICAgY29uc3QgcmVsYXRpb25zaGlwVmFsdWUgPSB7XG4gICAgICAgICAgICAgIHJlbGF0aW9uVG86IHZhbHVlV2l0aERlZmF1bHQ/LnJlbGF0aW9uVG8sXG4gICAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmllbGRTdGF0ZS52YWx1ZSA9IHJlbGF0aW9uc2hpcFZhbHVlXG4gICAgICAgICAgICBmaWVsZFN0YXRlLmluaXRpYWxWYWx1ZSA9IHJlbGF0aW9uc2hpcFZhbHVlXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IHJlbGF0aW9uc2hpcFZhbHVlID1cbiAgICAgICAgICAgIHZhbHVlV2l0aERlZmF1bHQgJiYgdHlwZW9mIHZhbHVlV2l0aERlZmF1bHQgPT09ICdvYmplY3QnICYmICdpZCcgaW4gdmFsdWVXaXRoRGVmYXVsdFxuICAgICAgICAgICAgICA/IHZhbHVlV2l0aERlZmF1bHQuaWRcbiAgICAgICAgICAgICAgOiB2YWx1ZVdpdGhEZWZhdWx0XG4gICAgICAgICAgZmllbGRTdGF0ZS52YWx1ZSA9IHJlbGF0aW9uc2hpcFZhbHVlXG4gICAgICAgICAgZmllbGRTdGF0ZS5pbml0aWFsVmFsdWUgPSByZWxhdGlvbnNoaXBWYWx1ZVxuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGVbYCR7cGF0aH0ke2ZpZWxkLm5hbWV9YF0gPSBmaWVsZFN0YXRlXG5cbiAgICAgICAgYnJlYWtcbiAgICAgIH1cblxuICAgICAgY2FzZSAndXBsb2FkJzoge1xuICAgICAgICBjb25zdCByZWxhdGlvbnNoaXBWYWx1ZSA9XG4gICAgICAgICAgdmFsdWVXaXRoRGVmYXVsdCAmJiB0eXBlb2YgdmFsdWVXaXRoRGVmYXVsdCA9PT0gJ29iamVjdCcgJiYgJ2lkJyBpbiB2YWx1ZVdpdGhEZWZhdWx0XG4gICAgICAgICAgICA/IHZhbHVlV2l0aERlZmF1bHQuaWRcbiAgICAgICAgICAgIDogdmFsdWVXaXRoRGVmYXVsdFxuICAgICAgICBmaWVsZFN0YXRlLnZhbHVlID0gcmVsYXRpb25zaGlwVmFsdWVcbiAgICAgICAgZmllbGRTdGF0ZS5pbml0aWFsVmFsdWUgPSByZWxhdGlvbnNoaXBWYWx1ZVxuXG4gICAgICAgIHN0YXRlW2Ake3BhdGh9JHtmaWVsZC5uYW1lfWBdID0gZmllbGRTdGF0ZVxuXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG5cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgZmllbGRTdGF0ZS52YWx1ZSA9IHZhbHVlV2l0aERlZmF1bHRcbiAgICAgICAgZmllbGRTdGF0ZS5pbml0aWFsVmFsdWUgPSB2YWx1ZVdpdGhEZWZhdWx0XG5cbiAgICAgICAgLy8gQWRkIGZpZWxkIHRvIHN0YXRlXG4gICAgICAgIHN0YXRlW2Ake3BhdGh9JHtmaWVsZC5uYW1lfWBdID0gZmllbGRTdGF0ZVxuXG4gICAgICAgIGJyZWFrXG4gICAgICB9XG4gICAgfVxuICB9IGVsc2UgaWYgKGZpZWxkSGFzU3ViRmllbGRzKGZpZWxkKSkge1xuICAgIC8vIEhhbmRsZSBmaWVsZCB0eXBlcyB0aGF0IGRvIG5vdCB1c2UgbmFtZXMgKHJvdywgZXRjKVxuICAgIGF3YWl0IGl0ZXJhdGVGaWVsZHMoe1xuICAgICAgaWQsXG4gICAgICBjb25maWcsXG4gICAgICBkYXRhLFxuICAgICAgZmllbGRzOiBmaWVsZC5maWVsZHMsXG4gICAgICBmdWxsRGF0YSxcbiAgICAgIGxvY2FsZSxcbiAgICAgIG9wZXJhdGlvbixcbiAgICAgIHBhcmVudFBhc3Nlc0NvbmRpdGlvbjogcGFzc2VzQ29uZGl0aW9uLFxuICAgICAgcGF0aCxcbiAgICAgIHByZWZlcmVuY2VzLFxuICAgICAgc3RhdGUsXG4gICAgICB0LFxuICAgICAgdXNlcixcbiAgICB9KVxuICB9IGVsc2UgaWYgKGZpZWxkLnR5cGUgPT09ICd0YWJzJykge1xuICAgIGNvbnN0IHByb21pc2VzID0gZmllbGQudGFicy5tYXAoKHRhYikgPT5cbiAgICAgIGl0ZXJhdGVGaWVsZHMoe1xuICAgICAgICBpZCxcbiAgICAgICAgY29uZmlnLFxuICAgICAgICBkYXRhOiB0YWJIYXNOYW1lKHRhYikgPyBkYXRhPy5bdGFiLm5hbWVdIDogZGF0YSxcbiAgICAgICAgZmllbGRzOiB0YWIuZmllbGRzLFxuICAgICAgICBmdWxsRGF0YSxcbiAgICAgICAgbG9jYWxlLFxuICAgICAgICBvcGVyYXRpb24sXG4gICAgICAgIHBhcmVudFBhc3Nlc0NvbmRpdGlvbjogcGFzc2VzQ29uZGl0aW9uLFxuICAgICAgICBwYXRoOiB0YWJIYXNOYW1lKHRhYikgPyBgJHtwYXRofSR7dGFiLm5hbWV9LmAgOiBwYXRoLFxuICAgICAgICBwcmVmZXJlbmNlcyxcbiAgICAgICAgc3RhdGUsXG4gICAgICAgIHQsXG4gICAgICAgIHVzZXIsXG4gICAgICB9KSxcbiAgICApXG5cbiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcylcbiAgfVxufVxuIl0sIm5hbWVzIjpbImFkZEZpZWxkU3RhdGVQcm9taXNlIiwiaWQiLCJjb25maWciLCJkYXRhIiwiZmllbGQiLCJmdWxsRGF0YSIsImxvY2FsZSIsIm9wZXJhdGlvbiIsInBhc3Nlc0NvbmRpdGlvbiIsInBhdGgiLCJwcmVmZXJlbmNlcyIsInN0YXRlIiwidCIsInVzZXIiLCJmaWVsZEFmZmVjdHNEYXRhIiwiZmllbGRTdGF0ZSIsImNvbmRpdGlvbiIsImFkbWluIiwiaW5pdGlhbFZhbHVlIiwidW5kZWZpbmVkIiwidmFsaWQiLCJ2YWxpZGF0ZSIsInZhbHVlIiwidmFsdWVXaXRoRGVmYXVsdCIsImdldFZhbHVlV2l0aERlZmF1bHQiLCJkZWZhdWx0VmFsdWUiLCJuYW1lIiwidmFsaWRhdGlvblJlc3VsdCIsInNpYmxpbmdEYXRhIiwiZXJyb3JNZXNzYWdlIiwidHlwZSIsImFycmF5VmFsdWUiLCJBcnJheSIsImlzQXJyYXkiLCJwcm9taXNlcyIsInJvd01ldGFkYXRhIiwicmVkdWNlIiwiYWNjIiwicm93IiwiaSIsInJvd1BhdGgiLCJPYmplY3RJRCIsInRvSGV4U3RyaW5nIiwicHVzaCIsIml0ZXJhdGVGaWVsZHMiLCJmaWVsZHMiLCJwYXJlbnRQYXNzZXNDb25kaXRpb24iLCJjb2xsYXBzZWRSb3dJRHMiLCJjb2xsYXBzZWQiLCJjaGlsZEVycm9yUGF0aHMiLCJTZXQiLCJpbml0Q29sbGFwc2VkIiwiaW5jbHVkZXMiLCJQcm9taXNlIiwiYWxsIiwibGVuZ3RoIiwiZGlzYWJsZUZvcm1EYXRhIiwicm93cyIsImJsb2Nrc1ZhbHVlIiwiYmxvY2siLCJibG9ja3MiLCJmaW5kIiwiYmxvY2tUeXBlIiwic2x1ZyIsImJsb2NrTmFtZSIsImhhc01hbnkiLCJyZWxhdGlvbnNoaXBWYWx1ZSIsIm1hcCIsInJlbGF0aW9uc2hpcCIsInJlbGF0aW9uVG8iLCJmaWVsZEhhc1N1YkZpZWxkcyIsInRhYnMiLCJ0YWIiLCJ0YWJIYXNOYW1lIl0sIm1hcHBpbmdzIjoiQUFBQSxvQ0FBb0M7Ozs7K0JBZ0N2QkE7OztlQUFBQTs7O3FFQTdCUTt1QkFPMkM7d0VBQ2hDOytCQUNGOzs7Ozs7QUFvQnZCLE1BQU1BLHVCQUF1QixPQUFPLEVBQ3pDQyxFQUFFLEVBQ0ZDLE1BQU0sRUFDTkMsSUFBSSxFQUNKQyxLQUFLLEVBQ0xDLFFBQVEsRUFDUkMsTUFBTSxFQUNOQyxTQUFTLEVBQ1RDLGVBQWUsRUFDZkMsSUFBSSxFQUNKQyxXQUFXLEVBQ1hDLEtBQUssRUFDTEMsQ0FBQyxFQUNEQyxJQUFJLEVBQ0M7SUFDTCxJQUFJQyxJQUFBQSx1QkFBZ0IsRUFBQ1YsUUFBUTtRQUMzQixNQUFNVyxhQUF3QjtZQUM1QkMsV0FBV1osTUFBTWEsS0FBSyxFQUFFRDtZQUN4QkUsY0FBY0M7WUFDZFg7WUFDQVksT0FBTztZQUNQQyxVQUFVakIsTUFBTWlCLFFBQVE7WUFDeEJDLE9BQU9IO1FBQ1Q7UUFFQSxNQUFNSSxtQkFBbUIsTUFBTUMsSUFBQUEsd0JBQW1CLEVBQUM7WUFDakRDLGNBQWNyQixNQUFNcUIsWUFBWTtZQUNoQ25CO1lBQ0FPO1lBQ0FTLE9BQU9uQixNQUFNLENBQUNDLE1BQU1zQixJQUFJLENBQUM7UUFDM0I7UUFFQSxJQUFJdkIsTUFBTSxDQUFDQyxN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